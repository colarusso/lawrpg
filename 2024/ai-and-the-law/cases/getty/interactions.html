<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<title>Prompt Interactions</title>
<script>

localStorage.setItem('templates',JSON.stringify({
  "Distill & Question": {
    "prompt": "{\"next\":\"Distill\"}",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 1,
    "output_to": 4,
    "behavior": "Case Texts",
    "hide_button": false
  },
  "Go Socrates": {
    "prompt": "{\"next\":\"Socrates\"}",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 1,
    "output_to": 4,
    "behavior": "Case Texts",
    "hide_button": false
  },
  "Moot the Case": {
    "prompt": "{\"next\":\"Moot\"}",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 1,
    "output_to": 4,
    "behavior": "Case Texts",
    "hide_button": false
  },
  "Weekly Reflection": {
    "prompt": "You are a teaching assistant helping a student look back at their work this week. Be sure to get four big pieces of information. \n\n1. What they worked on this week, including any assigned readings.\n2. What about their process worked for them.\n3. What about their process didn't work for them. \n4. What suggestions they might have for doing things differently next week. \n\nAs a general approach, meet them where they are, but gently push for more detail. You need to be convinced that they actually did the work and that they've really thought about their process. If they didn't mention any readings, ask them if they had any readings this week. You don't need to interrogate them, just be sure they have engaged with your questions in good faith before moving on.\n\nDon't ask all your questions at once, let them come up in conversation. \n",
    "model": "gpt-4o-mini",
    "temperature": 0.7,
    "max_tokens": 500,
    "output": 1,
    "json_mode": 0,
    "output_to": 0,
    "behavior": "chat",
    "hide_button": false
  },
  "Distill": {
    "prompt": "You are a helpful research assistant. Your job is to answer questions about an ongoing legal case based solely on the documents provided below (i.e., the initial complaint from a plaintiff and motion to dismiss from the defendant). You're first task is to take these documents and provide a short 150-word summary. When asked follow-up questions, use the documents' text, and ONLY the documents' text, to answer these questions. If you can't find an answer in the text, politely decline to answer, explaining that you can't find the information. Do NOT write anything that isn't supported by the text of the document even if it is a general knowledge question. As far as you are concerned, you only know what is written in the text, nothing else. Provide internal citations to relevant sections when possible. Keep all of your replies short! But first, please provide a summary of the text.\n\n=======================================================\n\nHere are the case documents: \n\n============\n{{passThrough[\"case_text\"]}}",
    "model": "gpt-4o-mini",
    "temperature": 0,
    "max_tokens": 500,
    "output": 1,
    "json_mode": 0,
    "output_to": 0,
    "behavior": "chat",
    "hide_button": true
  },
  "Socrates": {
    "prompt": "You are an actor playing a law school professor conducting a Socratic dialogue. In this scene you are interacting with a student, asking them questions about a case. Below I will provide you with documents from the case for you to work with. Your job is to stay in character and act out your part. You are aiming for a realistic performance. To help you get into character, here is some background information.\n\nBACKGROUND\n\nYou're character is very similar in demeanor to Professor Charles W. Kingsfield Jr. in the Paper Chase. You are hard but fair, and see your role in class as that of Socrates. You're job is to have students come to understand the material through guided questions. The following is how you have described what you try to do for each dialogue. \n\nPreparation\n\n    - Choose a Case: Select a legal case that presents complex issues.\n    - Identify Issues: Pinpoint the main legal issues and principles in the case.\n    - Develop Questions: Create a sequence of questions ranging from broad to specific to guide the discussion.\n\nConducting the Dialogue\n\n    - Start Broad: Initiate with questions that summarize the case and identify issues.\n    - Probe Deeper: Continue with questions that analyze arguments, evaluate reasoning, and apply principles.\n    - Encourage Participation: Foster an inclusive atmosphere for all students to contribute.\n    - Guide Discussion: Facilitate the dialogue, connecting ideas and challenging assumptions.\n    - Clarify and Summarize: Regularly clarify points and summarize key takeaways.\n\nDeepening Understanding\n\n    - Reflect on Discussion: Encourage students to consider the broader implications and applications.\n    - Integrate Perspectives: Where relevant, bring in ethical, historical, or societal contexts.\n    - Provide Feedback: Offer constructive feedback on students' analyses.\n\nConcluding the Dialogue\n\n    - Wrap-Up: Summarize the discussion's main insights and their relevance.\n    - Connect Themes: Link the dialogue to overarching course themes.\n\nRemember, the case you are working with will be provided in an upload from the user. \n\nDIRECTION\n\nBe sure to keep your questions and responses short. You \"speak in sentences not paragraphs.\" Short and conversational, no speechifying!\n\nAfter you are provided with the case document(s), start the conversation by asking the user to \"Please describe the facts of the case.\"\n\nThink about how your character would respond and craft an appropriate reply. Remember, you are a law professor conducting a Socratic dialogue. Your goal is to embody your character while achieving a naturalistic believable performance. You will continue to play the part of your character throughout the conversation. Whatever happens, do NOT break character! \n\nIf the first user interaction doesn't involve uploading case documents, ask for them to do so.\n\n=======================================================\n\nHere are the case documents: \n\n============\n{{passThrough[\"case_text\"]}}",
    "model": "gpt-4o-mini",
    "temperature": 0.7,
    "max_tokens": 500,
    "output": 1,
    "json_mode": 0,
    "output_to": 0,
    "behavior": "chat",
    "hide_button": true
  },
  "Moot": {
    "prompt": "You are an actor serving as a judge in a moot court. In this scene you are interacting with a student, asking them questions about a case. Below I will provide you with documents from the case for you to work with. Your job is to stay in character and act out your part. You are aiming for a realistic performance. To help you get into character, here is some background information.\n\nYou are acting as a judge for a student attorney arguing a hypothetical case. A set of court documents that describe the case are provided below. You should start by asking the student attorney to state what side they are representing. Then lead right into questioning them about the merits of their case. \n\nYour role is to guide the proceedings, ensure fairness, and assess the students' understanding of the law and their ability to argue effectively. Here’s a short set of instructions to help you:\n\n1. Maintain Professionalism and Neutrality:\n\n    Conduct the proceedings with the same level of formality and seriousness as a real appellate court.\n    Remain impartial and do not show bias toward either side.\n\n2. Initiate the Session:\n\n    Begin by outlining the format of the proceedings.\n    Call on the student attorney to state what side they represent and to present their argument.\n\n3. Guide the Oral Argument:\n\n    Allow the student attorney to begin their argument, but be prepared to interject with questions throughout.\n    Engage actively with the attorney, posing questions that test their understanding, challenge their reasoning, or clarify their position.\n    Allow the attorney to respond fully before moving on to the next question or point.\n\n4. Ask Questions Thoughtfully and Strategically:\n\n    Use questions to probe the strengths and weaknesses of the attorney’s argument, much like in a real appellate court.\n    Challenge the attorney to defend their position under scrutiny, encouraging deep legal analysis.\n    Be respectful, but persistent in questioning to simulate the rigorous examination typical in appellate courts.\n\n5. Control the Dialogue:\n\n    Maintain control over the flow of the conversation, ensuring it stays focused on the legal issues at hand.\n    Politely steer the discussion back on track if the attorney digresses.\n\n6. Provide Constructive Feedback:\n\n    After the attorney concludes their argument, by saying something like, \"I rest my case,\" offer specific and constructive feedback.\n    Comment on the effectiveness of their legal reasoning, their responses to questions, and their overall presentation.\n    Be sure to include feedback that incorporates their opponent's likely arguments (as inferred from the court documents)\n    Suggest ways they could improve their performance in future arguments.\n\n7. Encourage and Motivate:\n\n    Conclude the session by acknowledging the effort and preparation of all participants.\n    Reinforce the educational value of the exercise and encourage the students to continue refining their advocacy skills.\n\nBy focusing on active engagement and thoughtful questioning, you can create a realistic and challenging appellate argument experience for the student attorneys.\n\n=======================================================\n\nHere are the case documents: \n\n============\n{{passThrough[\"case_text\"]}}\n\n=======================================================\n\nNow begin acting as the judge in the case, provide only your dialog, no need to prepend it with something like \"JUDGE:\" When speaking, think about how your character would speak and craft an appropriate reply. Your goal is to embody your character while achieving a naturalistic believable performance. You will continue to play the part of your character throughout the conversation. Whatever happens, do NOT break character! \n",
    "model": "gpt-4o-mini",
    "temperature": 0.7,
    "max_tokens": 500,
    "output": 1,
    "json_mode": 0,
    "output_to": 0,
    "behavior": "chat",
    "hide_button": true
  },
  "Case Texts": {
    "prompt": "[#You'll need to escape the case text before including it below. See https://www.freeformatter.com/json-escape.html#]{\n\"next\":\"{{passThrough[\"next\"]}}\",\n\"case_text\":\"IN THE UNITED STATES DISTRICT COURT\\r\\nFOR THE DISTRICT OF DELAWARE\\r\\nGETTY IMAGES (US), INC.\\r\\nPlaintiff,\\r\\nv.\\r\\nSTABILITY AI, INC.\\r\\nDefendant.\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\nC.A. No.:\\r\\nDEMAND FOR JURY TRIAL\\r\\nCOMPLAINT\\r\\nPlaintiff Getty Images (US), Inc. (\\u201CGetty Images\\u201D or \\u201CPlaintiff\\u201D), by and through its\\r\\nundersigned attorneys, for its Complaint against Defendant Stability AI, Inc. (\\u201CStability AI\\u201D or\\r\\n\\u201CDefendant\\u201D), hereby alleges as follows:\\r\\nNATURE OF ACTION\\r\\n1. This case arises from Stability AI\\u2019s brazen infringement of Getty Images\\u2019\\r\\nintellectual property on a staggering scale. Upon information and belief, Stability AI has copied\\r\\nmore than 12 million photographs from Getty Images\\u2019 collection, along with the associated\\r\\ncaptions and metadata, without permission from or compensation to Getty Images, as part of its\\r\\nefforts to build a competing business. As part of its unlawful scheme, Stability AI has removed\\r\\nor altered Getty Images\\u2019 copyright management information, provided false copyright\\r\\nmanagement information, and infringed Getty Images\\u2019 famous trademarks.\\r\\n2. Getty Images brings this action to recover damages that it has suffered and is\\r\\ncontinuing to suffer, and to prevent the irreparable harm caused by Stability AI\\u2019s intentional and\\r\\nwillful acts.\\r\\n3. Getty Images is one of the world\\u2019s leading creators and distributors of digital\\r\\ncontent. At great expense, over the course of nearly three decades, Getty Images has curated a\\r\\n\\r\\ncollection of hundreds of millions of premium quality visual assets, most of which are still,\\r\\nphotographic images. Many of these images were created by Getty Images staff photographers\\r\\nas works made-for-hire, others have been acquired by Getty Images from third parties with an\\r\\nassignment of the associated copyrights, and the remainder have been licensed to Getty Images\\r\\nby its hundreds of content partners or hundreds of thousands of contributing photographers, who\\r\\nrely on the licensing income Getty Images generates for them.\\r\\n4. Getty Images makes hundreds of millions of visual assets available to customers\\r\\nthroughout the world and in this District via websites, including but not limited to\\r\\nwww.gettyimages.com and www.istock.com. The visual assets on Getty Images\\u2019 websites are\\r\\naccompanied by: (i) titles and captions which are themselves original and creative copyrighted\\r\\nexpression; (ii) watermarks with credit information and content identifiers that are designed to\\r\\ndeter infringing uses of the content; and (iii) metadata containing other copyright management\\r\\ninformation.\\r\\n5. Getty Images serves creative, corporate, and media customers in more than 200\\r\\ncountries around the world, and its imagery helps its customers produce work which appears\\r\\nevery day in the world\\u2019s most influential newspapers, magazines, advertising campaigns, films,\\r\\ntelevision programs, books and websites. In appropriate circumstances, and with safeguards for\\r\\nthe rights and interests of its photographers and contributors and the subjects of the images in its\\r\\ncollection, Getty Images also licenses the use of its visual assets and associated metadata in\\r\\nconnection with the development of artificial intelligence and machine learning tools. Getty\\r\\nImages has licensed millions of suitable digital assets to leading technology innovators for a\\r\\nvariety of purposes related to artificial intelligence and machine learning.\\r\\n\\r\\n6. Getty Images\\u2019 visual assets are highly desirable for use in connection with\\r\\nartificial intelligence and machine learning because of their high quality, and because they are\\r\\naccompanied by content-specific, detailed captions and rich metadata.\\r\\n7. Upon information and belief, Stability AI was founded in 2020 by Emad\\r\\nMostaque, a former hedge fund executive, as a for-profit company. According to recent press\\r\\nreports, Stability AI recently raised more than $100 million from venture capital investors and is\\r\\nalready valued at $1 billion. On the back of intellectual property owned by Getty Images and\\r\\nother copyright holders, Stability AI has created an image-generating model called Stable\\r\\nDiffusion that uses artificial intelligence to deliver computer-synthesized images in response to\\r\\ntext prompts. In additional to offering open-source versions of Stable Diffusion, Stability AI\\r\\noffers a revenue-generating user interface called DreamStudio that is powered by its Stable\\r\\nDiffusion model. DreamStudio enables users to obtain images from the Stable Diffusion model\\r\\non their own personal computers without the need for software installation or coding knowledge,\\r\\nand Stability AI charges fees for that service.\\r\\n8. Rather than attempt to negotiate a license with Getty Images for the use of its\\r\\ncontent, and even though the terms of use of Getty Images\\u2019 websites expressly prohibit\\r\\nunauthorized reproduction of content for commercial purposes such as those undertaken by\\r\\nStability AI, Stability AI has copied at least 12 million copyrighted images from Getty Images\\u2019\\r\\nwebsites, along with associated text and metadata, in order to train its Stable Diffusion model.\\r\\n9. Stability AI now competes directly with Getty Images by marketing Stable\\r\\nDiffusion and its DreamStudio interface to those seeking creative imagery, and its infringement\\r\\nof Getty Images\\u2019 content on a massive scale has been instrumental to its success to date.\\r\\n\\r\\n10. Upon information and belief, Stability AI was well aware that the content it was\\r\\nscraping without permission from Getty Images\\u2019 websites was protected by copyright.\\r\\n11. Often, the output generated by Stable Diffusion contains a modified version of a\\r\\nGetty Images watermark, creating confusion as to the source of the images and falsely implying\\r\\nan association with Getty Images. While some of the output generated through the use of Stable\\r\\nDiffusion is aesthetically pleasing, other output is of much lower quality and at times ranges\\r\\nfrom the bizarre to the grotesque. Stability AI\\u2019s incorporation of Getty Images\\u2019 marks into low\\r\\nquality, unappealing, or offensive images dilutes those marks in further violation of federal and\\r\\nstate trademark laws.\\r\\n12. Getty Images therefore brings this action alleging claims under the Copyright Act\\r\\nof 1976, 17 U.S.C. \\u00A7101 et seq., the Lanham Act, 15 U.S.C. \\u00A7 1051 et seq., and Delaware\\r\\ntrademark and unfair competition laws to bring an end to Stability AI\\u2019s blatantly infringing\\r\\nconduct and obtain redress for Stability AI\\u2019s callous disregard for its intellectual property rights.\\r\\nPARTIES\\r\\n13. Plaintiff Getty Images (US), Inc. is a New York corporation with headquarters in\\r\\nSeattle, Washington. It is the owner or exclusive licensee of the copyrights subject to the\\r\\ncopyright infringement claims at issue and the owner of the trademarks at issue.\\r\\n14. Upon information and belief, Defendant Stability AI, Inc. is a Delaware\\r\\ncorporation with headquarters in London, UK. Also upon information and belief, Defendant\\r\\nStability AI and Stability AI, Ltd., an affiliated entity, are alter egos of one another and operate\\r\\nas a single enterprise. The two corporations share the same CEO and founder: Mr. Mostaque.\\r\\nUpon information and belief, in addition to serving as CEO and Director of Stability AI, Inc.,\\r\\nMr. Mostaque controls 75% or more of the voting rights, 75% or more of the shares, and has the\\r\\n\\r\\nright to appoint or remove a majority of the board of directors of Stability AI, Ltd. According to\\r\\nDunn & Bradstreet, Stability AI, Ltd. is a subsidiary of Stability AI and, as of November 2022,\\r\\nStability AI, Ltd.\\u2019s sole share was owned by Stability AI. Stability AI and Stability AI, Ltd. also\\r\\npresent themselves as a single enterprise: they are located at the same physical London address\\r\\nand share both an email domain (@stability.ai) and website (https:\\/\\/stability.ai\\/).\\r\\nJURISDICTION AND VENUE\\r\\n15. This action arises under the Copyright Act of 1976, 17 U.S.C. \\u00A7101 et seq., the\\r\\nLanham Act, 15 U.S.C. \\u00A7 1051 et seq., and Delaware trademark and unfair competition laws.\\r\\nThis Court has subject matter jurisdiction pursuant to 28 U.S.C. \\u00A7\\u00A7 1331, 1338, and 1367.\\r\\n16. This Court has personal jurisdiction over Defendant Stability AI because Stability\\r\\nAI is incorporated in Delaware.\\r\\n17. Venue is proper in this District pursuant to 28 U.S.C. \\u00A7 1391(b) because\\r\\nDefendant is subject to personal jurisdiction in this District. Venue is also proper in this District\\r\\npursuant to 28 U.S.C. \\u00A7 1400(a), because Stability AI or its agents reside or may be found in this\\r\\nDistrict.\\r\\nALLEGATIONS COMMON TO ALL CLAIMS FOR RELIEF\\r\\nA. Getty Images, Its Extensive Collection, and Its Worldwide Reputation for\\r\\nPremium Visual Content\\r\\n18. Getty Images is a preeminent global visual content creator and a leading source\\r\\nfor visual content around the world. Getty Images operates websites for the purpose of licensing\\r\\nits works, including, inter alia, at www.gettyimages.com and www.istock.com. Its collection,\\r\\nwhich currently contains hundreds of millions of visual assets, is renowned worldwide for its\\r\\nunmatched depth, breadth, and quality. That visual content is included in a robust database (the\\r\\n\\u201CDatabase\\u201D) that also contains detailed, original text titles and captions associated with the\\r\\n\\r\\nindividual photographs and rich, image-specific metadata to provide the highest quality user\\r\\nexperience to customers and to ensure appropriate compensation for contributors and content\\r\\npartners.\\r\\n19. By visiting Getty Images\\u2019 websites, its customers and potential customers can\\r\\nsearch and browse its collection before purchasing a license for specific content. For example,\\r\\ncustomers looking for an image from a wedding might search \\u201Ca couple exchanges rings.\\u201D\\r\\nAmong the search results, they might find the following image available for license with an\\r\\naccompanying title that reads, \\u201CValentine\\u2019s Day Group Wedding Held at Palm Beach County\\r\\nClerk\\u2019s Office,\\u201D a caption that reads, \\u201CA couple exchanges rings as they are wed during a group\\r\\nValentine's day wedding at the National Croquet Center on February 14, 2014 in West Palm\\r\\nBeach, Florida\\u201D and a photo credit that reads \\u201C(Photo by Joe Readle\\/Getty Images)\\u201D:1\\r\\n1 https:\\/\\/www.gettyimages.com\\/detail\\/news-photo\\/couple-exchanges-rings-as-they-are-wed-\\r\\nduring-a-group-news-\\r\\nphoto\\/469378943?phrase=a%20couple%20exchanges%20rings&adppopup=true.\\r\\n\\r\\n20. As the foregoing example reflects, the search results contain, in addition to\\r\\nimages responsive to the search terms, watermarks on the images to deter infringing uses, credits\\r\\nand other metadata, and options for purchasing a license for further use.\\r\\n21. Getty Images has more than 500,000 contributors (80,000 of which are exclusive\\r\\nto Getty Images), over 300 premium content partners, more than 115 staff photographers,\\r\\nvideographers, and other content experts who guide and contribute to the creation of award-\\r\\nwinning content, and a unique and comprehensive visual archive collection covering a broad\\r\\nrange of subject matter. Contributors choose to work with Getty Images to benefit from its\\r\\nreputation and goodwill as a preeminent content licensor, its robust platform, its global\\r\\ndistribution network, and the royalty income Getty Images generates for them.\\r\\n22. Getty Images\\u2019 customers come to Getty Images for its easy-to-use platform, its\\r\\ncomprehensive suite of content (including certain types of content for which authorized copies\\r\\nare exclusive to Getty Images), its variety of licensing options and services, and the assurance\\r\\nthat the images they obtain from Getty Images will not infringe third-party copyrights.\\r\\nB. Getty Images\\u2019 Intellectual Property Rights and Terms of Use\\r\\n1. Copyright\\r\\n23. Most of the images and videos displayed on Getty Images\\u2019 websites are original,\\r\\ncreative works that enjoy protection under U.S. copyright laws. For many of these visual assets,\\r\\nincluding all of the assets subject to the copyright infringement claims at issue in this action,\\r\\nGetty Images either owns the copyright or is an exclusive licensee; for others, Getty Images is a\\r\\nnon-exclusive licensee.\\r\\n24. For purposes of the copyright infringement claims set forth herein and\\r\\nestablishing the unlawful nature of Stability AI\\u2019s conduct, Getty Images has selected 7,216\\r\\n\\r\\nexamples from the millions of images that Stability AI copied without permission and used to\\r\\ntrain one or more versions of Stable Diffusion. The copyrights for each of these images (as well\\r\\nas for many other images) have been registered with the U.S. Copyright Office. A list of these\\r\\nworks, together with their copyright registration numbers, is attached as Exhibit A.\\r\\n25. As noted above, for the images displayed on its websites, Getty Images also\\r\\ntypically provides a detailed corresponding title and caption. Image titles and captions, which\\r\\nare authored either by a Getty Images staff member or by an image contributor or partner,\\r\\ntypically reflect originality and creative choices. For example, for the image below, the\\r\\naccompanying title reads, \\u201CMalnourished Sea Lions Continued To Be Rescued Off California\\r\\nShores\\u201D and the accompanying caption reads: \\u201CA sick and malnourished sea lion pup sits in an\\r\\nenclosure at the Marine Mammal Center on March 18, 2015 in Sausalito, California. For the\\r\\nthird winter in a row, hundreds of sick and starving California sea lions are washing up on\\r\\nCalifornia shores, with over 1,800 found and treated at rehabilitation centers throughout the state\\r\\nsince the beginning of the year. The Marine Mammal Center is currently caring for 224 of the\\r\\nemaciated pups.\\u201D 2\\r\\n2 https:\\/\\/www.gettyimages.com\\/detail\\/news-photo\\/sick-and-malnourished-sea-lion-pup-sits-in-\\r\\nan-enclosure-at-news-photo\\/466716732\\r\\n\\r\\n26. Each of the images available through Getty Images\\u2019 websites has an associated\\r\\npage that contains a unique URL pointing to a location where the image is stored together with\\r\\nan \\u201Calt text\\u201D tag containing the image title and caption. The image URLs, titles, and captions,\\r\\nalong with other current metadata for each image, such as keywords and author and ownership\\r\\ndata, are populated from the Database.\\r\\n27. Getty Images has spent years coordinating and arranging the Database, including,\\r\\ninter alia, by setting criteria for inclusion of images, selecting specific images for inclusion,\\r\\ncreating and incorporating detailed captions and other text paired with images, creating and\\r\\nassigning unique asset identifiers that can be linked to specific contributors, and arranging the\\r\\ncontents of the Database so that the Database is searchable and results can be filtered.\\r\\nAdditionally, Getty Images has and continues to invest significantly in maintaining the contents\\r\\n\\r\\nof the Database. Between 2017 and 2020 alone, Getty Images and its affiliates invested more\\r\\nthan $200 million to maintain the Database.\\r\\n28. Getty Images has registered its copyright of the Database with the United States\\r\\nCopyright Office. The copyright registration number is TXu002346096.\\r\\n2. Trademarks and Goodwill\\r\\n29. Getty Images\\u2019 name and trademarks are renowned in the U.S. and around the\\r\\nworld. Customers perform over 2.7 billion searches annually on the Getty Images\\u2019 websites,\\r\\nwhich exist in 23 languages. Through its full range of content solutions, Getty Images served\\r\\nover 836,000 purchasing customers in the last year alone, with customers from almost every\\r\\ncountry in the world, ranging from media outlets, advertising agencies, and corporations of all\\r\\nsizes to individual creators. Customers rely on Getty Images for the best content and service,\\r\\nand trust the trademarks and service marks associated with its content.\\r\\n30. Since its founding in 1995, Getty Images has been using its name and associated\\r\\ntrademarks in commerce continuously in connection with the distribution, promotion, and\\r\\nmarketing of its services and visual content, including the uses described above. Getty Images\\r\\nhas used its name and trademarks exclusively and extensively in the United States, and its\\r\\ntrademarks are widely recognized as representing premium quality visual content.\\r\\n31. Getty Images uses its name and trademarks prominently on the Getty Images\\r\\nwebsites. Each image available for viewing and purchase prominently displays a watermark that\\r\\ncontains an affiliated trademark, as illustrated in the images depicted in paragraphs 19 and 25\\r\\nabove.\\r\\n32. Getty Images owns trademarks registered on the Principal Register in the United\\r\\nStates Patent & Trademark Office (\\u201CUSPTO\\u201D) relating to its iconic brand. True and correct\\r\\n\\r\\ncopies of the federal registration certificates evidencing Getty Images\\u2019 ownership of the\\r\\ntrademarks shown below are attached hereto as Exhibit B.\\r\\nMark Name Reg. Number Reg. Date\\r\\nGETTY IMAGES 2,656,652 12\\/03\\/2002\\r\\nGETTY IMAGES 2,837,208 04\\/27\\/2004\\r\\nGETTY IMAGES 2,842,851 05\\/18\\/2004\\r\\nGETTY IMAGES 2,844,647 05\\/25\\/2004\\r\\nGETTY IMAGES 3,603,335 04\\/07\\/2009\\r\\nGETTY IMAGES 4,968,996 05\\/31\\/2016\\r\\nGETTY IMAGES 4,968,997 05\\/31\\/2016\\r\\nGETTY IMAGES 5,200,414 05\\/09\\/2017\\r\\n33. Getty Images also owns common law rights in the mark GETTY IMAGES.\\r\\nTogether with Getty Images\\u2019 federally registered trademarks, these are referred to collectively as\\r\\nthe \\u201CGetty Images Marks.\\u201D\\r\\n3. Website Terms and Conditions\\r\\n34. Stability AI accessed Getty Images\\u2019 collection of visual assets through Getty\\r\\nImages\\u2019 public-facing websites. The Getty Images websites from which Stability AI copied\\r\\nimages without permission is subject to express terms and conditions of use which, among other\\r\\nthings, expressly prohibit, inter alia: (i) downloading, copying or re-transmitting any or all of the\\r\\nwebsite or its contents without a license; and (ii) using any data mining, robots or similar data\\r\\ngathering or extraction methods. Such restrictions apply not only to the photographic images\\r\\nand videos that Getty Images licenses, but also to the valuable and proprietary title and caption\\r\\ninformation, keywords, and other metadata associated with the visual assets, all of which is\\r\\nhighly desirable for use in connection with developing AI tools such as Stable Diffusion.\\r\\nC. Stability AI Infringes Getty Images\\u2019 Copyrights on an Enormous Scale and\\r\\nExploits Getty Images\\u2019 Resources for its Commercial Benefit\\r\\n35. Upon information and belief, Stability AI was founded in 2020 and is engaged in\\r\\nthe development of tools and models to generate digital content using artificial intelligence.\\r\\n\\r\\n36. Stability AI created and maintains a model called Stable Diffusion. Upon\\r\\ninformation and belief, Stability AI utilizes the following steps from input to output:\\r\\na. First, Stability AI copies billions of text-and-image pairings\\u2014like those available\\r\\non Getty Images\\u2019 websites\\u2014and loads them into computer memory to train a\\r\\nmodel.\\r\\nb. Second, Stability AI encodes the images, which involves creating smaller versions\\r\\nof the images that take up less memory. Separately, Stability AI also encodes the\\r\\npaired text. Stability AI retains and stores copies of the encoded images and text\\r\\nas an essential element of training the model.\\r\\nc. Third, Stability AI adds visual \\u201Cnoise\\u201D to the encoded images, i.e., it further alters\\r\\nthe images so that it is incrementally harder to discern what is visually\\r\\nrepresented because the images have been intentionally degraded in visual quality\\r\\nin order to \\u201Ctrain\\u201D the model to remove the \\u201Cnoise.\\u201D By intentionally adding\\r\\nvisual noise to the existing images with associated text, Stability AI teaches the\\r\\nmodel to generate output images to be consistent with a particular text description\\r\\n(e.g., \\u201Ca dog playing on the beach during sunset\\u201D).\\r\\nd. Fourth, the model decodes the altered image and teaches itself to remove the noise\\r\\nby comparing the decoded image to the original image and text descriptions that\\r\\nhave been copied and stored. By learning to decode noise, the model learns to\\r\\ndeliver images similar to\\u2014and, in some cases, substantially similar to\\u2014the\\r\\noriginal without noise.\\r\\n37. Upon information and belief, the third and fourth steps described in the preceding\\r\\nparagraph are part of \\u201Ctraining\\u201D the model to allow Stable Diffusion to understand the\\r\\n\\r\\nrelationships between text and associated images and to use that knowledge to computationally\\r\\nproduce images in response to text prompts, as explained further below.\\r\\n38. Stable Diffusion was trained on 5 billion image-text pairs from datasets prepared\\r\\nby non-party LAION, a German entity that works in conjunction with and is sponsored by\\r\\nStability AI. Upon information and belief, Stability AI provided LAION with both funding and\\r\\nsignificant computing resources to produce its datasets in furtherance of Stability AI\\u2019s infringing\\r\\nscheme.\\r\\n39. Upon information and belief, LAION created the datasets of image-text pairs used\\r\\nby Stability AI by scraping links to billions of pieces of content from various websites, including\\r\\nGetty Images\\u2019 websites.\\r\\n40. Upon information and belief, Stability AI followed links included in LAION\\u2019s\\r\\ndataset to access specific pages on Getty Images\\u2019 websites and copied many millions of\\r\\ncopyrighted images and associated text. Such copying was done without Getty Images\\u2019\\r\\nauthorization and in violation of the express prohibitions against such conduct contained in its\\r\\nwebsites\\u2019 terms of use.\\r\\n41. Upon information and belief, Stability AI then created another copy of the content\\r\\nto encode it into a form its model could interpret.\\r\\n42. Upon information and belief, Stability AI then created yet additional copies with\\r\\nvisual noise added, while retaining encoded copies of the original images without noise for\\r\\ncomparison to help train its model.\\r\\n43. Upon information and belief, the unauthorized copies of Getty Images\\u2019 content\\r\\nmade by Stability AI are neither transitory nor ephemeral, and they were made with the express\\r\\naim of enabling Stability AI to supplant Getty Images as a source of creative visual imagery.\\r\\n\\r\\n44. To date, Getty Images has identified over 12 million links to images and their\\r\\nassociated text and metadata on its websites contained in the LAION datasets that were used to\\r\\ntrain Stable Diffusion. Among the millions of links was a link to the photograph of the couple\\r\\nexchanging rings displayed in paragraph 19 above as well as to each of the other images\\r\\nidentified in Exhibit A.\\r\\n45. Getty Images\\u2019 content is extremely valuable to the datasets used to train Stable\\r\\nDiffusion. Getty Images\\u2019 websites provide access to millions of high quality images and a vast\\r\\narray of subject matter. High quality images such as those offered by Getty Images on its\\r\\nwebsites are more useful for training an AI model such as Stable Diffusion than low quality\\r\\nimages because they contain more detail or data about the image that can be copied. By contrast,\\r\\na low quality image, such as one that has been compressed and posted as a small thumbnail on a\\r\\ntypical social media site, is less valuable because it only provides a rough, poor quality\\r\\nframework of the underlying image and may not be accompanied by detailed text or other useful\\r\\nmetadata.\\r\\n46. Stability AI has developed and released different versions of Stable Diffusion\\r\\nover time, including, upon information and belief, to users located in Delaware. The core dataset\\r\\nused to train Stable Diffusion version 2 was a subset of LAION 5B called LAION-Aesthetics,3\\r\\nwhich was created to exclude images that were not sufficiently aesthetically pleasing.4 Targeting\\r\\nits copying in this way allowed Stability AI to further benefit from Getty Images\\u2019 efforts over\\r\\nmany years to amass its renowned collection of high quality images and from the significant\\r\\n3 https:\\/\\/stability.ai\\/blog\\/stable-diffusion-announcement.\\r\\n4 https:\\/\\/laion.ai\\/projects\\/.\\r\\n\\r\\ninvestments required to generate such a collection and to develop and maintain the Database in\\r\\nwhich it is stored.\\r\\n47. Second, Getty Images\\u2019 websites include both the images and corresponding\\r\\ndetailed titles and captions and other metadata. Upon information and belief, the pairings of\\r\\ndetailed text and images has been critical to successfully training the Stable Diffusion model to\\r\\ndeliver relevant output in response to text prompts. If, for example, Stability AI ingested an\\r\\nimage of a beach that was labeled \\u201Cforest\\u201D and used that image-text pairing to train the model,\\r\\nthe model would learn inaccurate information and be far less effective at generating desirable\\r\\noutputs in response to text prompts by Stability AI\\u2019s customers. Furthermore, in training the\\r\\nStable Diffusion model, Stability AI has benefitted from Getty Images\\u2019 image-text pairs that are\\r\\nnot only accurate, but detailed. For example, if Stability AI ingested a picture of Lake Oroville\\r\\nin California during a severe drought with a corresponding caption limited to just the word\\r\\n\\u201Clake,\\u201D it would learn that the image is of a lake, but not which lake or that the photograph was\\r\\ntaken during a severe drought. If a Stable Diffusion user then entered a prompt for \\u201CCalifornia\\u2019s\\r\\nLake Oroville during a severe drought\\u201D the output image might still be one of a lake, but it would\\r\\nbe much less likely to be an image of Lake Oroville during a severe drought because the\\r\\nsynthesis engine would not have the same level of control that allows it to deliver detailed and\\r\\nspecific images in response to text prompts.\\r\\n48. Upon information and belief, when Stability AI ingested the image below of Lake\\r\\nOroville with a corresponding caption that reads \\u201CA section of Lake Oroville is seen nearly dry\\r\\non August 19, 2014 in Oroville, California. As the severe drought in California continues for a\\r\\nthird straight year, water levels in the State's lakes and reservoirs is reaching historic lows. Lake\\r\\n\\r\\nOroville is currently at 32 percent of its total 3,537,577 acre feet,\\u201D5 its use of the accompanying\\r\\ntext enabled the model to learn even more about the image and its contents and thus generate\\r\\noutput that competes with Getty Images\\u2019 own offerings much more effectively.\\r\\nD. Stability AI Competes Commercially with Getty Images\\r\\n49. Once an artificial intelligence model like Stable Diffusion has been trained on\\r\\nenough data to learn the relationship between text prompts and images, it can be used to generate\\r\\nnew images derived from the images and text the model\\u2019s creator has copied. For example, if a\\r\\nmodel has been trained with image-text pairs of cats and image-text pairs of clothing, then a user\\r\\n5 https:\\/\\/www.gettyimages.com\\/detail\\/news-photo\\/section-of-lake-oroville-is-seen-nearly-dry-\\r\\non-august-19-news-photo\\/453834006\\r\\n\\r\\ncan use the text prompt \\u201Ccat in a scarf\\u201D and the model will generate an image that looks like a cat\\r\\nin a scarf:\\r\\n50. To be clear, the image above is not a photograph of an actual cat wearing an\\r\\nactual scarf. It is a computer-synthesized image that resembles a cat wearing a scarf. Upon\\r\\ninformation and belief, Stability AI was able to generate the image above because it used enough\\r\\nimages of real cats paired with rich text captions and images of real scarves with rich text\\r\\ncaptions to train Stable Diffusion that the model can generate this type of output. Stable\\r\\nDiffusion is able to combine what it has learned to generate this artificial image, but only\\r\\nbecause it was trained on proprietary content belonging to Getty Images and others.\\r\\n51. As a result, Stable Diffusion at times produces images that are highly similar to\\r\\nand derivative of the Getty Images proprietary content that Stability AI copied extensively in the\\r\\n\\r\\ncourse of training the model. Indeed, independent researchers have observed that Stable\\r\\nDiffusion sometimes memorizes and regenerates specific images that were used to train the\\r\\nmodel.6\\r\\n52. In many cases, and as discussed further below, the output delivered by Stability\\r\\nAI includes a modified version of a Getty Images watermark, underscoring the clear link\\r\\nbetween the copyrighted images that Stability AI copied without permission and the output its\\r\\nmodel delivers. In the following example, the image on the left is another original, watermarked\\r\\nimage copied by Stability AI and used to train its model and the watermarked image on the right\\r\\nis output delivered using the model:\\r\\n6 See, e.g., Nicholas Carlini et al., Extracting Training Data from Diffusion Models (2023),\\r\\nhttps:\\/\\/arxiv.org\\/pdf\\/2301.13188.pdf; see also Gowthami Somepalli et al., Diffusion Art or\\r\\nDigital Forgery? Investigating Data Replication in Diffusion Models (2022),\\r\\nhttps:\\/\\/arxiv.org\\/pdf\\/2212.03860.pdf.\\r\\n\\r\\n53. Upon information and belief, Stability AI offers Stable Diffusion as open source\\r\\nsoftware, meaning that Stability AI permits third party developers to access, use, and further\\r\\ndevelop the model without paying license fees to Stability AI. Those third parties benefit from\\r\\nStability AI\\u2019s infringement on Getty Images and, in turn, Stability AI benefits from the\\r\\nwidespread adoption of its model.\\r\\n54. While Stability AI has made Stable Diffusion open source, Stability AI is also\\r\\ndirectly monetizing the tool through a commercial platform it calls DreamStudio. DreamStudio\\r\\nallows customers to access Stable Diffusion to generate images without the need for any of their\\r\\nown heavy-duty processing power, software installation, or coding knowhow. According to Mr.\\r\\nMostaque, Stability AI plans to further monetize Stable Diffusion by training and deploying\\r\\ncustomized, non-open source versions of Stable Diffusion for customers for use on a large scale,\\r\\nand Stability AI reportedly has been valued at $1 billion.7\\r\\n55. Upon information and belief, although Stability AI only released DreamStudio in\\r\\nAugust 2022, millions of people already have used DreamStudio and collectively created\\r\\nhundreds of millions of images. Yet Stability AI has not paid a cent to Getty Images or other\\r\\ncontent owners from which it reproduced copyrighted content without permission to train its\\r\\nhighly lucrative model.\\r\\n56. The gravity of Stability AI\\u2019s brazen theft and freeriding is compounded by the\\r\\nfact that, by utilizing Getty Images\\u2019 copyrighted content for artificial intelligence and machine\\r\\nlearning, Stability AI is stealing a service that Getty Images already provides to paying\\r\\ncustomers in the marketplace for that very purpose. Getty Images has licensed millions of\\r\\n7 https:\\/\\/techcrunch.com\\/2022\\/10\\/17\\/stability-ai-the-startup-behind-stable-diffusion-raises-\\r\\n101m\\/.\\r\\n\\r\\nsuitable digital assets for a variety of purposes related to artificial intelligence and machine\\r\\nlearning in a manner that respects personal and intellectual property rights. While Getty Images\\r\\nlicenses its proprietary content to responsible actors in appropriate circumstances, Stability AI\\r\\nhas taken that same content from Getty Images without permission, depriving Getty Images and\\r\\nits contributors of fair compensation, and without providing adequate protections for the privacy\\r\\nand dignity interests of individuals depicted.\\r\\nE. Stability AI\\u2019s Attempts to Circumvent Getty Images\\u2019 Watermarks\\r\\n57. As noted in paragraph 31 above, each copyrighted image on Getty Images\\u2019\\r\\npublic-facing websites contains a watermark that is intended to indicate provenance and prevent\\r\\ninfringement. The watermark includes both a Getty Images-owned mark and credit information\\r\\nfor the image.\\r\\n58. Upon information and belief, Stability AI has knowingly removed Getty Images\\u2019\\r\\nwatermarks from some images in the course of its copying as part of its infringing scheme. At\\r\\nthe same time, however, as discussed above, the Stable Diffusion model frequently generates\\r\\noutput bearing a modified version of the Getty Images watermark, even when that output is not\\r\\nbona fide Getty Images\\u2019 content and is well below Getty Images\\u2019 quality standards. Examples of\\r\\nthis practice include:\\r\\n\\r\\n59. Making matters worse, Stability AI has caused the Stable Diffusion model to\\r\\nincorporate a modified version of the Getty Images\\u2019 watermark to bizarre or grotesque synthetic\\r\\nimagery that tarnishes Getty Images\\u2019 hard-earned reputation, such as the image below:\\r\\n\\r\\n60. Upon information and belief, Stability AI is well aware that Stable Diffusion\\r\\ngenerates images that include distorted versions of Getty Images\\u2019 watermark and other\\r\\nwatermarks, but it has not modified its model to prevent that from happening.\\r\\n61. Upon information and belief, unless enjoined by this Court, Stability AI intends to\\r\\ncontinue to infringe upon Getty Images\\u2019 copyrights and trademarks and otherwise to profit from\\r\\nits unauthorized use of Getty Images\\u2019 intellectual property. Getty Images has no adequate\\r\\nremedy at law to redress all of the injuries that Stability AI has caused, and intends to continue to\\r\\ncause, by its conduct. Getty Images will continue to suffer irreparable harm until Stability AI\\u2019s\\r\\ninfringing conduct is enjoined by this Court.\\r\\n\\r\\nCLAIM I\\r\\nCopyright Infringement (17 U.S.C. \\u00A7 101 et seq.)\\r\\n62. Getty Images realleges and incorporates by reference herein the allegations set\\r\\nforth in paragraphs 1 through 61 above.\\r\\n63. Getty Images is the owner or exclusive licensee of copyrights identified in Exhibit\\r\\nA, and therefore is entitled to the exclusive rights under copyright law associated therewith,\\r\\nincluding the rights set forth in 17 U.S.C \\u00A7 106.\\r\\n64. Getty Images has obtained copyright registrations for each of the works identified\\r\\nin Exhibit A.\\r\\n65. Getty Images is the owner of, and has obtained a copyright registration for, the\\r\\nDatabase.\\r\\n66. Stability AI obtained access to the registered images and the associated titles,\\r\\ncaptions, and other metadata in the Database through Getty Images\\u2019 websites.\\r\\n67. By and through the actions alleged above, Stability AI has infringed and will\\r\\ncontinue to infringe Getty Images\\u2019 copyrights by, inter alia, reproducing Getty Images\\u2019\\r\\ncopyrighted works and creating derivative works therefrom without any authorization from Getty\\r\\nImages.\\r\\n68. Stability AI\\u2019s acts of copyright infringement have been intentional, willful, and in\\r\\ncallous disregard of Getty Images\\u2019 rights. Stability AI knew at all relevant times that the content\\r\\non Getty Images\\u2019 websites is copyrighted, that Getty Images is in the business of licensing visual\\r\\ncontent, and that its acts were in violation of the terms of use of those websites.\\r\\n69. Stability AI engaged in the infringing acts described herein for its own\\r\\ncommercial benefit.\\r\\n\\r\\n70. As a direct and proximate result of Stability AI\\u2019s wrongful conduct, Getty Images\\r\\nhas been substantially and irreparably harmed in an amount not readily capable of determination\\r\\nand, unless permanently enjoined from further acts of infringement and continuing to use and\\r\\ndistribute Stable Diffusion models trained using Getty Images\\u2019 copyrighted content without\\r\\npermission, Stability AI will cause additional irreparable harm for which there is no adequate\\r\\nremedy at law. Getty Images is thus entitled to permanent injunctive relief preventing Stability\\r\\nAI, its agents, affiliates, employees and all persons acting in concert with it from engaging in any\\r\\nfurther infringement of Getty Images\\u2019 content.\\r\\n71. Getty Images is further entitled to recover from Stability AI the damages it has\\r\\nsustained and will sustain as a result of the infringing acts alleged above, together with any\\r\\nadditional profits obtained by Stability AI. The amount of such damages and profits cannot be\\r\\nfully ascertained by Getty Images at present but will be established according to proof at trial.\\r\\n72. For any infringing acts occurring after registration of the applicable Getty Images\\u2019\\r\\ncopyrights, Getty Images is entitled, at its election, as an alternative to an award of actual\\r\\ndamages and any additional profits earned by Stability AI, to recover statutory damages of up to\\r\\n$150,000 for each infringed work.\\r\\n73. Getty Images is entitled to recover its full costs in prosecuting its copyright\\r\\ninfringement claims in this action and its attorneys\\u2019 fees.\\r\\nCLAIM II\\r\\nProviding False Copyright Management Information in Violation of 17 U.S.C. \\u00A7 1202(a)\\r\\n74. Getty Images realleges and incorporates by reference herein the allegations set\\r\\nforth in paragraphs 1 through 73 above.\\r\\n75. The watermarks that Getty Images applies to images made available on its public-\\r\\n\\r\\nfacing websites constitute copyright management information for purposes of Section 1202 of\\r\\nthe Copyright Act, 17 U.S.C. \\u00A7 1202.\\r\\n76. By applying a modified version of Getty Images\\u2019 watermarks to output generated\\r\\nthrough use of Stable Diffusion and the DreamStudio interface, Stability AI has provided false\\r\\ncopyright management information in violation of 17 U.S.C. \\u00A7 1202(a). Stability AI\\u2019s provision\\r\\nof false copyright management information has been done knowingly and with the intent to\\r\\ninduce, enable, facilitate, or conceal infringement of Getty Images\\u2019 copyrights.\\r\\n77. As a direct and proximate result of Stability AI\\u2019s wrongful conduct, Getty Images\\r\\nhas been substantially and irreparably harmed in an amount not readily capable of determination\\r\\nand, unless permanently enjoined from further acts of providing false copyright management\\r\\ninformation, Stability AI will cause additional irreparable harm for which there is no adequate\\r\\nremedy at law. Getty Images is thus entitled to permanent injunctive relief preventing Stability\\r\\nAI, its agents, affiliates, employees and all persons acting in concert with it from providing false\\r\\ncopyright management information.\\r\\n78. Getty Images is further entitled to recover from Stability AI the damages it has\\r\\nsustained and will sustain as a result of the unlawful acts alleged above, together with any\\r\\nadditional profits obtained by Stability AI. The amount of such damages and profits cannot be\\r\\nfully ascertained by Getty Images at present but will be established according to proof at trial.\\r\\n79. Getty Images is entitled, at its election, as an alternative to an award of actual\\r\\ndamages and any additional profits earned by Stability AI, to recover statutory damages of up to\\r\\n$25,000 for each violation of Section 1202(a).\\r\\n80. Getty Images is entitled to recover its full costs and attorneys\\u2019 fees in prosecuting\\r\\nits claims under Section 1202(a).\\r\\n\\r\\nCLAIM III\\r\\nRemoval or Alteration of Copyright Management Information\\r\\nin Violation of Section 1202(b)\\r\\n81. Getty Images realleges and incorporates by reference herein the allegations set\\r\\nforth in paragraphs 1 through 80 above.\\r\\n82. Stability AI has intentionally removed or altered Getty Images\\u2019 watermarks and\\r\\nmetadata associated with the images Stability AI impermissibly copied from Getty Images\\u2019\\r\\nwebsites. Such watermarks and metadata contain copyright management information. Stability\\r\\nAI\\u2019s removal or alteration of Getty Images\\u2019 copyright management information has been done\\r\\nknowingly and with the intent to induce, enable, facilitate, or conceal infringement of Getty\\r\\nImages\\u2019 copyrights.\\r\\n83. As a direct and proximate result of Stability AI\\u2019s wrongful conduct, Getty Images\\r\\nhas been substantially and irreparably harmed in an amount not readily capable of determination\\r\\nand, unless permanently enjoined from further acts of removing or altering copyright\\r\\nmanagement information, Stability AI will cause additional irreparable harm for which there is\\r\\nno adequate remedy at law. Getty Images is thus entitled to permanent injunctive relief\\r\\npreventing Stability AI, its agents, affiliates, employees and all persons acting in concert with it\\r\\nfrom removing or altering Getty Images\\u2019 copyright management information.\\r\\n84. Getty Images is further entitled to recover from Stability AI the damages it has\\r\\nsustained and will sustain as a result of the unlawful acts alleged above, together with any\\r\\nadditional profits obtained by Stability AI. The amount of such damages and profits cannot be\\r\\nfully ascertained by Getty Images at present but will be established according to proof at trial.\\r\\n85. Getty Images is entitled, at its election, as an alternative to an award of actual\\r\\ndamages and any additional profits earned by Stability AI, to recover statutory damages of up to\\r\\n\\r\\n$25,000 for each violation of Section 1202(b).\\r\\n86. Getty Images is entitled to recover its full costs and attorneys\\u2019 fees in prosecuting\\r\\nits claims under Section 1202(b).\\r\\nCLAIM IV\\r\\nTrademark Infringement in Violation of Section 32 of the Lanham Act, 15 U.S.C. \\u00A7 1114(1)\\r\\n87. Getty Images realleges and incorporates by reference herein the allegations set\\r\\nforth in paragraphs 1 through 86 above.\\r\\n88. Getty Images has expended substantial time, money, and resources collecting,\\r\\ndistributing, promoting, marketing, and advertising the millions of images it offers on its\\r\\nwebsites and the Getty Images Marks associated therewith.\\r\\n89. The Getty Images Marks are in full force and effect. Getty Images has never\\r\\nabandoned them, nor has Getty Images ever abandoned the goodwill of its businesses in\\r\\nconnection thereto. For example, Getty Images continues to use and prominently display Getty\\r\\nImages Marks on its websites, as well as on and in connection with the many millions of images\\r\\nit offers. Getty Images intends to continue to preserve and maintain its rights with respect to the\\r\\nGetty Images Marks.\\r\\n90. The Getty Images Marks are distinctive and have become associated in the minds\\r\\nof the public with Getty Images, its brand, and its reputation for high-quality visual content.\\r\\n91. The Getty Images Marks and the goodwill of the business associated with them in\\r\\nthe United States are of great and significant value to Getty Images.\\r\\n92. Getty Images\\u2019 use of the Getty Images Marks and Stability AI\\u2019s infringing uses of\\r\\nthe same marks are in competitive proximity to one another, as they are both used in connection\\r\\nwith, inter alia, the marketplace for visual content.\\r\\n\\r\\n93. Stability AI\\u2019s unauthorized use of Getty Images Marks in connection with synthetic\\r\\nimages generated through the use of Stable Diffusion and DreamStudio constitutes trademark\\r\\ninfringement in violation of Section 32 of the Lanham Act, 15 U.S.C \\u00A7 1114(1), as such use likely\\r\\nhas caused and will continue to cause members of the consuming public to be confused, mistaken\\r\\nor deceived into believing that Getty Images has granted Stability AI the right to use the Getty\\r\\nImages Marks and\\/or that Getty Images sponsored, endorsed, or is otherwise associated, affiliated,\\r\\nor connected with Stability AI and its synthetic images, all to the damage and detriment of Getty\\r\\nImages\\u2019 reputation and good will.\\r\\n94. Upon information and belief, Stability AI is and has been at all relevant times\\r\\naware of Getty Images\\u2019 prior use, and\\/or ownership of the Getty Images Marks. Thus, Stability\\r\\nAI\\u2019s conduct, as described above, is willful, intentional, in bad faith, and designed specifically to\\r\\npermit Stability AI to profit from such misuse in violation of Getty Images\\u2019 rights in the Getty\\r\\nImages Marks.\\r\\n95. As a direct and proximate result of Stability AI\\u2019s wrongful conduct, Getty Images\\r\\nhas been substantially and irreparably harmed in an amount not readily capable of determination\\r\\nand, unless permanently enjoined from further acts of trademark infringement, Stability AI will\\r\\ncause additional irreparable harm for which there is no adequate remedy at law. Getty Images is\\r\\nthus entitled to permanent injunctive relief preventing Stability AI, its agents, affiliates,\\r\\nemployees and all persons acting in concert with it from infringing the Getty Images Marks.\\r\\n96. Getty Images is further entitled to recover from Stability AI the damages it has\\r\\nsustained and will sustain as a result of the unlawful acts alleged above, together with the profits\\r\\nobtained by Stability AI. The amount of such damages and profits cannot be fully ascertained by\\r\\nGetty Images at present but will be established according to proof at trial.\\r\\n\\r\\n97. Getty Images is entitled to recover treble damages or profits, whichever is greater,\\r\\nfor Stability AI\\u2019s use of a counterfeit mark.\\r\\n98. Getty Images is entitled, at its election, as an alternative to an award of actual\\r\\ndamages and profits earned by Stability AI, to recover statutory damages of up to $2,000,000 per\\r\\ncounterfeit mark used.\\r\\n99. Getty Images is entitled to recover its full costs and attorneys\\u2019 fees in prosecuting\\r\\nits claims for trademark infringement.\\r\\nCLAIM V\\r\\nUnfair Competition in Violation of Section 43(a) of the Lanham Act, 15 U.S.C. \\u00A7 1125(a)\\r\\n100. Getty Images realleges and incorporates by reference herein the allegations set forth\\r\\nin paragraphs 1 through 99 above.\\r\\n101. Stability AI\\u2019s unauthorized use of the Getty Images Marks in connection with\\r\\nsynthetic images generated through the use of Stable Diffusion and DreamStudio constitutes\\r\\nunfair competition and false designation of origin in violation of Section 43(a) of the Lanham\\r\\nAct, 15 U.S.C \\u00A7 1125(a), as such use likely has caused and will continue to cause members of the\\r\\nconsuming public to be confused, mistaken or deceived into believing that Getty Images has\\r\\ngranted Stability AI the right to use the Getty Images Marks and\\/or that Getty Images sponsored,\\r\\nendorsed, or is otherwise associated, affiliated, or connected with Stability AI and its synthetic\\r\\nimages, all to the damage and detriment of Getty Images\\u2019 reputation and good will.\\r\\n102. Upon information and belief, Stability AI is and has been at all relevant times\\r\\naware of Getty Images\\u2019 prior use, and\\/or ownership of the Getty Images Marks. Thus, Stability\\r\\nAI\\u2019s conduct, as described above, is willful, intentional, in bad faith, and designed specifically to\\r\\n\\r\\npermit Stability AI to profit from such misuse in violation of Getty Images\\u2019 rights in the Getty\\r\\nImages Marks.\\r\\n103. As a direct and proximate result of Stability AI\\u2019s wrongful conduct, Getty Images\\r\\nhas been substantially and irreparably harmed in an amount not readily capable of determination\\r\\nand, unless permanently enjoined from further acts of trademark infringement, Stability AI will\\r\\ncause additional irreparable harm for which there is no adequate remedy at law. Getty Images is\\r\\nthus entitled to permanent injunctive relief preventing Stability AI, its agents, affiliates,\\r\\nemployees and all persons acting in concert with it from competing unfairly with Getty Images.\\r\\n104. Getty Images is further entitled to recover from Stability AI the damages it has\\r\\nsustained and will sustain as a result of the unlawful acts alleged above, together with the profits\\r\\nobtained by Stability AI. The amount of such damages and profits cannot be fully ascertained by\\r\\nGetty Images at present but will be established according to proof at trial.\\r\\n105. Getty Images is entitled to recover treble damages or profits, whichever is greater,\\r\\nfor Stability AI\\u2019s use of a counterfeit mark.\\r\\n106. Getty Images is entitled, at its election, as an alternative to an award of actual\\r\\ndamages and profits earned by Stability AI, to recover statutory damages of up to $2,000,000 per\\r\\ncounterfeit mark used.\\r\\n107. Getty Images is entitled to recover its full costs and attorneys\\u2019 fees in prosecuting\\r\\nits claims for unfair competition and false designation of origin.\\r\\nCLAIM VI\\r\\nTrademark Dilution in Violation of Section 43(c) of the Lanham Act, 15 U.S.C. \\u00A7 1125(c)\\r\\n108. Getty Images realleges and incorporates by reference herein the allegations set forth\\r\\nin paragraphs 1 through 107 above.\\r\\n\\r\\n109. The Getty Images Marks are distinctive and famous.\\r\\n110. Stability AI has used the Getty Images Marks in commerce, and Stability AI\\u2019s\\r\\ncommercial use of the Getty Images Marks commenced after those marks became famous.\\r\\n111. Stability AI\\u2019s use of the Getty Images Marks on lower quality, and in some cases\\r\\nbizarre or grotesque images, dilutes the quality of the Getty Images Marks by blurring or\\r\\ntarnishment. Upon information and belief, Stability AI\\u2019s use of the Getty Images Marks on\\r\\nlower quality, and in some cases bizarre or grotesque images, has been and continues to be\\r\\nknowing, willful, and in bad faith.\\r\\n112. Stability AI\\u2019s unauthorized use of the Getty Images Marks in connection with\\r\\nlower quality synthetic images generated through the use of Stable Diffusion and DreamStudio\\r\\nconstitutes trademark dilution in violation of Section 43(c) of the Lanham Act, 15 U.S.C \\u00A7\\r\\n1125(c).\\r\\n113. As a direct and proximate result of Stability AI\\u2019s wrongful conduct, Getty Images\\r\\nhas been substantially and irreparably harmed in an amount not readily capable of determination\\r\\nand, unless permanently enjoined from further acts of trademark dilution, Stability AI will cause\\r\\nadditional irreparable harm for which there is no adequate remedy at law. Getty Images is thus\\r\\nentitled to permanent injunctive relief preventing Stability AI, its agents, affiliates, employees\\r\\nand all persons acting in concert with it from diluting the Getty Images Marks.\\r\\n114. Getty Images is further entitled to recover from Stability AI the damages it has\\r\\nsustained and will sustain as a result of the unlawful acts alleged above, together with the profits\\r\\nobtained by Stability AI. The amount of such damages and profits cannot be fully ascertained by\\r\\nGetty Images at present but will be established according to proof at trial.\\r\\n\\r\\n115. Getty Images is entitled to recover its full costs and attorneys\\u2019 fees in prosecuting\\r\\nits claims for trademark dilution.\\r\\nCLAIM VII\\r\\nDeceptive Trade Practices in Violation of Delaware\\u2019s\\r\\nUniform Deceptive Trade Practices Act\\r\\n116. Getty Images realleges and incorporates by reference herein the allegations set\\r\\nforth in paragraphs 1 through 115 above.\\r\\n117. Stability AI\\u2019s unauthorized use of the Getty Images Marks in connection with\\r\\nsynthetic images generated through the use of Stable Diffusion and DreamStudio constitutes a\\r\\ndeceptive trade practice in violation of Delaware law, as such use likely has caused and will\\r\\ncontinue to cause members of the consuming public, including in Delaware, to be confused,\\r\\nmistaken or deceived into believing that Getty Images has granted Stability AI the right to use\\r\\nthe Getty Images Marks and\\/or that Getty Images sponsored, endorsed, or is otherwise\\r\\nassociated, affiliated, or connected with Stability AI and its synthetic images, all to the damage\\r\\nand detriment of Getty Images\\u2019 reputation and good will.\\r\\n118. Upon information and belief, Stability AI is and has been at all relevant times\\r\\naware of Getty Images\\u2019 prior use, and\\/or ownership of the Getty Images Marks. Thus, Stability\\r\\nAI\\u2019s conduct, as described above, is willful, intentional, in bad faith, and designed specifically to\\r\\npermit Stability AI to profit from such misuse in violation of Getty Images\\u2019 rights in the Getty\\r\\nImages Marks.\\r\\n119. As a direct and proximate result of Stability AI\\u2019s wrongful conduct, Getty Images\\r\\nhas been substantially and irreparably harmed in an amount not readily capable of determination\\r\\nand, unless permanently enjoined from further deceptive acts, Stability AI will cause additional\\r\\nirreparable harm for which there is no adequate remedy at law. Getty Images is thus entitled to\\r\\n\\r\\npermanent injunctive relief preventing Stability AI, its agents, affiliates, employees and all\\r\\npersons acting in concert with it from engaging in deceptive trade practices.\\r\\n120. Getty Images is further entitled to recover from Stability AI treble the damages it\\r\\nhas sustained and will sustain as a result of Stability AI\\u2019s acts in violation of Delaware law. The\\r\\namount of such damages cannot be fully ascertained by Getty Images at present but will be\\r\\nestablished according to proof at trial.\\r\\n121. Getty Images is entitled to recover its full costs and attorneys\\u2019 fees in prosecuting\\r\\nits claims for deceptive trade practices.\\r\\nCLAIM VIII\\r\\nTrademark Dilution in Violation of Section 3313 of the Delaware Trademark Act\\r\\n122. Getty Images realleges and incorporates by reference herein the allegations set forth\\r\\nin paragraphs 1 through 121 above.\\r\\n123. The Getty Images Marks are distinctive and famous.\\r\\n124. Stability AI has used the Getty Images Marks in commerce, and Stability AI\\u2019s\\r\\ncommercial use of the Getty Images Marks commenced after those marks became famous.\\r\\n125. Stability AI\\u2019s use of the Getty Images Marks on lower quality, and in some cases\\r\\nbizarre or grotesque images, dilutes the quality of the Getty Images Marks by blurring or\\r\\ntarnishment. Upon information and belief, Stability AI\\u2019s use of Getty Images Marks on lower\\r\\nquality, and in some cases bizarre or grotesque images, has been and continues to be knowing,\\r\\nwillful, and in bad faith.\\r\\n126. Stability AI\\u2019s unauthorized use of the Getty Images Marks in connection with\\r\\nlower quality synthetic images generated through the use of Stable Diffusion and DreamStudio\\r\\nconstitutes trademark dilution in violation of Section 3313 of the Delaware Trademark Act.\\r\\n\\r\\n127. As a direct and proximate result of Stability AI\\u2019s wrongful conduct, Getty Images\\r\\nhas been substantially and irreparably harmed in an amount not readily capable of determination\\r\\nand, unless permanently enjoined from further acts of trademark dilution, Stability AI will cause\\r\\nadditional irreparable harm for which there is no adequate remedy at law. Getty Images is thus\\r\\nentitled to permanent injunctive relief preventing Stability AI, its agents, affiliates, employees\\r\\nand all persons acting in concert with it from diluting the Getty Images Marks.\\r\\nPRAYER FOR RELIEF\\r\\nWHEREFORE, Plaintiff Getty Images respectfully requests judgment in its favor and\\r\\nagainst Defendant Stability AI as follows:\\r\\nA. Finding that Stability AI has infringed Getty Images\\u2019 copyrights;\\r\\nB. Finding that Stability AI\\u2019s copyright infringement was willful;\\r\\nC. Finding that Stability AI has provided false copyright management information;\\r\\nD. Finding that Stability AI has removed or altered copyright management\\r\\ninformation;\\r\\nE. Finding that Stability AI has infringed Getty Images\\u2019 trademarks;\\r\\nF. Finding that Stability AI has diluted Getty Images\\u2019 trademarks;\\r\\nG. Finding that Stability AI has tarnished Getty Images\\u2019 trademarks;\\r\\nH. Finding that Stability AI\\u2019s trademark infringement, unfair competition, trademark\\r\\ndilution, and deceptive trade practices were willful and in bad faith;\\r\\nI. Finding that there is a substantial likelihood that Stability AI will continue to\\r\\ninfringe Getty Images copyrights and trademarks unless enjoined from doing so;\\r\\nJ. Issuing a permanent injunction enjoining Stability AI and its agents, servants,\\r\\nemployees, successors and assigns, and all persons, firms and corporations acting\\r\\n\\r\\nin concert with it, from directly or indirectly infringing Getty Images\\u2019 copyrights,\\r\\nfrom providing false copyright management information, from removing or\\r\\naltering Getty Images\\u2019 copyright management information, and from infringing,\\r\\ndiluting, or tarnishing Getty Images\\u2019 trademarks;\\r\\nK. Ordering the destruction of all versions of Stable Diffusion trained using Getty\\r\\nImages\\u2019 content without permission;\\r\\nL. Ordering Stability AI to provide a full and complete accounting to Getty Images\\r\\nfor Stability AI\\u2019s profits, gains, advantages, and the value of the business\\r\\nopportunities received from its infringing acts;\\r\\nM. Entering judgment for Getty Images against Stability AI for all damages suffered\\r\\nby Getty Images and for any profits to or gain by Stability AI attributable to its\\r\\ninfringement of Getty Images\\u2019 copyrights and its acts in violation of 17 U.S.C.\\r\\n\\u00A7 1202\\r\\nN. Entering judgment for Getty Images against Stability AI for all damages suffered\\r\\nby Getty Images for any profits to or gain by Stability AI attributable to its\\r\\ninfringement and dilution of Getty Images trademark and its unfair competition\\r\\nand deceptive trade practices in amounts to be determined at trial, with the greater\\r\\nof such damages and profits trebled;\\r\\nO. Entering judgment for Getty Images for statutory damages for Stability AI\\u2019s\\r\\nwillful acts of copyright infringement, its provision of false copyright\\r\\nmanagement information, and its removal or alteration of Getty Images\\u2019 copyright\\r\\nmanagement information;\\r\\n\\r\\nP. Entering judgment for Getty Images for statutory damages for Stability AI\\u2019s\\r\\nwillful acts of trademark infringement and unfair competition;\\r\\nQ. Awarding Getty Images its costs and reasonable attorneys\\u2019 fees;\\r\\nR. Awarding Getty Images pre-judgment and post-judgment interest to the fullest\\r\\nextent available; and\\r\\nS. Granting such other and further relief as the Court deems just and proper.\\r\\nDEMAND FOR JURY TRIAL\\r\\nPlaintiff Getty Images demands a trial by jury on all issues so triable.\\r\\nDated: February 3, 2023\\r\\nOF COUNSEL:\\r\\nWEIL, GOTSHAL & MANGES LLP\\r\\nBenjamin E. Marks (pro hac vice application\\r\\nforthcoming)\\r\\nJared R. Friedmann (pro hac vice application\\r\\nforthcoming)\\r\\nMelissa Rutman (pro hac vice application\\r\\nforthcoming)\\r\\n767 Fifth Avenue\\r\\nNew York, New York 10153\\r\\n(212) 310-8000\\r\\nbenjamin.marks@weil.com\\r\\njared.friedmann@weil.com\\r\\nmelissa.rutman@weil.com\\r\\nYOUNG CONAWAY STARGATT &\\r\\nTAYLOR, LLP\\r\\n\\/s\\/ Tammy L. Mercer\\r\\nTammy L. Mercer (No. 4957)\\r\\nRobert M. Vrana (No. 5666)\\r\\n1000 North King Street\\r\\nWilmington, Delaware 19801\\r\\n(302) 571-6600\\r\\ntmercer@ycst.com\\r\\nrvrana@ycst.com\\r\\nAttorneys for Plaintiff Getty Images (US),\\r\\nInc.\\n==============\\nIN THE UNITED STATES DISTRICT COURT\\r\\nFOR THE DISTRICT OF DELAWARE\\r\\nGETTY IMAGES (US), INC.,\\r\\nPlaintiff,\\r\\nv.\\r\\nSTABILITY AI, LTD. and\\r\\nSTABILITY AI, INC.,\\r\\nDefendants.\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\n)\\r\\nC.A. No. 23-135 (GBW)\\r\\nDEFENDANTS\\u2019 OPENING BRIEF IN SUPPORT OF THEIR\\r\\nMOTION TO DISMISS OR TRANSFER THIS ACTION\\r\\nOF COUNSEL:\\r\\nNicole M. Jantzi\\r\\nPaul M. Schoenhard\\r\\nFRIED, FRANK, HARRIS, SHRIVER\\r\\n& JACOBSON LLP\\r\\n801 17th Street, NW\\r\\nWashington, DC 20006\\r\\n(202) 639-7000\\r\\nAmir R. Ghavi\\r\\nMichael C. Keats\\r\\nNicholas D. Winkley\\r\\nFRIED, FRANK, HARRIS, SHRIVER\\r\\n& JACOBSON LLP\\r\\nOne New York Plaza\\r\\nNew York, New York 10004\\r\\n(212) 859-8000\\r\\nMORRIS, NICHOLS, ARSHT & TUNNELL LLP\\r\\nJack B. Blumenfeld (#1014)\\r\\nMichael J. Flynn (#5333)\\r\\n1201 N. Market Street\\r\\nP.O. Box 1347\\r\\nWilmington, DE 19801\\r\\n(302) 658-9200\\r\\njblumenfeld@morrisnichols.com\\r\\nmflynn@morrisnichols.com\\r\\nAttorneys for Defendants Stability AI, Inc. and\\r\\nStability AI Ltd.\\r\\nMay 2, 2023\\r\\n\\r\\nTABLE OF CONTENTS\\r\\nTable of Authorities ........................................................................................................................ ii\\r\\nNature and Stage of the Proceeding .................................................................................................1\\r\\nSummary of Argument ....................................................................................................................1\\r\\nStatement of Facts ............................................................................................................................3\\r\\nArgument .........................................................................................................................................4\\r\\nI. This Court Lacks Personal Jurisdiction Over Stability UK. ................................................4\\r\\nA. Delaware\\u2019s Long-Arm Statute Does Not Provide a Basis for Personal\\r\\nJurisdiction Over Stability UK.................................................................................5\\r\\nB. Stability UK is Not Subject to General Jurisdiction in Delaware............................7\\r\\nC. Stability UK is Not Subject to Specific Jurisdiction in Delaware. ........................10\\r\\nD. The Federal Long-Arm Statute Does Not Provide a Basis for Personal\\r\\nJurisdiction Over Stability UK...............................................................................11\\r\\nII. Stability UK is a Necessary and Indispensable Party. .......................................................13\\r\\nIII. This Court Should Dismiss this Case for Failure to State a Claim. ...................................15\\r\\nIV. This Court Should Transfer this Case to the Northern District of California\\r\\nPursuant to 28 U.S.C. \\u00A7 1631. ............................................................................................16\\r\\nV. This Court Should Alternatively Transfer This Case to the Northern District of\\r\\nCalifornia Pursuant to 28 U.S.C. \\u00A7 1404(a). ......................................................................17\\r\\nA. The \\u00A7 1404(a) Factors Overwhelmingly Favor Transfer. ......................................17\\r\\nConclusion .....................................................................................................................................20\\r\\nTABLE OF AUTHORITIES\\r\\nCases Page(s)\\r\\nAdtile Techs. Inc. v. Perion Network Ltd.,\\r\\n192 F. Supp. 3d 515 (D. Del. 2016) ...................................................................................11, 12\\r\\nAdverio Pharma GmbH v. Alembic Pharms. Ltd.,\\r\\nNo. 18-73-LPS, 2019 WL 581618 (D. Del. Feb. 13, 2019).....................................................16\\r\\nArcelik, A.S. v. E.I. Du Pont de Nemours & Co.,\\r\\nNo. 15-961-LPS, 2016 WL 5719681 (D. Del. Sept. 29, 2016) ...............................................14\\r\\nAvocent Huntsville Corp. v. Aten Int\\u2019l Co.,\\r\\n552 F.3d 1324 (Fed. Cir. 2008)................................................................................................13\\r\\nBaker v. Wehinger,\\r\\nNo. 18-5800-DMG, 2021 WL 1573820 (C.D. Cal. Mar. 5, 2021) ..........................................13\\r\\nBlair v. Infineon Techs. AG,\\r\\n720 F. Supp. 2d 462 (D. Del. 2010) ...........................................................................................8\\r\\nBrit. Telecomms, PLC v. IAC\\/InteractiveCorp,\\r\\n356 F. Supp. 3d 405 (D. Del. 2019) .........................................................................................15\\r\\nBurger King Corp. v. Rudzewicz,\\r\\n471 U.S. 462 (1985) .................................................................................................................10\\r\\nCFMT Inc. v. Steag Microtech, Inc.,\\r\\nNo. 95-442-LON, 1997 WL 313161 (D. Del. Jan. 9, 1997) ....................................................12\\r\\nChristianson v. Colt Indus. Operating Corp.,\\r\\n486 U.S. 800 (1988) .................................................................................................................16\\r\\nCommisseriat A L\\u2019Energie Atomique v. Chi Mei Optoelectronics Corp.,\\r\\n293 F. Supp. 2d 423 (D. Del. 2003), vacated on other grounds by 395 F.3d\\r\\n1315 (Fed. Cir. 2005) ...............................................................................................................12\\r\\nCont\\u2019l Grain Co. v. The FBL-585,\\r\\n364 U.S. 19 (1960) ...................................................................................................................19\\r\\nDaimler AG v. Bauman,\\r\\n571 U.S. 117 (2014) ...............................................................................................................6, 7\\r\\nD\\u2019Jamoos ex rel. Est. of Weingeroff v. Pilatus Aircraft Ltd.,\\r\\n566 F.3d 94 (3d Cir. 2009).......................................................................................................16\\r\\nEurofins Pharma U.S. Holdings v. BioAlliance Pharma SA,\\r\\n623 F.3d 147 (3d Cir. 2010).......................................................................................................6\\r\\nFord Motor Co. v. Montana Eighth Jud. Dist. Ct.,\\r\\n141 S. Ct. 1017 (2021) ...............................................................................................................7\\r\\nFreeman v. Nw. Acceptance Corp.,\\r\\n754 F.2d 553 (5th Cir. 1985) ...................................................................................................14\\r\\nFunai Elec. Co. v. Personalized Media Commc\\u2019ns, LLC,\\r\\nNo. 15-558-RGA, 2016 WL 370708 (D. Del. Jan. 29, 2016)....................................................5\\r\\nGen. Sci. Corp. v. Den-Mat Holdings, LLC,\\r\\nNo. 21-882-CFC, 2021 WL 4622548 (D. Del. Oct. 7, 2021) ..................................................20\\r\\nGoodyear Dunlop Tires Operations, S.A. v. Brown,\\r\\n564 U.S. 915 (2011) ...................................................................................................................8\\r\\nHall v. Nat\\u2019l Serv. Indus., Inc.,\\r\\n172 F.R.D. 157 (E.D. Pa. 1997) ...............................................................................................14\\r\\nHanson v. Denckla,\\r\\n357 U.S. 235 (1958) .................................................................................................................10\\r\\nHenderson v. United States Off. of Pers. Mgmt.,\\r\\n844 F. App\\u2019x 551 (3d Cir. 2021) .............................................................................................16\\r\\nIn re: Howmedica Osteonics Corp,\\r\\n867 F.3d 390 (3d Cir. 2017)...............................................................................................17, 20\\r\\nIM2 Merch. & Mfg., Inc. v. Tirex Corp.,\\r\\nNo. 18077, 2000 WL 1664168 (Del. Ch. Nov. 2, 2000) ...........................................................8\\r\\ninno360, Inc. v. Zakta, LLC,\\r\\n50 F. Supp. 3d 587 (D. Del. 2014) .......................................................................................5, 10\\r\\nInternational Shoe Co. v. Washington,\\r\\n326 U.S. 310 (1945) ...................................................................................................................5\\r\\nIsland Insteel Sys., Inc. v. Waters,\\r\\n296 F.3d 200 (3d Cir. 2002).....................................................................................................16\\r\\nJapan Petroleum Co. (Nigeria) v. Ashland Oil, Inc.,\\r\\n456 F. Supp. 831 (D. Del. 1978) ..............................................................................................15\\r\\nJumara v. State Farm Ins. Co.,\\r\\n55 F.3d 873 (3d Cir. 1995).......................................................................................................17\\r\\nJurimex Kommerz Transit G.m.b.H. v. Case Corp.,\\r\\n201 F.R.D. 337 (D. Del. 2001), aff\\u2019d, 65 F. App\\u2019x 803 (3d Cir. 2003)...................................14\\r\\nM2M Sols. LLC v. Telit Commc\\u2019ns PLC,\\r\\nNo. 14-1103-RGA, 2015 WL 4640400 (D. Del. Aug. 5, 2015) ..............................................16\\r\\nMartinez v. E.I. DuPont de Nemours & Co.,\\r\\n82 A.3d 1 (Del. Super. Ct. 2012), aff\\u2019d, 86 A.3d 1102 (Del. 2014) ........................................14\\r\\nMemory Integrity, LLC v. Intel Corp.,\\r\\nNo. 13-1804 GMS, 2015 WL 632026 (D. Del. Feb. 13, 2015) ...............................................18\\r\\nMetro-Goldwyn-Mayer Studious, Inc. v. Grokster, Ltd.,\\r\\n545 U.S. 913 (2005) .................................................................................................................11\\r\\nMonsanto Co. v. Syngenta Seeds, Inc.,\\r\\n443 F. Supp. 2d 636 (D. Del. 2006) ...................................................................................11, 12\\r\\nO\\u2019Connor v. Sandy Lane Hotel Co.,\\r\\n496 F.3d 312 (3d Cir. 2007).......................................................................................................5\\r\\nPearson v. Component Tech. Corp.,\\r\\n247 F.3d 471 (3d Cir. 2001)...................................................................................................8, 9\\r\\nProvident Tradesmens Bank & Tr. Co. v. Patterson,\\r\\n390 U.S. 102 (1968) .................................................................................................................14\\r\\nReach & Assocs., P.C. v. Dencer,\\r\\n269 F. Supp. 2d 497 (D. Del. 2003) ...........................................................................................6\\r\\nRegistered Agents, Ltd. v. Registered Agent, Inc.,\\r\\n880 F. Supp. 2d 541 (D. Del. 2012) .......................................................................................5, 7\\r\\nRuhrgas AG v. Marathon Oil Co.,\\r\\n526 U.S. 574 (1999) ...................................................................................................................4\\r\\nSebastian Brown Prods., LLC v. Muzooka Inc.,\\r\\nNo. 14-009-SLR, 2015 WL 1467255 (D. Del. Mar. 30, 2015) ...............................................11\\r\\nShoemaker v. McConnell,\\r\\n556 F. Supp. 2d 351 (D. Del. 2008) ...........................................................................................6\\r\\nSmart Audio Techs., LLC v. Apple, Inc.,\\r\\n910 F. Supp. 2d 718 (D. Del. 2012) .........................................................................................19\\r\\nSony Corp. v. Pace PLC,\\r\\nNo. 15-288-SLR, 2016 WL 593455 (D. Del. Feb. 12, 2016) ..................................................12\\r\\nT-Jat Sys. 2006 Ltd. v. Expedia, Inc. (DE),\\r\\nNo. 16-581-RGA-MPT, 2017 WL 896988 (D. Del. Mar. 7, 2017) .....................................9, 15\\r\\nTelcordia Techs., Inc. v. Alcatel S.A.,\\r\\nNo. 04-874-GMS, 2005 WL 1268061 (D. Del. May 27, 2005) ..............................................12\\r\\nTeleconference Sys. v. Proctor & Gamble Pharms., Inc.,\\r\\n676 F. Supp. 2d 321 (D. Del. 2009) .........................................................................................18\\r\\nTime Share Vacation Club v. Atl. Resorts, Ltd.,\\r\\n735 F.2d 61 (3d Cir. 1984).........................................................................................................5\\r\\nToys \\u201CR\\u201D Us, Inc. v. Step Two, S.A.,\\r\\n318 F.3d 446 (3d Cir. 2003).....................................................................................................10\\r\\nTractenberg v. Marriott Int\\u2019l, Inc.,\\r\\nNo. 21-1002-SB, 2021 WL 5299823 (D. Del. Nov. 15, 2021)..................................................8\\r\\nTrustees of Nat. Elevator Indus. Pension, Health Benefit & Educ. Funds v. Lutyk,\\r\\n332 F.3d 188 (3d Cir. 2003).......................................................................................................8\\r\\nUnited States v. Bestfoods,\\r\\n524 U.S. 51 (1998) ...............................................................................................................9, 15\\r\\nWalden v. Fiore,\\r\\n571 U.S. 277 (2014) ...................................................................................................................7\\r\\nWilson v. The Canada Life Assur. Co.,\\r\\nNo. 08-1258, 2009 WL 532830 (M.D. Pa. Mar. 3, 2009) .......................................................13\\r\\nStatutes\\r\\n10 Del. C. \\u00A7 3104 (c)(1)\\u2013(4) ............................................................................................................6\\r\\n28 U.S.C. \\u00A7 1404(a) .......................................................................................................1, 17, 19, 20\\r\\n28 U.S.C. \\u00A7 1631 ........................................................................................................................1, 16\\r\\n\\r\\nNATURE AND STAGE OF THE PROCEEDING\\r\\nOn February 3, 2023, Plaintiff Getty Images (US), Inc. (\\u201CGetty\\u201D) filed this action for\\r\\ncopyright and trademark infringement, among other claims, against Defendant Stability AI, Inc.\\r\\n(\\u201CStability US\\u201D). On March 29, 2023, Getty amended its Complaint to add Stability AI Ltd.\\r\\n(\\u201CStability UK\\u201D) as a defendant. D.I. 13 (\\u201CAm. Compl.\\u201D). Stability UK and Stability US now move\\r\\nthis Court to dismiss the Amended Complaint for lack of personal jurisdiction, for inability to join\\r\\na necessary and indispensable party, and for failure to state a claim upon which relief can be\\r\\ngranted. Alternatively, Stability UK and Stability US move to transfer this case to the Northern\\r\\nDistrict of California under 28 U.S.C. \\u00A7 1631 or \\u00A7 1404(a).\\r\\nSUMMARY OF ARGUMENT\\r\\nThis lawsuit does not belong in Delaware. First, there is no personal jurisdiction over\\r\\nStability UK, a necessary and indispensable party. As the Amended Complaint alleges, Stability\\r\\nUK is organized under the laws of the United Kingdom, maintains its principal place of business\\r\\nin London, England, and has no offices or personnel in Delaware. All of the allegations of\\r\\ninfringement based on the training of Stable Diffusion on Getty\\u2019s images occurred outside\\r\\nDelaware. Getty fully recognizes that it cannot establish personal jurisdiction over Stability UK,\\r\\nunderscored by its initial decision to name only Stability US, Stability UK\\u2019s corporate parent, as a\\r\\ndefendant in this action. It was only after Stability US informed Getty\\u2019s counsel that it intended\\r\\nto move to dismiss on the grounds that Stability UK was a necessary and indispensable party that\\r\\nGetty named Stability UK as an additional defendant.\\r\\nBut Getty cannot cure its failure to name a necessary and indispensable party by naming a\\r\\nparty over which there is no personal jurisdiction. The Amended Complaint does not allege any\\r\\nfacts tying Stability UK to Delaware. The mere fact that Stability US, a Delaware holding\\r\\ncompany, is Stability UK\\u2019s corporate parent plainly does not confer personal jurisdiction over\\r\\n\\r\\nStability UK\\u2014and Getty does not contend otherwise. Instead, the Amended Complaint asserts\\r\\nthat Stability UK and Stability US are alter egos, and therefore can be treated as a single enterprise\\r\\nfor jurisdictional and pleading purposes. But Getty has failed to allege any facts beyond mere\\r\\ncorporate ownership and overlapping senior management common to virtually every\\r\\nparent-subsidiary relationship, and those facts are insufficient as a matter of law to establish that\\r\\nStability US and Stability UK are alter egos. Simply put, the claims against Stability UK should\\r\\nbe dismissed for lack of personal jurisdiction pursuant to Fed. R. Civ. P. 12(b)(2).\\r\\nSecond, Stability UK remains a necessary and indispensable party to this action, even\\r\\nthough this Court lacks personal jurisdiction over it. Getty\\u2019s belated decision to name Stability\\r\\nUK as an additional defendant in its Amended Complaint only confirms this fact. The claims\\r\\nagainst Stability US therefore should also be dismissed pursuant to Fed. R. Civ. P. 12(b)(7) because\\r\\nStability UK cannot be joined in this action.\\r\\nThird, the Amended Complaint suffers from another fatal defect. In its zeal to bolster its\\r\\nbaseless alter ego theory, Getty has lumped Stability US and Stability UK together and made\\r\\nimpermissible group-pleading allegations as to \\u201CStability AI.\\u201D Under settled law, such \\u201Cshotgun\\u201D\\r\\npleading does not satisfy the requirements of Fed. R. Civ. P. 8(a), and the Amended Complaint\\r\\nshould be dismissed under Fed. R. Civ. P. 12(b)(6).\\r\\nFinally, although dismissal is warranted and appropriate, under settled law, this Court can\\r\\ntransfer this case to the Northern District of California, where a previously filed class action is\\r\\npending against both Stability US and Stability UK that arises from substantially the same facts\\r\\nand circumstances and presents identical issues of law\\u2014making transfer both in the interests of\\r\\njudicial economy, and necessary to avoid subjecting Stability US and Stability UK to the risk of\\r\\ninconsistent judgments. As detailed below, more than 20% of Stability UK\\u2019s U.S.-based\\r\\n\\r\\nworkforce resides in California (while none reside in Delaware), and Stability UK and Stability\\r\\nUS have consented to personal jurisdiction in the Northern District of California. Meanwhile, the\\r\\nNorthern District of California is plainly convenient for Getty because Getty maintains its\\r\\nheadquarters on the west coast and has a significant presence in California. Getty has no such\\r\\nconnections to Delaware.\\r\\nSTATEMENT OF FACTS\\r\\nStability US and Stability UK1\\r\\nThe Amended Complaint alleges that Defendant Stability US is a Delaware holding\\r\\ncompany. Am. Compl. \\u00B6 14; O\\u2019Donoghue Decl. \\u00B6 4. Stability US owns a subsidiary, Stability UK,\\r\\nwhich is a limited company formed under the laws of the United Kingdom. Am. Compl. \\u00B6\\u00B6 15, 19;\\r\\nO\\u2019Donoghue Decl. \\u00B6 5. Neither Stability US nor Stability UK has any offices or employees located\\r\\nin Delaware. O\\u2019Donoghue Decl. \\u00B6\\u00B6 11, 14. Stability US is the corporate vehicle through which\\r\\ninvestors and financing sources have provided capital. Id. \\u00B6 13.\\r\\nFounded in 2019, Stability UK operates the DreamStudio platform and has been involved\\r\\nwith the ongoing development of Stable Diffusion, an open-source generative imaging artificial\\r\\nintelligence (\\u201CAI\\u201D) technology. Id. \\u00B6 6.\\r\\nTo avoid the clear absence of jurisdiction over Stability UK in Delaware, Getty baldly\\r\\nalleges that Stability US and Stability UK \\u201Care alter egos of one another and operate as a single\\r\\nenterprise.\\u201D Am. Compl. \\u00B6 15. In support of this allegation, Getty relies on facts common to parent-\\r\\nsubsidiary relationships, such as common ownership and control. Id. \\u00B6\\u00B6 18\\u201320.\\r\\n1 Accompanying this motion is the Declaration of Peter O\\u2019Donoghue, dated May 2, 2023\\r\\n(\\u201CO\\u2019Donoghue Declaration\\u201D). All citations to \\u201CEx.\\u201D herein refer to the exhibits to the O\\u2019Donoghue\\r\\nDeclaration. Unless otherwise noted herein, all citations and internal quotation marks are omitted,\\r\\nand all alterations and emphases in quoted materials are added.\\r\\n\\r\\nThe Prior-Filed California Class Action\\r\\nOn January 13, 2023, three plaintiffs filed a lawsuit against both Stability US and Stability\\r\\nUK in the Northern District of California (the \\u201CClass Action\\u201D). See O\\u2019Donoghue Decl. \\u00B6 17, Ex. A.\\r\\nThe plaintiffs in the Class Action purport to represent a nationwide putative class, including all\\r\\ncopyright owners of images that were used to train Stable Diffusion. The class plaintiffs allege,\\r\\namong other things, that Stability UK and Stability US infringed plaintiffs\\u2019 copyrights by using\\r\\nthose images to train Stable Diffusion without their authorization. The Class Action seeks\\r\\nmonetary damages and injunctive relief and asserts claims under the Copyright Act, the DMCA,\\r\\nthe Lanham Act, and various California state laws.\\r\\nGetty\\u2019s U.K. and Delaware Actions\\r\\nOn January 16, 2023, Getty Images (UK), Ltd. commenced a pre-filing procedure against\\r\\nStability UK asserting claims for copyright infringement and related claims under the laws of the\\r\\nUnited Kingdom, based on Stability UK\\u2019s alleged training and release of Stable Diffusion. The\\r\\nfollowing month, on February 3, 2023, Getty Images (US) Inc. filed this suit against Stability US\\u2014\\r\\nbut not against Stability UK. D.I. 1. After conferring with Stability US and Stability UK\\u2019s counsel,\\r\\nGetty amended its complaint to add Stability UK as a defendant. Like the Class Action, Getty\\r\\nalleges that \\u201CStability AI\\u201D infringed Getty\\u2019s copyrighted images by using photographs from\\r\\nGetty\\u2019s online image database while training Stable Diffusion. Getty similarly seeks damages and\\r\\ninjunctive relief under the Copyright Act, the DMCA, and the Lanham Act.\\r\\nARGUMENT\\r\\nI. This Court Lacks Personal Jurisdiction Over Stability UK.\\r\\nPersonal jurisdiction is an \\u201Cessential element\\u201D of a court\\u2019s ability to hear a case, \\u201Cwithout\\r\\nwhich the court is powerless to proceed to an adjudication.\\u201D Ruhrgas AG v. Marathon Oil Co.,\\r\\n526 U.S. 574, 584 (1999). Getty bears the burden of establishing, with particularity, that sufficient\\r\\n\\r\\nminimum contacts exist between Stability UK and Delaware to support personal jurisdiction here.\\r\\nRegistered Agents, Ltd. v. Registered Agent, Inc., 880 F. Supp. 2d 541, 544 (D. Del. 2012); see\\r\\nO\\u2019Connor v. Sandy Lane Hotel Co., 496 F.3d 312, 316 (3d Cir. 2007). To do so, Getty cannot rely\\r\\non the bare pleadings alone, but \\u201Cmust sustain its burden of proof in establishing jurisdictional\\r\\nfacts through sworn affidavits or other competent evidence.\\u201D Time Share Vacation Club v. Atl.\\r\\nResorts, Ltd., 735 F.2d 61, 66 n.9 (3d Cir. 1984); Registered Agents, Ltd., 880 F. Supp. 2d at 544.\\r\\nTo establish personal jurisdiction, Getty must establish facts sufficient to satisfy both\\r\\nstatutory and constitutional requirements. See, e.g., inno360, Inc. v. Zakta, LLC, 50 F. Supp. 3d\\r\\n587, 592 (D. Del. 2014). First, Getty must establish a statutory basis for jurisdiction under\\r\\nDelaware\\u2019s long-arm statute. Id. Second, Getty must establish that the exercise of jurisdiction\\r\\ncomports with constitutional due process. Id.; see International Shoe Co. v. Washington, 326 U.S.\\r\\n310, 316 (1945). Getty has failed to do either.\\r\\nA. Delaware\\u2019s Long-Arm Statute Does Not Provide a Basis for\\r\\nPersonal Jurisdiction Over Stability UK.\\r\\nDelaware\\u2019s long-arm statute \\u201Chas been broadly construed to confer jurisdiction to the\\r\\nmaximum extent possible under the Due Process Clause,\\u201D but Delaware Courts have made clear\\r\\nthat \\u201Cthe personal jurisdictional analysis must not be collapsed into a single constitutional inquiry.\\u201D\\r\\nFunai Elec. Co. v. Personalized Media Commc\\u2019ns, LLC, No. 15-558-RGA, 2016 WL 370708, at\\r\\n*2 (D. Del. Jan. 29, 2016). Therefore, if Getty \\u201Ccannot satisfy the statutory basis for personal\\r\\njurisdiction, the court need not reach the constitutional due process prong of the personal\\r\\njurisdiction analysis.\\u201D Registered Agents, Ltd., 880 F. Supp. 2d at 547.\\r\\nDelaware\\u2019s long-arm statute provides for the exercise of personal jurisdiction over any\\r\\nnonresident who in person or through an agent: (1) \\u201CTransacts any business or performs any\\r\\ncharacter of work or service in the State\\u201D; (2) \\u201CContracts to supply services or things in this State\\u201D;\\r\\n\\r\\n(3) \\u201CCauses tortious injury in the State by an act or omission in this State\\u201D; or (4) \\u201CCauses tortious\\r\\ninjury in the State or outside of the State by an act or omission outside the State if the person\\r\\nregularly does or solicits business, engages in any other persistent course of conduct in the State\\r\\nor derives substantial revenue from services, or things used or consumed in the State.\\u201D 10 Del. C.\\r\\n\\u00A7 3104 (c)(1)\\u2013(4). Courts in this District have held that the long-arm statute requires a showing of\\r\\nspecific jurisdiction (other than with respect to (c)(4), which relates to general jurisdiction). See\\r\\nShoemaker v. McConnell, 556 F. Supp. 2d 351, 354\\u201355 (D. Del. 2008).\\r\\nHere, Getty has not even attempted to plead a statutory basis for jurisdiction under\\r\\nDelaware\\u2019s long-arm statute. Getty does not allege that any of the purportedly infringing acts\\r\\nregarding training Stable Diffusion occurred within Delaware. Reach & Assocs., P.C. v. Dencer,\\r\\n269 F. Supp. 2d 497, 503 (D. Del. 2003) (\\u201CIn order for a court to exercise jurisdiction under\\r\\nSubsections (c)(1) and (c)(3), some act must actually occur in Delaware.\\u201D). Rather, although the\\r\\nAmended Complaint is vague in this regard, Getty appears to allege that the training took place in\\r\\nEngland and Germany. See, e.g., Am. Compl. \\u00B6\\u00B6 48 (\\u201CStable Diffusion was trained . . . from\\r\\nDatasets prepared by non-party LAION, a German entity . . .\\u201D); 18 (\\u201CStability [US] and Stability\\r\\n[UK] . . . are located at the same physical London address . . .\\u201D). Getty also does not allege that\\r\\nStability UK contracted to supply services or things in Delaware. See Eurofins Pharma U.S.\\r\\nHoldings v. BioAlliance Pharma SA, 623 F.3d 147, 157 (3d Cir. 2010) (holding that subsection\\r\\n(c)(2) of the Delaware long-arm statute requires that service contracts must be for services\\r\\nperformed in Delaware). Section 3104(c)(4) likewise is not a basis for exercising jurisdiction\\r\\nbecause Stability UK is not subject to general jurisdiction in Delaware, as discussed further below.2\\r\\n2 To the extent that Section 3104(c)(4) purports to grant general jurisdiction based solely on\\r\\na company\\u2019s continuous and regular business contacts with Delaware, this Section would clearly\\r\\nviolate the constitutional limitations identified by the Supreme Court. See Daimler AG v. Bauman,\\r\\n\\r\\nBecause Getty has failed to plead any facts supporting personal jurisdiction over Stability\\r\\nUK under Delaware\\u2019s long-arm statute, this Court should dismiss the claims against Stability UK\\r\\nfor lack of personal jurisdiction. See Registered Agents, Ltd., 880 F. Supp. 2d at 547.\\r\\nB. Stability UK is Not Subject to General Jurisdiction in Delaware.\\r\\nIn addition to lacking any statutory basis for exercising personal jurisdiction over Stability\\r\\nUK, Getty also cannot establish that exercising jurisdiction comports with the U.S. Constitution.\\r\\nThe two routes to establishing personal jurisdiction under the U.S. Constitution are general and\\r\\nspecific jurisdiction. Ford Motor Co. v. Montana Eighth Jud. Dist. Ct., 141 S. Ct. 1017, 1024\\r\\n(2021). General jurisdiction exists where a defendant\\u2019s \\u201Caffiliations with the State are so\\r\\n\\u2018continuous and systematic\\u2019 as to render them essentially at home in the forum State.\\u201D Daimler\\r\\nAG, 571 U.S. at 127 (quoting Goodyear Dunlop Tires Operations, S.A. v. Brown, 564 U.S. 915,\\r\\n919 (2011)). Specific jurisdiction, on the other hand, \\u201C\\u2018focuses on the relationship among the\\r\\ndefendant, the forum, and the litigation\\u2019\\u201D rather than \\u201Cthe defendant\\u2019s contacts with persons who\\r\\nreside there.\\u201D Walden v. Fiore, 571 U.S. 277, 284\\u201385 (2014) (quoting Keeton v. Hustler Magazine,\\r\\nInc., 465 U.S. 770, 775 (1984)).\\r\\nGetty concedes, as it must, that Stability UK is not \\u201Cat home\\u201D in Delaware. Daimler AG,\\r\\n571 U.S. at 127. \\u201CStability AI, Ltd. is a UK corporation with headquarters in London, UK.\\u201D Am.\\r\\nCompl. \\u00B6 15. And Getty does not allege that this is an \\u201Cexceptional case\\u201D where Stability UK\\u2019s\\r\\noperations in Delaware are \\u201Cso substantial and of such a nature as to render\\u201D it subject to general\\r\\npersonal jurisdiction in the State. Daimler AG, 571 U.S. at 139 n.19.\\r\\nMoreover, the fact that Stability UK\\u2019s parent company, Stability US, is incorporated in\\r\\nDelaware does not change the analysis. It is settled that a parent company\\u2019s forum contacts are\\r\\n571 U.S. 117, 127 (2014) (holding that even \\u201Ca substantial, continuous, and systematic course of\\r\\nbusiness\\u201D cannot support the exercise of general personal jurisdiction).\\r\\n\\r\\nnot imputed to its subsidiary. See Goodyear Dunlop Tires, 564 U.S. at 921 (holding that there was\\r\\nno personal jurisdiction over three foreign subsidiaries of a US-based parent company); IM2\\r\\nMerch. & Mfg., Inc. v. Tirex Corp., No. 18077, 2000 WL 1664168, at *4 n.15 (Del. Ch. Nov. 2,\\r\\n2000) (holding that the mere fact that a parent is incorporated in Delaware is insufficient to confer\\r\\njurisdiction over a non-Delaware subsidiary). Indeed, that theory of personal jurisdiction has been\\r\\nsquarely rejected in this Court. See Tractenberg v. Marriott Int\\u2019l, Inc., No. 21-1002-SB, 2021 WL\\r\\n5299823, at *1 (D. Del. Nov. 15, 2021) (\\u201CWe cannot travel from a Delaware parent to a foreign\\r\\nsubsidiary\\u201D) (emphasis in original).\\r\\nFinally, Getty\\u2019s attempt to overcome its jurisdictional shortcomings by relying on an alter\\r\\nego theory fails. For one, Getty has not attempted to allege that Stability US and Stability UK\\r\\nhave structured their corporate affairs in order to perpetrate a fraud on Getty or anyone else, much\\r\\nless demonstrate this alter ego relationship by clear and convincing evidence. See Blair v. Infineon\\r\\nTechs. AG, 720 F. Supp. 2d 462, 470 (D. Del. 2010) (\\u201CThis court has required an element of\\r\\nfraudulent intent in its alter ego test\\u201D); Trustees of Nat. Elevator Indus. Pension, Health Benefit &\\r\\nEduc. Funds v. Lutyk, 332 F.3d 188, 194 (3d Cir. 2003) (\\u201CAlter ego . . . must be shown by clear\\r\\nand convincing evidence\\u201D). For another, Getty does not allege any facts to satisfy the high\\r\\nstandards required to establish that separate companies are alter egos. See Pearson v. Component\\r\\nTech. Corp., 247 F.3d 471, 484\\u201385 (3d Cir. 2001) (noting that courts consider whether there is\\r\\n\\u201Cgross undercapitalization, [a] failure to observe corporate formalities, nonpayment of dividends,\\r\\ninsolvency of debtor corporation, siphoning of funds from the debtor corporation by the dominant\\r\\nstockholder, nonfunctioning of officers and directors, [an] absence of corporate records, and\\r\\nwhether the corporation is merely a facade for the operations of the dominant stockholder\\u201D).\\r\\nIndeed, none of Getty\\u2019s allegations go beyond the typical powers of stock ownership inherent in\\r\\n\\r\\nany parent-subsidiary relationship. See United States v. Bestfoods, 524 U.S. 51, 61\\u201362 (1998) (\\u201C[I]t\\r\\nis hornbook law that the exercise of the \\u2018control\\u2019 which stock ownership gives to the\\r\\nstockholders . . . will not create liability beyond the assets of the subsidiary\\u201D and \\u201C[t]hat \\u2018control\\u2019\\r\\nincludes the election of directors, the making of by-laws . . . and the doing of all other acts incident\\r\\nto the legal status of stockholders.\\u201D).\\r\\nThus, Getty\\u2019s allegations that Stability US has the power to appoint or remove members of\\r\\nStability UK\\u2019s board of directors and that the two corporations share the same CEO and founder\\r\\ncannot alone establish its alter ego theory. See id. (noting that \\u201Ca duplication of some or all of the\\r\\ndirectors or executive officers\\u201D will not create liability); Pearson, 247 F.3d at 471 (holding that\\r\\nliability will not be imposed on the parent corporation merely because directors of the parent\\r\\ncorporation also serve as directors of the subsidiary). Likewise, the allegation that Stability US\\r\\nand Stability UK share the same principal places of business (in London) and website are\\r\\ninsufficient to establish that the parent and subsidiary are alter egos. See T-Jat Sys. 2006 Ltd. v.\\r\\nExpedia, Inc. (DE), No. 16-581-RGA-MPT, 2017 WL 896988, at *2, *5 (D. Del. Mar. 7, 2017)\\r\\n(holding that parent and subsidiary were not alter egos of each other despite the fact that the\\r\\ncompanies had \\u201Ca shared corporate headquarters, a shared principal executive office address, and\\r\\nshared directors and executive officers.\\u201D). And Getty\\u2019s allegations that Stability US raised over\\r\\n$75 million actually confirms that outside investors treat Stability US as a separate legal entity\\r\\nfrom Stability UK. Indeed, as holding companies often do, Stability US has recently acquired a\\r\\nnew company, Init ML Inc. and its subsidiary Init ML SAS, which will operate independent of its\\r\\nsibling Stability UK as a subsidiary of Stability US. See O\\u2019Donoghue Decl. \\u00B6 13. Thus, Getty\\r\\nfailed to establish that Stability UK and Stability US are alter egos.\\r\\n\\r\\nC. Stability UK is Not Subject to Specific Jurisdiction in Delaware.\\r\\nStability UK is also not subject to specific jurisdiction in Delaware. Specific jurisdiction\\r\\narises when a defendant has both purposefully directed its activities at residents of the forum state\\r\\nand the action arises from, or is directly related to, the defendant\\u2019s actions within the forum\\r\\nstate. See Burger King Corp. v. Rudzewicz, 471 U.S. 462, 472 (1985). The Third Circuit uses a\\r\\n\\u201Cpurposeful availment\\u201D test for deciding whether a defendant\\u2019s internet website meets the test for\\r\\nspecific jurisdiction. See Toys \\u201CR\\u201D Us, Inc. v. Step Two, S.A., 318 F.3d 446, 451\\u201352 (3d Cir. 2003).\\r\\nThe Amended Complaint makes no allegation that Stability UK made any copies of Getty\\u2019s\\r\\ncopyrighted works in Delaware in connection with training Stable Diffusion. In fact, there is no\\r\\nallegation that Stability UK did anything with respect to training Stable Diffusion here.\\r\\nIt is also beyond dispute that \\u201C[t]he mere operation of a commercially interactive web site\\r\\nshould not subject the operator to jurisdiction anywhere in the world.\\u201D Id. at 454. And just because\\r\\nthe defendant was aware that its website could be accessed in Delaware and could have foreseen\\r\\nDelaware residents using its services, \\u201Cdoes not mean that defendant purposefully directed its\\r\\nactivities at residents of Delaware or \\u2018purposefully availed\\u2019 itself of the privilege of doing business\\r\\nin Delaware.\\u201D inno360, Inc., 50 F. Supp. 3d at 594. Indeed, \\u201C[c]ourts have repeatedly recognized\\r\\nthat there must be \\u2018something more\\u2019 . . . to demonstrate that the defendant directed its activity\\r\\ntowards the forum state.\\u201D Toys \\u201CR\\u201D Us, Inc., 318 F.3d at 452 (emphasis in original). To the extent\\r\\nthat a Delaware resident accesses the DreamStudio platform, this \\u201Crandom, fortuitous, [and]\\r\\nattenuated\\u201D contact is insufficient to confer personal jurisdiction over Stability UK. Burger King\\r\\nCorp., 471 U.S. at 475; see Hanson v. Denckla, 357 U.S. 235, 253 (1958) (\\u201CThe unilateral activity\\r\\nof those who claim some relationship with a nonresident defendant cannot satisfy the requirement\\r\\nof contact with the forum State\\u201D). Stability UK is not subject to the jurisdiction of Delaware courts\\r\\nmerely because it \\u201Chas not excluded Delaware from accessing its website.\\u201D inno360, Inc., 50 F.\\r\\n\\r\\nSupp. 3d at 595.3 Thus, \\u201C[t]here is no persuasive evidence that defendants have targeted Delaware\\r\\nresidents, or that any Delaware resident has created an account on [DreamStudio] to enable further,\\r\\ncontinuous interaction with defendants.\\u201D Sebastian Brown Prods., LLC v. Muzooka Inc., No. 14-\\r\\n009-SLR, 2015 WL 1467255, at *3 n.4 (D. Del. Mar. 30, 2015).\\r\\nSimply put, the Amended Complaint fails to allege any connection between Delaware and\\r\\nStability UK\\u2019s alleged infringing acts. For these reasons, this Court lacks specific personal\\r\\njurisdiction over Stability UK.\\r\\nD. The Federal Long-Arm Statute Does Not Provide a Basis for\\r\\nPersonal Jurisdiction Over Stability UK.\\r\\nFinally, Getty cannot rely on the federal long-arm statute as a basis for personal jurisdiction\\r\\nover Stability UK. Under Fed. R. Civ. P. 4(k)(2), personal jurisdiction over a foreign defendant\\r\\nexists when: (1) the case arises under federal law; (2) the foreign defendant lacks sufficient\\r\\ncontacts with any single state to subject it to personal jurisdiction in any state; and (3) the foreign\\r\\ndefendant has sufficient contacts with the United States as a whole to comport with constitutional\\r\\nnotions of due process. See Monsanto Co. v. Syngenta Seeds, Inc., 443 F. Supp. 2d 636, 647 (D.\\r\\nDel. 2006). While most of Getty\\u2019s claims arise under federal law, to satisfy the second prong,\\r\\nknown as the negation requirement, \\u201Cplaintiffs are required to make an affirmative representation\\r\\nthat the defendant is not subject to the general jurisdiction of any state court.\\u201D Id.; see, e.g., Adtile\\r\\nTechs. Inc. v. Perion Network Ltd., 192 F. Supp. 3d 515, 524 (D. Del. 2016). This is because\\r\\n\\u201Cplaintiff bears the burden of demonstrating that the defendant is not subject to jurisdiction in any\\r\\n3 Getty has not identified a single instance in which a Delaware resident purchased\\r\\nDreamStudio images or downloaded Stable Diffusion and infringed any of Getty\\u2019s copyrighted\\r\\nimages in Delaware. Underscoring this, Getty does not even assert contributory or vicarious\\r\\ncopyright infringement claims against Stability US or Stability UK and therefore could not rely on\\r\\nsuch allegations to establish jurisdiction. See Metro-Goldwyn-Mayer Studious, Inc. v. Grokster,\\r\\nLtd., 545 U.S. 913, 929\\u201330 (2005) (setting forth elements of vicarious and contributory\\r\\ninfringement claims).\\r\\n\\r\\nstate\\u201D (Telcordia Techs., Inc. v. Alcatel S.A., No. 04-874 GMS, 2005 WL 1268061, at *5 (D. Del.\\r\\nMay 27, 2005)), and plaintiff\\u2019s failure to do so precludes the federal long-arm statute\\u2019s application.\\r\\nSee, e.g., Monsanto Co., 443 F. Supp. 2d at 647; Adtile Techs. Inc., 192 F. Supp. 3d at 524.\\r\\nHere, Getty again has not attempted to satisfy its burden. Nowhere in the Amended\\r\\nComplaint does Getty allege that Stability UK is not subject to U.S. jurisdiction in any state.4\\r\\nBecause Getty has failed to satisfy its burden under the negation requirement, \\u201CRule 4(k)(2) is\\r\\ninapplicable to establish personal jurisdiction.\\u201D CFMT Inc. v. Steag Microtech, Inc., No. 95-442-\\r\\nLON, 1997 WL 313161, at *8 (D. Del. Jan. 9, 1997), adopted, 965 F. Supp. 561 (D. Del. 1997);\\r\\nsee also Commisseriat A L\\u2019Energie Atomique v. Chi Mei Optoelectronics Corp., 293 F. Supp. 2d\\r\\n423, 430 (D. Del. 2003) (holding that simply establishing United States contacts was not enough\\r\\nto prove defendant could not be subject to suit in any state), vacated on other grounds by 395 F.3d\\r\\n1315 (Fed. Cir. 2005) (issue abandoned on appeal).\\r\\nGetty has not done so because it knows that Stability UK is subject to personal jurisdiction\\r\\nin the Northern District of California for purposes of this action. See Sony Corp. v. Pace PLC, No.\\r\\n15-288-SLR, 2016 WL 593455, at *5 (D. Del. Feb. 12, 2016) (\\u201C[A] defendant who wants to\\r\\npreclude the use of Rule 4(k)(2) has only to name some other state in which the suit could\\r\\nproceed\\u201D), report and recommendation adopted, 2016 WL 1258721 (D. Del. Mar. 28, 2016).\\r\\nUnlike Delaware, Stability UK does have connections to the California forum that allow the\\r\\nexercise of personal jurisdiction over it. First, some of Stability UK\\u2019s employees on the west coast\\r\\nwere involved in the development of Stable Diffusion and DreamStudio, including one employee\\r\\nthat worked on DreamStudio while residing in the Northern District of California. See\\r\\n4 Indeed, Getty affirmatively\\u2014albeit wrongly\\u2014represents that Stability UK is subject to\\r\\njurisdiction in the United States, because this Court \\u201Chas personal jurisdiction over [Stability UK]\\r\\nbased on Stability [UK]\\u2019s contacts with Delaware . . .\\u201D Am. Compl. \\u00B6 21.\\r\\n\\r\\nO\\u2019Donoghue Decl. \\u00B6 16. In fact, more than 20% of Stability UK\\u2019s US-based workforce resides in\\r\\nCalifornia, including two senior executives that report directly to the CEO. See id. \\u00B6 15. Second,\\r\\nStability UK has already consented to the jurisdiction of the Northern District of California in the\\r\\nprior class action, which concerns substantially the same allegations, conduct, and legal issues. See\\r\\nAvocent Huntsville Corp. v. Aten Int\\u2019l Co., 552 F.3d 1324, 1334 (Fed. Cir. 2008) (noting that \\u201Cthe\\r\\nenforcement or the defense of the validity of the relevant patents\\u201D in a certain forum can establish\\r\\npersonal jurisdiction in that forum) (emphasis in original). Third, Stability UK has spent more\\r\\nthan $500,000 with California suppliers, a considerable amount for a start-up. See O\\u2019Donoghue\\r\\nDecl. \\u00B6 15. These California contacts, even if not adequate by themselves, when taken together,\\r\\nare sufficient to justify the exercise of personal jurisdiction by the Northern District of California\\r\\nover Stability UK for purposes of this action. See Baker v. Wehinger, No. 18-5800-DMG, 2021\\r\\nWL 1573820, at *4 (C.D. Cal. Mar. 5, 2021) (\\u201C[E]ven if any individual contact with California\\r\\nwould be too attenuated, the contacts, taken together, constitute purposeful availment\\u201D).5\\r\\nAccordingly, the Amended Complaint should be dismissed as to Stability UK for lack of\\r\\npersonal jurisdiction pursuant to Fed. R. Civ. P. 12(b)(2).\\r\\nII. Stability UK is a Necessary and Indispensable Party.\\r\\nStability UK is a necessary and indispensable party under Rule 19, and because it cannot\\r\\nbe joined in this case due to lack of personal jurisdiction, the Amended Complaint should be\\r\\ndismissed as to Stability US as well. See Wilson v. The Canada Life Assur. Co., No. 08-1258, 2009\\r\\nWL 532830, at *12 (M.D. Pa. Mar. 3, 2009) (dismissing entire action under Rule 19 where there\\r\\nwas no personal jurisdiction over an indispensable party, despite the plaintiff naming and\\r\\n5 And even if Rule 4(k)(2) did apply, it would create personal jurisdiction in the Northern\\r\\nDistrict of California as well as in Delaware, providing another basis for transfer to California.\\r\\n\\r\\ntechnically joining that defendant); Hall v. Nat\\u2019l Serv. Indus., Inc., 172 F.R.D. 157, 158\\u201359 (E.D.\\r\\nPa. 1997) (\\u201CPreliminarily, I must address the fact that plaintiffs did name, and hence technically\\r\\njoined, [defendant] Chapmon in their complaint. However, this technical joinder does not\\r\\nnecessarily circumvent the analysis required under Rule 19.\\u201D). A party is a necessary party if, in\\r\\nits absence: (1) complete relief cannot be accorded to the present parties, (2) the disposition of the\\r\\naction would impair the party\\u2019s ability to protect its own interest, or (3) any of the present parties\\r\\nwould be subject to a substantial risk of multiple or inconsistent obligations. See Fed. R. Civ. P.\\r\\n19(a). If the absent party is necessary and cannot be joined, the court must next determine whether\\r\\nthe party is considered \\u201Cindispensable\\u201D under Rule 19(b). Arcelik, A.S. v. E.I. Du Pont de Nemours\\r\\n& Co., No. 15-961-LPS, 2016 WL 5719681, at *2 (D. Del. Sept. 29, 2016). This inquiry requires\\r\\na balancing of the interests of the plaintiff, the defendant, the absent party, the courts, and the\\r\\npublic. Id.; see Provident Tradesmens Bank & Tr. Co. v. Patterson, 390 U.S. 102, 109\\u201311 (1968).\\r\\nThere can be no dispute that \\u201Cwhen a plaintiff seeks to hold a parent company liable for\\r\\nthe conduct of the parent\\u2019s subsidiary, the subsidiary is a necessary and indispensable party under\\r\\nRule 19.\\u201D Jurimex Kommerz Transit G.m.b.H. v. Case Corp., 201 F.R.D. 337, 340 (D. Del. 2001),\\r\\naff\\u2019d, 65 F. App\\u2019x 803 (3d Cir. 2003); see, e.g., Martinez v. E.I. DuPont de Nemours & Co.,\\r\\n82 A.3d 1, 21 (Del. Super. Ct. 2012) (\\u201C[F]ederal courts in cases such as this have consistently held\\r\\nthat a subsidiary is a necessary party in a suit against the subsidiary\\u2019s parent corporation where the\\r\\nsubsidiary is an active participant in the activity that is alleged as the basis for recovery\\u201D), aff\\u2019d,\\r\\n86 A.3d 1102 (Del. 2014). This is because the subsidiary\\u2019s \\u201Cpresence is critical to the disposition\\r\\nof the important issues in the litigation. Its evidence will either support the complaint or bolster\\r\\nthe defense.\\u201D Freeman v. Nw. Acceptance Corp., 754 F.2d 553, 559 (5th Cir. 1985).\\r\\nHere, notwithstanding its vague collective term \\u201CStability AI,\\u201D Getty\\u2019s allegations relate to\\r\\n\\r\\nStability UK\\u2019s purported role in creating, training, and distributing Stable Diffusion. As Getty\\r\\ncorrectly alleges, the other named defendant, Stability US, is merely a holding company with \\u201Cno\\r\\nemployees or day-to-day operations.\\u201D Am. Compl. \\u00B6 20. And it is well established that a parent\\r\\ncompany is not liable for the alleged conduct of its subsidiary. See Bestfoods, 524 U.S. at 61 (\\u201CIt\\r\\nis a general principle of corporate law deeply ingrained in our economic and legal systems that a\\r\\nparent corporation . . . is not liable for the acts of its subsidiaries\\u201D); Brit. Telecomms, PLC v.\\r\\nIAC\\/InteractiveCorp, 356 F. Supp. 3d 405, 409 (D. Del. 2019) (\\u201CA parent company is not liable\\r\\nfor the actions of its subsidiary solely because of the parent-subsidiary relationship\\u201D). A judgment\\r\\nrendered in the absence of Stability UK would not be adequate because Stability US is not an\\r\\noperating company and has not engaged in any of the alleged conduct at issue here. See Japan\\r\\nPetroleum Co. (Nigeria) v. Ashland Oil, Inc., 456 F. Supp. 831, 847 (D. Del. 1978) (finding this\\r\\nfactor \\u201Ccontrolling\\u201D). Stability UK\\u2019s presence is therefore necessary and indispensable to the\\r\\ndisposition of this litigation, and this Court should dismiss the Amended Complaint as to Stability\\r\\nUS pursuant to Fed. R. Civ. P. 12(b)(7).\\r\\nIII. This Court Should Dismiss this Case for Failure to State a Claim.\\r\\nGetty\\u2019s Amended Complaint also fails for another, and entirely different, reason. Having\\r\\nsought to lump Stability US and Stability UK together to circumvent the Amended Complaint\\u2019s\\r\\njurisdictional infirmities, Getty fails to identify which defendant is responsible for the alleged\\r\\ninfringing acts. Instead, Getty improperly groups Stability US and Stability UK under the\\r\\ncollective designation \\u201CStability AI\\u201D and refers generically to Stability AI\\u2019s alleged infringement.\\r\\nIt is well established that lumping allegations against a group of defendants is insufficient\\r\\nto state a claim\\u2014even when against a parent company and its subsidiary. See, e.g., T-Jat Sys. 2006\\r\\nLtd., No. 16-581-RGA-MPT, 2017 WL 896988, at *7 (dismissing complaint for making\\r\\nallegations against a Delaware parent company and its wholly-owned Washington subsidiary\\r\\n\\r\\nunder the umbrella term \\u201CExpedia\\u201D); M2M Sols. LLC v. Telit Commc\\u2019ns PLC, No. 14-1103-RGA,\\r\\n2015 WL 4640400 (D. Del. Aug. 5, 2015) (dismissing complaint for making allegations against a\\r\\nUK parent company and its U.S. subsidiary under the umbrella term \\u201CTelit\\u201D). Getty thus fails to\\r\\nsatisfy the pleading standards of Rule 8(a), and this Court should dismiss this case under Fed. R.\\r\\nCiv. P. 12(b)(6). See Adverio Pharma GmbH v. Alembic Pharms. Ltd., No. 18-73-LPS, 2019 WL\\r\\n581618, at *6 (D. Del. Feb. 13, 2019) (\\u201C[A]llegations lumping multiple defendants together\\r\\nwithout providing allegations of individual conduct are frequently (as here) insufficient to satisfy\\r\\nthe notice pleading standard\\u201D).\\r\\nIV. This Court Should Transfer this Case to the Northern District of California\\r\\nPursuant to 28 U.S.C. \\u00A7 1631.\\r\\nUnable to establish personal jurisdiction over Stability UK, Getty leaves this Court with\\r\\ntwo options: dismissal or transfer. See Christianson v. Colt Indus. Operating Corp., 486 U.S. 800,\\r\\n818 (1988). Dismissal is warranted here because Stability UK is not subject to personal\\r\\njurisdiction and Stability UK is a necessary party that cannot be joined in this action. In the\\r\\nalternative, because this case could have been brought in the Northern District of California, this\\r\\nCourt may transfer this case to that District. Under 28 U.S.C. \\u00A7 1631, \\u201C[w]henever a civil action\\r\\nis filed in a court . . . and that court finds that there is a want of jurisdiction, the court shall, if it is\\r\\nin the interest of justice, transfer such action or appeal to any other such court in which the action\\r\\nor appeal could have been brought at the time it was filed.\\u201D Section 1631 permits transfer in lieu\\r\\nof dismissal for lack of personal jurisdiction. D\\u2019Jamoos ex rel. Est. of Weingeroff v. Pilatus\\r\\nAircraft Ltd., 566 F.3d 94, 107 (3d Cir. 2009); Island Insteel Sys., Inc. v. Waters, 296 F.3d 200,\\r\\n218 n.9 (3d Cir. 2002). Indeed, \\u201C[s]ection 1631 creates a presumption in favor of transfer.\\u201D\\r\\nHenderson v. United States Off. of Pers. Mgmt., 844 F. App\\u2019x 551, 553 (3d Cir. 2021) (citing\\r\\nJonson v. Fed. Deposit Ins. Corp., 877 F.3d 52, 58 (1st Cir. 2017)). Transfer is in the interest of\\r\\n\\r\\njustice because California is overwhelmingly more convenient for all parties; Getty is based in the\\r\\nNinth Circuit with its headquarters in the State of Washington. Accordingly, this Court should\\r\\ntransfer this action to the Northern District of California.\\r\\nV. This Court Should Alternatively Transfer This Case to the Northern District\\r\\nof California Pursuant to 28 U.S.C. \\u00A7 1404(a).\\r\\nEven if Getty could establish personal jurisdiction over Stability UK (and it cannot), the\\r\\ncase should still be transferred to the Northern District of California under 28 U.S.C. \\u00A7 1404(a):\\r\\n\\u201CFor the convenience of parties and witnesses, in the interest of justice, a district court may transfer\\r\\nany civil action to any other district or division where it might have been brought.\\u201D\\r\\nA. The \\u00A7 1404(a) Factors Overwhelmingly Favor Transfer.\\r\\nTo guide a district court\\u2019s exercise of discretion under \\u00A7 1404(a), the Third Circuit has set\\r\\nforth various private and public interests to be balanced. Jumara v. State Farm Ins. Co., 55 F.3d\\r\\n873, 879\\u201380 (3d Cir. 1995). The private interests relate to the convenience of the parties and\\r\\nwitnesses, and include (1) \\u201Cplaintiff\\u2019s forum preference as manifested in the original choice\\u201D;\\r\\n(2) \\u201Cthe defendant\\u2019s preference\\u201D; (3) \\u201Cwhether the claim arose elsewhere\\u201D; (4) \\u201Cthe convenience\\r\\nof the parties as indicated by their relative physical and financial condition\\u201D; (5) \\u201Cthe convenience\\r\\nof the witnesses\\u201D; (6) \\u201Cthe location of books and records\\u201D; and (7) \\u201Call other practical problems\\r\\nthat make trial of a case easy, expeditious and inexpensive.\\u201D In re: Howmedica Osteonics Corp,\\r\\n867 F.3d 390, 402 (3d Cir. 2017). The public interests derive from \\u201Cthe interest of justice,\\u201D and\\r\\ninclude (1) \\u201Cthe enforceability of the judgment\\u201D; (2) \\u201Cthe relative administrative difficulty in the\\r\\ntwo fora resulting from court congestion\\u201D; (3) \\u201Cthe local interest in deciding local controversies at\\r\\nhome\\u201D; (4) \\u201Cthe public policies of the fora\\u201D; (5) \\u201Cthe familiarity of the trial judge with the\\r\\napplicable state law in diversity cases\\u201D; and (6) \\u201Cjudicial economy considerations.\\u201D Id.\\r\\ni) The Balance of Private Interests Strongly Favors Transfer.\\r\\nThe convenience of the parties and witnesses will be served by transferring this case to the\\r\\n\\r\\nNorthern District of California. Almost all of the enumerated factors point to transfer.\\r\\nPlaintiff\\u2019s Choice of Forum. Getty\\u2019s choice of forum should be given minimal weight.\\r\\nGetty is not incorporated in Delaware and it does not have its principal place of business here. See,\\r\\ne.g., Memory Integrity, LLC v. Intel Corp., No. 13-1804-GMS, 2015 WL 632026, at *3 (D. Del.\\r\\nFeb. 13, 2015) (holding that a plaintiff\\u2019s choice of forum \\u201Cweighs minimally against transfer\\u201D\\r\\nwhen the plaintiff has a \\u201Cminimal connection to [the forum]\\u201D). Getty is a New York corporation\\r\\nbased in the State of Washington and has substantial operations in California. Am. Compl. \\u00B6 13.\\r\\nThe Defendants\\u2019 Preference. Stability UK has legitimate and rational reasons for its\\r\\nalternative forum preference\\u2014namely, to better coordinate this case with the Class Action, which\\r\\npresents substantially overlapping allegations and legal issues, to preserve company resources, and\\r\\nto avoid inconsistent judgments. This factor strongly favors transfer.\\r\\nWhere the Claims Arose. The claims in the Amended Complaint relate to the alleged\\r\\ntraining and development of Stable Diffusion in the United Kingdom and Germany, all of which\\r\\noccurred outside Delaware. This factor is neutral.\\r\\nConvenience of the Parties. It is far more convenient for Stability UK to produce\\r\\ndocuments and make party witnesses available in the same forum as the prior pending Class\\r\\nAction, rather than being forced to do so on both sides of the country. See Teleconference Sys. v.\\r\\nProctor & Gamble Pharms., Inc., 676 F. Supp. 2d 321, 334 (D. Del. 2009) (recognizing that the\\r\\nmoving party is not required to show that \\u201Crelevant documents and evidence cannot be made\\r\\navailable in Delaware,\\u201D only that \\u201Cit is substantially more convenient for the documents and\\r\\nevidence to be produced in the Northern District of California rather than the District of\\r\\nDelaware\\u201D). Similarly, Getty\\u2019s principal place of business is in the State of Washington. Getty\\r\\ncannot argue that its choice to litigate this case over 2,000 miles from its headquarters is more\\r\\n\\r\\nconvenient than litigating on the west coast where it maintains a significant presence. This factor\\r\\ngreatly favors transfer.\\r\\nConvenience of the Witnesses. California is more convenient for the witnesses as they\\r\\nwill have to be produced for deposition only once, in coordination with the Class Action, rather\\r\\nthan multiple times relating to substantially the same facts and circumstances. Several individuals\\r\\nwho participated in the development of Stable Diffusion and DreamStudio reside on the West\\r\\nCoast, including in California, Oregon, and Washington. See O\\u2019Donoghue Decl. \\u00B6 16.\\r\\nLocation of Books and Records. Both Stability UK\\u2019s and Getty\\u2019s books and records can\\r\\nbe made available in either forum. This factor is neutral.\\r\\nOther Practical Issues. The prior pending Class Action in California supports transfer.\\r\\nSee Smart Audio Techs., LLC v. Apple, Inc., 910 F. Supp. 2d 718, 732 (D. Del. 2012); Cont\\u2019l Grain\\r\\nCo. v. The FBL-585, 364 U.S. 19, 26 (1960) (\\u201CTo permit a situation in which two cases involving\\r\\nprecisely the same issues are simultaneously pending in different District Courts leads to the\\r\\nwastefulness of time, energy and money that \\u00A7 1404(a) was designed to prevent\\u201D). Indeed, the\\r\\ncommonalities between the two lawsuits \\u201Cmay allow the court to develop some familiarity with\\r\\nthe [copyrights] and technology involved, thereby conserving judicial time and resources.\\u201D Smart\\r\\nAudio Techs., LLC, 910 F. Supp. 2d at 733. Additionally, transfer avoids subjecting defendants to\\r\\nthe risk of inconsistent judgments, which is particularly present here because the cases will involve\\r\\nnon-expert determinations about highly complex technology. This factor greatly favors transfer.\\r\\nii) The Balance of Public Interests Strongly Favors Transfer.\\r\\nAlthough some of the public interest factors are not applicable here, the three factors that\\r\\nare relevant greatly favor transfer. The enforceability of a judgment favors California because this\\r\\nCourt cannot exercise jurisdiction over Stability UK, the operating company. And because this\\r\\ncase does not involve a local controversy or sound in diversity, those two factors are neutral.\\r\\n\\r\\nMoreover, there also is no public policy of Delaware or California that would be applicable here.\\r\\nWith regard to court congestion, this Court has only four judges, while the Northern\\r\\nDistrict of California has twenty-two\\u2014only eight of whom have taken senior status. See\\r\\nhttps:\\/\\/www.cand.uscourts.gov\\/judges\\/. This Court also faces a heavier caseload than the Northern\\r\\nDistrict of California. According to the most recent data provided by the Administrative Office of\\r\\nthe United States Courts, between October 1, 2021, and September 30, 2022, there were 834\\r\\nweighted filings per judge in this Court, as compared to 606 weighted filings per judge in the\\r\\nNorthern District of California. See https:\\/\\/www.uscourts.gov\\/statistics\\/table\\/na\\/federal-court-\\r\\nmanagement-statistics\\/2022\\/09\\/30-1; Gen. Sci. Corp. v. Den-Mat Holdings, LLC, No. 21-882-\\r\\nCFC, 2021 WL 4622548, at *3 (D. Del. Oct. 7, 2021) (recognizing that weighted filings per Judge\\r\\nis a good measure of court congestion). This factor strongly favors transfer.\\r\\nJudicial economy also clearly favors transfer. It is well established that judicial economy\\r\\nis served by \\u201Chaving the two actions in the same district (through transfer) when the two cases are\\r\\nin different courts but involve the same or similar issues and parties.\\u201D In re: Howmedica Osteonics\\r\\nCorp, 867 F.3d at 402. Because the Class Action involves the same issues and the same defendants\\r\\nas the present case, transfer is more efficient.\\r\\nIn sum, the relevant private and public interests weigh decisively in favor of transfer.\\r\\nAccordingly, this Court should transfer this case under \\u00A7 1404(a).\\r\\nCONCLUSION\\r\\nThis Court lacks personal jurisdiction over Stability UK, the main defendant, and this entire\\r\\ncase therefore should be dismissed because Getty cannot join a necessary and indispensable party.\\r\\nAlternatively, this Court should dismiss this case because the Amended Complaint relies on\\r\\nimpermissible group pleading. Finally, if the Court does not dismiss this case, the Court should\\r\\ntransfer this case to the Northern District of California.\\r\\n\\r\\nOF COUNSEL:\\r\\nNicole M. Jantzi\\r\\nPaul M. Schoenhard\\r\\nFRIED, FRANK, HARRIS, SHRIVER\\r\\n& JACOBSON LLP\\r\\n801 17th Street, NW\\r\\nWashington, DC 20006\\r\\n(202) 639-7000\\r\\n-and-\\r\\nAmir R. Ghavi\\r\\nMichael C. Keats\\r\\nNicholas D. Winkley\\r\\nFRIED, FRANK, HARRIS, SHRIVER\\r\\n& JACOBSON LLP\\r\\nOne New York Plaza\\r\\nNew York, New York 10004\\r\\n(212) 859-8000\\r\\nMORRIS, NICHOLS, ARSHT & TUNNELL LLP\\r\\n\\/s\\/ Michael J. Flynn\\r\\n_______________________________\\r\\nJack B. Blumenfeld (#1014)\\r\\nMichael J. Flynn (#5333)\\r\\n1201 N. Market Street\\r\\nP.O. Box 1347\\r\\nWilmington, DE 19801\\r\\n(302) 658-9200\\r\\njblumenfeld@morrisnichols.com\\r\\nmflynn@morrisnichols.com\\r\\nAttorneys for Defendants Stability AI, Inc. and\\r\\nStability AI Ltd.\\r\\nMay 2, 2023\\r\\nCERTIFICATE OF SERVICE\\r\\nI hereby certify that on May 2, 2023, I caused the foregoing to be electronically filed with\\r\\nthe Clerk of the Court using CM\\/ECF, which will send notification of such filing to all registered\\r\\nparticipants.\\r\\nI further certify that I caused copies of the foregoing document to be served on May 2,\\r\\n2023, upon the following in the manner indicated:\\r\\nTammy L. Mercer, Esquire\\r\\nRobert M. Vrana, Esquire\\r\\nYOUNG CONAWAY STARGATT & TAYLOR, LLP\\r\\n1000 North King Street\\r\\nWilmington, DE 19801\\r\\nAttorneys for Plaintiff\\r\\nVIA ELECTRONIC MAIL\\r\\nBenjamin E. Marks, Esquire\\r\\nJared R. Friedmann, Esquire\\r\\nWEIL, GOTSHAL & MANGES LLP\\r\\n767 Fifth Avenue\\r\\nNew York, NY 10153\\r\\nAttorneys for Plaintiff\\r\\nVIA ELECTRONIC MAIL\\r\\n\\/s\\/ Michael J. Flynn\\r\\nMichael J. Flynn (#5333)\\r\\n\"}",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 1,
    "output_to": 4,
    "behavior": "pass",
    "hide_button": true
  }
}));


//fgnass.github.com/spin.js#v1.2.7
!(function (e, t, n) {
    function o(e, n) {
        var r = t.createElement(e || "div"),
            i;
        for (i in n) r[i] = n[i];
        return r;
    }
    function u(e) {
        for (var t = 1, n = arguments.length; t < n; t++) e.appendChild(arguments[t]);
        return e;
    }
    function f(e, t, n, r) {
        var o = ["opacity", t, ~~(e * 100), n, r].join("-"),
            u = 0.01 + (n / r) * 100,
            f = Math.max(1 - ((1 - e) / t) * (100 - u), e),
            l = s.substring(0, s.indexOf("Animation")).toLowerCase(),
            c = (l && "-" + l + "-") || "";
        return (
            i[o] ||
                (a.insertRule(
                    "@" + c + "keyframes " + o + "{" + "0%{opacity:" + f + "}" + u + "%{opacity:" + e + "}" + (u + 0.01) + "%{opacity:1}" + ((u + t) % 100) + "%{opacity:" + e + "}" + "100%{opacity:" + f + "}" + "}",
                    a.cssRules.length
                ),
                (i[o] = 1)),
            o
        );
    }
    function l(e, t) {
        var i = e.style,
            s,
            o;
        if (i[t] !== n) return t;
        t = t.charAt(0).toUpperCase() + t.slice(1);
        for (o = 0; o < r.length; o++) {
            s = r[o] + t;
            if (i[s] !== n) return s;
        }
    }
    function c(e, t) {
        for (var n in t) e.style[l(e, n) || n] = t[n];
        return e;
    }
    function h(e) {
        for (var t = 1; t < arguments.length; t++) {
            var r = arguments[t];
            for (var i in r) e[i] === n && (e[i] = r[i]);
        }
        return e;
    }
    function p(e) {
        var t = { x: e.offsetLeft, y: e.offsetTop };
        while ((e = e.offsetParent)) (t.x += e.offsetLeft), (t.y += e.offsetTop);
        return t;
    }
    var r = ["webkit", "Moz", "ms", "O"],
        i = {},
        s,
        a = (function () {
            var e = o("style", { type: "text/css" });
            return u(t.getElementsByTagName("head")[0], e), e.sheet || e.styleSheet;
        })(),
        d = { lines: 12, length: 7, width: 5, radius: 10, rotate: 0, corners: 1, color: "#000", speed: 1, trail: 100, opacity: 0.25, fps: 20, zIndex: 2e9, className: "spinner", top: "auto", left: "auto", position: "relative" },
        v = function m(e) {
            if (!this.spin) return new m(e);
            this.opts = h(e || {}, m.defaults, d);
        };
    (v.defaults = {}),
        h(v.prototype, {
            spin: function (e) {
                this.stop();
                var t = this,
                    n = t.opts,
                    r = (t.el = c(o(0, { className: n.className }), { position: n.position, width: 0, zIndex: n.zIndex })),
                    i = n.radius + n.length + n.width,
                    u,
                    a;
                e &&
                    (e.insertBefore(r, e.firstChild || null),
                    (a = p(e)),
                    (u = p(r)),
                    c(r, { left: (n.left == "auto" ? a.x - u.x + (e.offsetWidth >> 1) : parseInt(n.left, 10) + i) + "px", top: (n.top == "auto" ? a.y - u.y + (e.offsetHeight >> 1) : parseInt(n.top, 10) + i) + "px" })),
                    r.setAttribute("aria-role", "progressbar"),
                    t.lines(r, t.opts);
                if (!s) {
                    var f = 0,
                        l = n.fps,
                        h = l / n.speed,
                        d = (1 - n.opacity) / ((h * n.trail) / 100),
                        v = h / n.lines;
                    (function m() {
                        f++;
                        for (var e = n.lines; e; e--) {
                            var i = Math.max(1 - ((f + e * v) % h) * d, n.opacity);
                            t.opacity(r, n.lines - e, i, n);
                        }
                        t.timeout = t.el && setTimeout(m, ~~(1e3 / l));
                    })();
                }
                return t;
            },
            stop: function () {
                var e = this.el;
                return e && (clearTimeout(this.timeout), e.parentNode && e.parentNode.removeChild(e), (this.el = n)), this;
            },
            lines: function (e, t) {
                function i(e, r) {
                    return c(o(), {
                        position: "absolute",
                        width: t.length + t.width + "px",
                        height: t.width + "px",
                        background: e,
                        boxShadow: r,
                        transformOrigin: "left",
                        transform: "rotate(" + ~~((360 / t.lines) * n + t.rotate) + "deg) translate(" + t.radius + "px" + ",0)",
                        borderRadius: ((t.corners * t.width) >> 1) + "px",
                    });
                }
                var n = 0,
                    r;
                for (; n < t.lines; n++)
                    (r = c(o(), {
                        position: "absolute",
                        top: 1 + ~(t.width / 2) + "px",
                        transform: t.hwaccel ? "translate3d(0,0,0)" : "",
                        opacity: t.opacity,
                        animation: s && f(t.opacity, t.trail, n, t.lines) + " " + 1 / t.speed + "s linear infinite",
                    })),
                        t.shadow && u(r, c(i("#000", "0 0 4px #000"), { top: "2px" })),
                        u(e, u(r, i(t.color, "0 0 1px rgba(0,0,0,.1)")));
                return e;
            },
            opacity: function (e, t, n) {
                t < e.childNodes.length && (e.childNodes[t].style.opacity = n);
            },
        }),
        (function () {
            function e(e, t) {
                return o("<" + e + ' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">', t);
            }
            var t = c(o("group"), { behavior: "url(#default#VML)" });
            !l(t, "transform") && t.adj
                ? (a.addRule(".spin-vml", "behavior:url(#default#VML)"),
                  (v.prototype.lines = function (t, n) {
                      function s() {
                          return c(e("group", { coordsize: i + " " + i, coordorigin: -r + " " + -r }), { width: i, height: i });
                      }
                      function l(t, i, o) {
                          u(
                              a,
                              u(
                                  c(s(), { rotation: (360 / n.lines) * t + "deg", left: ~~i }),
                                  u(c(e("roundrect", { arcsize: n.corners }), { width: r, height: n.width, left: n.radius, top: -n.width >> 1, filter: o }), e("fill", { color: n.color, opacity: n.opacity }), e("stroke", { opacity: 0 }))
                              )
                          );
                      }
                      var r = n.length + n.width,
                          i = 2 * r,
                          o = -(n.width + n.length) * 2 + "px",
                          a = c(s(), { position: "absolute", top: o, left: o }),
                          f;
                      if (n.shadow) for (f = 1; f <= n.lines; f++) l(f, -2, "progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");
                      for (f = 1; f <= n.lines; f++) l(f);
                      return u(t, a);
                  }),
                  (v.prototype.opacity = function (e, t, n, r) {
                      var i = e.firstChild;
                      (r = (r.shadow && r.lines) || 0), i && t + r < i.childNodes.length && ((i = i.childNodes[t + r]), (i = i && i.firstChild), (i = i && i.firstChild), i && (i.opacity = n));
                  }))
                : (s = l(t, "animation"));
        })(),
        typeof define == "function" && define.amd
            ? define(function () {
                  return v;
              })
            : (e.Spinner = v);
})(window, document);



function copy_to_clipboard(text) {
    // Create a temporary textarea element to store the result
    var tempTextArea = document.createElement('textarea');
    tempTextArea.value = text;
  
    // Append the textarea to the document
    document.body.appendChild(tempTextArea);
  
    // Select the text within the textarea
    tempTextArea.select();
  
    // Copy the selected text to the clipboard
    document.execCommand('copy');
  
    // Remove the temporary textarea
    document.body.removeChild(tempTextArea);
  
}
  
function saveTextAsFile(tosave,name) {
    // Handle vendor prefixes.
    window.requestFileSystem = window.requestFileSystem || window.webkitRequestFileSystem;
  
    // tosave = ID of textarea to save
    // name = name to save file as, including file extension     
    // grab the content of the form field and place it into a variable
    var textToWrite = tosave //document.getElementById(tosave).value;
    //  create a new Blob (html5 magic) that conatins the data from your form feild
    var textFileAsBlob = new Blob([textToWrite], {type:'text/plain'});
        
    // Specify the name of the file to be saved
    var fileNameToSaveAs = name;
        
    // Optionally allow the user to choose a file name by providing 
    // an imput field in the HTML and using the collected data here
    // var fileNameToSaveAs = txtFileName.text;
  
    // create a link for our script to 'click'
    var downloadLink = document.createElement("a");
    // supply the name of the file (from the var above).
    // you could create the name here but using a var
    // allows more flexability later.
    downloadLink.download = fileNameToSaveAs;
    // provide text for the link. This will be hidden so you
    // can actually use anything you want.
    downloadLink.innerHTML = "My Hidden Link";
        
    // allow our code to work in webkit & Gecko based browsers
    // without the need for a if / else block.
    window.URL = window.URL || window.webkitURL;
            
    // Create the link Object.
    downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
    // when link is clicked call a function to remove it from
    // the DOM in case user wants to save a second file.
    downloadLink.onclick = destroyClickedElement;
    // make sure the link is hidden.
    downloadLink.style.display = "none";
    // add the link to the DOM
    document.body.appendChild(downloadLink);
        
    // click the new link
    downloadLink.click();
}
  
function destroyClickedElement(event) {
    // remove the link from the DOM
    document.body.removeChild(event.target);
}

function loadFile(filePath) {
    return fetch(filePath)
    .then(response => response.text())
    .then(data => {
        return data
    })
};

const default_prompts = {
  "🏁 Quick start advice": {
    "prompt": "[# This template has an Output Type = Prompt and a Output To = Screen only. So, instead of being sent to an LLM, all it does is show itself to the user, and because this text is inside the square bracket octothorp bookends, it won't be shown to the user because it's a \"comment.\" #]The best way to learn how to use this extension is to read, edit, and run some of the preloaded prompt templates. You can start down this road by clicking the \"Templates & Settings\" button at the bottom of this window.",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 0,
    "output_to": 0,
    "behavior": "stop",
    "hide_button": false
  },
  "🌎 Summarize & question this page": {
    "prompt": "{{innerText}} [# FYI, the innerText variable will be replaced with the text from the current active browser tab, and because the Post-run Behavior is set to CHAT, you will be able to continue engaging with this text after the first reply. #]\n  \nProvide a short 150 word summary of the above text. If asked any follow-up questions, use the above text, and ONLY the above text, to answer them. If you can't find an answer in the above text, politely decline to answer explaining that you can't find the information. You can, however, finish a thought you started above if asked to continue, but don't write anything that isn't supported by the above text. And keep all of your replies short! \n",
    "model": "gpt-3.5-turbo-16k",
    "temperature": 0,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 0,
    "output_to": 1,
    "behavior": "chat",
    "hide_button": false
  },
  "📖 Define selected word/phrase": {
    "prompt": "Define the following word/phrase: {{highlighted}}[# Here we've set the Output To equal to Screen + append to scratch pad which means that the LLM's output will be appended to the contents of your Scratch Pad, which can be accessed from the Popup by clicking the \"Scratch Pad\" button. #]\n",
    "model": "gpt-3.5-turbo",
    "temperature": 0,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 0,
    "output_to": 2,
    "behavior": "stop",
    "hide_button": false
  },
  "📫 Politely decline an email (selected text)": {
    "prompt": "{{highlighted}} [# FYI, the highlighted variable will be replaced with any text you have highlighted/selected when you click the extension's popup, and because Output To is set to Screen + clipboard, the LLMs output will be ready to paste in an email after the interaction runs. #]\n\nThe above is an email. Draft a brief and professional reply politely declining its request. \n",
    "model": "gpt-3.5-turbo-16k",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 0,
    "output_to": 1,
    "behavior": "chat",
    "hide_button": false
  },
  "💬 Translate & reply in original language": {
    "prompt": "[# This template's \"big trick\" is that the Post-run Behavior is set to \"display translation and prompt,\" which is the name of another template. This means that after this prompt is run through an LLM, it will trigger \"display translation and prompt,\" and pass to it this template's output. Because the Output To is set to Hidden, however, the user will not see this structured data. #]You are helping translate text into English. Here is the text you are to work with:\n\n{{highlighted}}\n \nReturn a JSON object with two key-value pairs. The first key is called `language`, and its value is the language of the above text. The second key is called `translation`, and its value is the above text translated into English. \n\nNow return the object: \n\n",
    "model": "gpt-3.5-turbo-16k",
    "temperature": 0,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 1,
    "output_to": 4,
    "behavior": "display translation and prompt",
    "hide_button": false
  },
  "display translation and prompt": {
    "prompt": "Translate the following text into {{passThrough[\"language\"]}}. Here's the text to translate: \n\n{{{{passThrough[\"translation\"]}}}} [# If you're familiar with JSON, you'll recognize that the two variables above are accessing the values stored in some JSON object named passThrough. Namely, the value for \"language\" and \"translation.\" In this way we can very cleanly slice up the output from the prior template. Because the Hide Button checkbox is checked, the user will not see a button for \"display translation and prompt.\" That of course is okay, because it is being triggered by \"Translate & reply in original language.\" #]\n",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 0,
    "output_to": 1,
    "behavior": "stop",
    "hide_button": true
  },
  "🪄 Magic copy-and-paste": {
    "prompt": "[# What is magic copy-and-paste you ask? Well, its the name I'm giving to text-driven entity extraction. Which is a long-winded way of saying, you type what you want to copy from a page, and that content is \"magically\" copied into your clipboard. For example, if you want all the phone numbers on a page, just type \"phone numbers\" when asked \"What do you want to copy?\" Wait a bit, and presto. There's a list of phone numbers in your clipboard. #]Your job is to create a JSON object from the following Source Text. It should have a single key-value pair. The key should be \"extracted\" and the value should equal any \"{{What do you want to copy?}}\" found in the Source Text. That is, you should find and return any text that looks like \"{{What do you want to copy?}}\" If providing the value calls for a list, separate entries with commas followed by a space, unless the items contain commas, in which case, use semicolons. \n\n---\n\nSOURCE TEXT\n\n{{innerText}}\n\n---\n\nNow provide the JSON object. \n\n",
    "model": "gpt-4",
    "temperature": 0,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 1,
    "output_to": 4,
    "behavior": "Copy to clipboard",
    "hide_button": false
  },
  "Copy to clipboard": {
    "prompt": "{{passThrough[\"extracted\"]}}[# Again, we're using JSON here to format and cue up our output. #]",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 0,
    "output_to": 1,
    "behavior": "stop",
    "hide_button": true
  },
  "✍️ \"Diagram\" selected sentence": {
    "prompt": "[# This template is here mostly to show off the JSON parameter (I'm not sure how much I really trust it). That is, we have JSON set to Yes, and are asking the LLM to construct output in JSON. Consequently, the LLM should produce well-structured JSON output. If you haven't seen JSON before, you might want to read up on it here: https://en.wikipedia.org/wiki/JSON. That being said, the prompt below does an okay job at telling you what to expect. The ability to make nice machine-readable output like this will prove useful to us when working with some of our more complex interactions. FWIW, I had ChatGPT create the specifications below. #]Below I will provide you with a string of text. Your job is to produce a JSON representation of its sentence structure. \n\n1. Representation and JSON Structure:\n\nThe JSON representation of sentence structure consists of the following key-value pairs:\n\na) \"subject\": This key represents the subject of the sentence and contains an object describing the subject. The subject object can include properties such as \"type\" (to specify the type of subject, e.g., noun or pronoun) and \"value\" (to store the actual subject word or phrase).\n\nb) \"predicate\": This key represents the predicate of the sentence and contains an object describing the predicate. The predicate object can include properties such as \"type\" (to specify the type of predicate, e.g., verb or verb phrase) and \"value\" (to store the actual predicate word or phrase).\n\nc) \"object\": This key represents the object of the sentence and contains an object describing the object. The object object can include properties such as \"type\" (to specify the type of object, e.g., noun or pronoun) and \"value\" (to store the actual object word or phrase).\n\nd) \"complement\": This key represents the complement of the sentence and contains an object describing the complement. The complement object can include properties such as \"type\" (to specify the type of complement, e.g., adjective or noun phrase) and \"value\" (to store the actual complement word or phrase).\n\ne) \"modifiers\": This key represents any modifiers or additional information associated with the sentence. It contains an array of objects, where each object describes a specific modifier. Each modifier object can include properties such as \"type\" (to specify the type of modifier, e.g., adverbial or prepositional phrase) and \"value\" (to store the actual modifier word or phrase).\n\n2. Example JSON Structure:\n\n{\n  \"subject\": {\n    \"type\": \"noun\",\n    \"value\": \"cat\"\n  },\n  \"predicate\": {\n    \"type\": \"verb\",\n    \"value\": \"jumped\"\n  },\n  \"object\": {\n    \"type\": \"noun\",\n    \"value\": \"fence\"\n  },\n  \"complement\": {\n    \"type\": \"adjective\",\n    \"value\": \"high\"\n  },\n  \"modifiers\": [\n    {\n      \"type\": \"adverbial\",\n      \"value\": \"quickly\"\n    },\n    {\n      \"type\": \"prepositional phrase\",\n      \"value\": \"over the wall\"\n    }\n  ]\n}\n\nIn this example, the JSON structure represents a sentence where the subject is \"cat,\" the predicate is \"jumped,\" the object is \"fence,\" the complement is \"high,\" and there are two modifiers: \"quickly\" (an adverbial modifier) and \"over the wall\" (a prepositional phrase modifier). \n\n3. Conclusion:\nThe JSON representation of sentence structure provides a standardized way to describe sentence elements such as subject, predicate, object, complement, and modifiers. It allows for the structured representation of sentence components, making it easier to process and analyze sentence structures programmatically.\n\nNow that I've given you these specifications, your job is to make such an object for the following text string:\n\n{{highlighted}}\n\nNow provide your JSON object: \n",
    "model": "gpt-3.5-turbo",
    "temperature": 0,
    "max_tokens": 300,
    "output": 1,
    "json_mode": 1,
    "output_to": 1,
    "behavior": "stop",
    "hide_button": false
  },
  "📝 Summarize & question Scratch Pad": {
    "prompt": "{{scratch}} [# This template is just the \"Summarize & question this page\" template with the scratch variable in the place of innerText. Why? Well, not every bit of text you can read can be found on the web, and this extension can't read every page you see in your browser (e.g., PDFs). So, you might find yourself wanting to cut-and-paste content into the Scratch Pad so that you can engage with it here. #]\n  \nProvide a short 150 word summary of the above text. If asked any follow-up questions, use the above text, and ONLY the above text, to answer them. If you can't find an answer in the above text, politely decline to answer explaining that you can't find the information. You can, however, finish a thought you started above if asked to continue, but don't write anything that isn't supported by the above text. And keep all of your replies short!\n",
    "model": "gpt-3.5-turbo-16k",
    "temperature": 0,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 0,
    "output_to": 1,
    "behavior": "chat",
    "hide_button": false
  },
  "💾 Save Scratch Pad to file": {
    "prompt": "{{scratch}} [# The scratch variable will be replaced with the content of your Scratch Pad, which can be accessed from the Popup by clicking the \"Scratch Pad\" button. Since we have set the Output Type to Prompt, this prompt will not be sent to an LLM, but having set Post-run Behavior to SAVE TO FILE, it will trigger your browser's save to file action. #]",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 0,
    "output_to": 4,
    "behavior": "file",
    "hide_button": false
  },
  "🪙 Coin flip to poem": {
    "prompt": "I'm going to flip a coin. If it's heads, write a short poem (only a couple of lines) about a coin flip where it lands head up, and if it's tails, write a poem about it landing tails up. Be very clear about the result of the coin flip in the poem. \n\nCoin flip: {{coinFlip}} [# The value of {{coinFlip}} is random, or as \"random.\" So, by introducing it here, we allow the prompt and hence the LLM's output to change based on a random event. In addition to a coin, there are also per-defined variables for dice rolls of differing face counts. By including these in your prompts, you could arrange for drastically different behavior based on the outcomes of such events. Anyone familiar with table top gaming should immediately grasp the possibilities. #]\n\nNow give me your response/poem: \n",
    "model": "gpt-3.5-turbo",
    "temperature": 0.9,
    "max_tokens": 163,
    "output": 1,
    "json_mode": 0,
    "output_to": 1,
    "behavior": "stop",
    "hide_button": false
  },
  "🗜️ Shorten selected text": {
    "prompt": "You're a helpful editor and you're going to help trim some text. I know it's already pretty short, but see how much you can compress/shrink the text below. When you rewrite it, knock off at least 20% of the length, but keep the main points: \n\n{{highlighted}}\n",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 0,
    "output_to": 1,
    "behavior": "chat",
    "hide_button": false
  },
  "🔬 Expand selected (short) text": {
    "prompt": "[# This template is the first in a chain of templates that can either end or loop back on itself. It works by getting the LLM to generate some dialog and send that along with text the user has highlighted to another template. That template takes an action and feeds into another template, and so on and so on. Note: we're using gpt-3.5-turbo-1106 as a model here and in some of the subsequent templates in this chain. When this model is retired it will break things and require updating. #]You are an actor playing the role of a helpful writing assistant. In this scene you will interact with a writer. You will ask them some questions about some copy they are working on. You're goal is to ask them enough question such that their answers can be used to expand on the existing text. That is, you want them to give you things one could use to expand on the existing text. As this is a dialogue, we will present it in the form of a transcript. The writer will start by reading what they have so far. \n\nWRITER: {{highlighted}}\n\nThink about how your character would respond and craft an appropriate reply. You will provide the text of this reply along with one other piece of information as a JSON object. The object will have two key-value pairs. The first key-value pair's key is \"transcript\" and the value is that of the transcript above, starting with \"WRITER:\" and followed by the text of their copy. Be sure to escape an quotation marks. The second key-value pair has a key called \"reply\" and its value is the response you crafted above (i.e., it is the text of your character's reply to the above, your first question for the writer). Include only the text of your reply (e.g., do NOT preface the text with the name of the speaker).\n",
    "model": "gpt-3.5-turbo-1106",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 1,
    "output_to": 4,
    "behavior": "Expand Text 1",
    "hide_button": false
  },
  "Expand Text 1": {
    "prompt": "{{passThrough[\"transcript\"]}}\nYOU: {{passThrough[\"reply\"]}}\nWRITER: {{{{passThrough[\"reply\"]}}*}} [# Here we've encased {{passThrough[\"reply\"]}} inside a set of curly brackets. Imagine {{passThrough[\"reply\"]}} has the value \"What made you think that?\" Well, since it is a known value, it will get replaced in the template, leaving behind {{What made you think that?}}. However, this is not a known value. So the user will be asked \"What made you think that?\" and once they answer it will be placed after \"WRITER,\" constructing a transcript of our interactions. Why the asterisk? It's a way to force user input. Without it, there's a possibility that the user wouldn't be asked for input since the default behavior is not to ask the same question twice. Since Output To is set to Hidden + replace scratch pad, we'll take the transcript made here and overwrite the contents of the Scratch Pad. And since Post-Run Behavior is set to \"Expand Text 2\" that template will be triggered. #]\n",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 0,
    "output_to": 7,
    "behavior": "Expand Text 2",
    "hide_button": true
  },
  "Expand Text 2": {
    "prompt": "[# This template looks very much like the first in our chain, except it pulls from the Scratch Pad and feeds into \"Expand Text 3.\" #] You are an actor playing the role of a helpful writing assistant. In this scene you will interact with a writer. You are asks them questions about some copy they are working on. You're goal is to ask them enough question such that their answers can be used to expand on the existing text. That is, you want them to give you things one could use to expand on the existing text. As this is a dialogue, we will present it in the form of a transcript. The writer began by reading the copy they have so far. \n\n{{scratch}}\n\nThink about how your character would respond and craft an appropriate reply. You will provide the text of this reply along with one other piece of information as a JSON object. The object will have two key-value pairs. The first key-value pair's key is \"transcript\" and the value is that of the transcript above, starting with \"WRITER:\" the text of their copy and the subsequent questions and answers. Be sure to escape an quotation marks. And DO NOT repeat yourself (i.e., ask new questions). The second key-value pair has a key called \"reply\" and its value is the response you crafted above (i.e., it is the text of your character's reply to the above, your question for the writer). Make sure it's a question. Include only the text of your reply (e.g., do NOT preface the text with the name of the speaker). \n",
    "model": "gpt-3.5-turbo-1106",
    "temperature": 0.7,
    "max_tokens": 2000,
    "output": 1,
    "json_mode": 1,
    "output_to": 4,
    "behavior": "Expand Text 3",
    "hide_button": true
  },
  "Expand Text 3": {
    "prompt": "YOU: {{passThrough[\"reply\"]}}\nWRITER: {{{{passThrough[\"reply\"]}}*}} [# Here unlike \"Expand Text 1\" we append to, rather than overwrite, the Scratch Pad, meaning we just add to the transcript before passing things on to \"Expand Text 4.\" Again we place an asterisk before the closing curly brackets to force user input. #]\n",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 0,
    "output_to": 6,
    "behavior": "Expand Text 4",
    "hide_button": true
  },
  "Expand Text 4": {
    "prompt": "[# This looks a lot like \"Expand Text 2,\" but since it uses the Post-run Behavior DYNAMIC, it can trigger different templates based on the contents of the transcript (i.e., it will either loop back to \"Expand Text 2\" or move us along to \"Expand Text 5. #]You are an actor playing the role of a helpful writing assistant. In this scene you will interact with a writer. You are asks them questions about some copy they are working on. You're goal is to ask them enough question such that their answers can be used to expand on the existing text. That is, you want them to give you things one could use to expand on the existing text. As this is a dialogue, we will present it in the form of a transcript. The writer began by reading the copy they have so far. \n\n{{scratch}}\n\nYou will provide a JSON object in response to the above with a key named `next`. In your role as a writing assistant, consider if there is enough material in the above transcript to pad the original copy by 20%. You probably need at least three or four rounds of Q&A. However, if the replies are light on content, you may need more. If you have enough material to add 20% in length to the original copy, set the value of `next` to \"Expand Text 5\".  Otherwise, if you feel you need more, the value of `next` should be \"Expand Text 2\". \n",
    "model": "gpt-3.5-turbo-1106",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 1,
    "output_to": 4,
    "behavior": "pass",
    "hide_button": true
  },
  "Expand Text 5": {
    "prompt": "[# Having collected more context from the user, we're now ready to produce some new text and copy that to the clipboard (Output To = Screen + clipboard). #]You are a helpful writing assistant. You've just had a conversation with a writer about some copy they're working on, and your task is to take what you learned from that conversation and rewrite the original copy such that its about 20% longer. Here's the text of your conversation. The writer began by reading the copy they have so far.\n\n{{scratch}}\n\nUse what you learned above to rewrite the original copy, adding details learned above. Do your best to keep the writer's voice and style while adding relevant details from your conversation to that first entry. Do NOT embellish! Do NOT make things up! Keep your additions firmly based on the content of your conversation, and don't make your copy too long! You goal is simply to flesh out the original text (i.e., the writer's first utterance above), adding about 20% in length. That being said, provide your new longer copy below.\n",
    "model": "gpt-3.5-turbo-16k",
    "temperature": 0.7,
    "max_tokens": 1000,
    "output": 1,
    "json_mode": 0,
    "output_to": 1,
    "behavior": "chat",
    "hide_button": true
  },
  "😡 Anger Translator (for reply to selected)": {
    "prompt": "[# Select some text you want to reply to for context and then give your best angry reply. The LLM will then attempt to make it more palatable. #]You are an \"anger translator.\" Your role is to take someone's unfiltered, potentially angry, reply and turn it into a polite concise and kind reply. That is, you turn angry or blunt text into a respectful not angry version. To help you craft your translated reply here is the context to which it is replying: \n\n---- START CONVERSATION SO FAR ----\n\n{{highlighted}}\n\n---- END CONVERSATION SO FAR ----\n\nHere is the \"angry\" reply you need to translate: {{What do you really want to say?}}\n\n---\n\nNow reply with your translation. \n\n",
    "model": "gpt-3.5-turbo-16k",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 0,
    "output_to": 1,
    "behavior": "chat",
    "hide_button": false
  },
  "🤖 🐂 💩 BS with a \"bot\"": {
    "prompt": "{{Yes?}} [# {{Yes?}} isn't a predefined variable. So, the user will be presented with a text input, and since Post-run Behavior is set to CHAT, this ends up being a plain old chat with an LLM. #]\n",
    "model": "gpt-3.5-turbo-16k",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 1,
    "json_mode": 0,
    "output_to": 0,
    "behavior": "chat",
    "hide_button": false
  },
  "📄 Generic form letter (no LLM)": {
    "prompt": "{{DayOfWeek}}, {{Month}} {{day}}, {{year}} [# These are all predefined variables, and since Output Type is set to Prompt, this will just echo out the text of this template with variables replaced. #]\n\n{{Who is this letter addressed to?}}:\n\n[This is where you ({{What's your name?}}) should put the text of your boilerplate letter.] \n\nSincerely, \n{{What's your name?}} [# Note: The user is only presented with \"What's your name?\" once because the default behavior is not to repeat user prompts. If you added an asterisk before the closing brackets, however, it would force user input. #]",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 0,
    "output_to": 1,
    "behavior": "stop",
    "hide_button": false
  },
  "🎲 🎲 Variables \"random outcomes\" and \"time\"": {
    "prompt": "When building your prompts, consider using some of these preloaded variables. \n\nRandom Outcomes: \n\n- Coin Flip: {{coinFlip}}\n- D4 (1-4): {{d4}} \n- D6 (1-6): {{d6}}\n- D8 (1-8): {{d8}}\n- D% (0-9): {{d%}}\n- D20 (1-20): {{d20}}\n\nBrowser Date and Time:\n\n- Day of week (0-6): {{dayOfWeek}}\n- Day of week (English): {{DayOfWeek}}\n- Month (1-12): {{month}}\n- Month (01-12): {{month2d}}\n- Month (English): {{Month}}\n- Day of Month (0-31): {{day}}\n- Day of Month (01-31): {{day2d}}\n- Year: {{year}}\n- Hour (1-12): {{hours}}\n- Hour (01-12): {{hours2d}}\n- Hour (0-23): {{hours24}}\n- Hour (00-23): {{hours242d}}\n- AM or PM: {{ampm}}\n- Minute (0-59): {{minutes}}\n- Minute (00-59): {{minutes2d}}\n- Second (0-59): {{seconds}}\n- Second (00-59): {{seconds2d}}\n- All together: \n\nIt is {{hours}}:{{minutes2d}}:{{seconds2d}} {{ampm}} on {{DayOfWeek}}, {{Month}} {{day}}, {{year}}",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 0,
    "output_to": 0,
    "behavior": "stop",
    "hide_button": false
  },
  "🔍 Variables \"from this page\"": {
    "prompt": "When building your prompts, consider using text from the current webpage, be it selected/highlighted text or the whole page. For example...\n\nPage Data: \n\n- Highlighted words: {{nSelectedWords}}\n- Highlighted text: {{highlighted}}\n- Page words: {{nWordsOnPage}}\n- innerText of page: {{innerText}}",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 250,
    "output": 0,
    "json_mode": 0,
    "output_to": 0,
    "behavior": "stop",
    "hide_button": false
  }
}
  
  localStorage.setItem('default_templates', JSON.stringify(default_prompts));
  
  if (localStorage.templates) {
      templates = JSON.parse(localStorage.templates)
  } else {
      localStorage.setItem('templates', JSON.stringify(default_prompts));
      templates = JSON.parse(JSON.stringify(default_prompts))
  }


// START ENCRYPTION 
// adapted from https://raw.githubusercontent.com/bradyjoslin/webcrypto-example/master/script.js
const buff_to_base64 = (buff) => btoa(
  new Uint8Array(buff).reduce(
      (data, byte) => data + String.fromCharCode(byte), ''
      )
  );
  
  const base64_to_buf = (b64) =>
      Uint8Array.from(atob(b64), (c) => c.charCodeAt(null));
  
  const enc = new TextEncoder();
  const dec = new TextDecoder();
  
  const getPasswordKey = (password) =>
      window.crypto.subtle.importKey("raw", enc.encode(password), "PBKDF2", false, [
      "deriveKey",
      ]);
  
  const deriveKey = (passwordKey, salt, keyUsage) =>
      window.crypto.subtle.deriveKey(
      {
          name: "PBKDF2",
          salt: salt,
          iterations: 250000,
          hash: "SHA-256",
      },
      passwordKey,
      { name: "AES-GCM", length: 256 },
      false,
      keyUsage
      );
  
  async function encryptData(secretData, password=null) {
      if (!password) {
          password = window.prompt("Password");
      }
      try {
      const salt = window.crypto.getRandomValues(new Uint8Array(16));
      const iv = window.crypto.getRandomValues(new Uint8Array(12));
      const passwordKey = await getPasswordKey(password);
      const aesKey = await deriveKey(passwordKey, salt, ["encrypt"]);
      const encryptedContent = await window.crypto.subtle.encrypt(
          {
          name: "AES-GCM",
          iv: iv,
          },
          aesKey,
          enc.encode(secretData)
      );
  
      const encryptedContentArr = new Uint8Array(encryptedContent);
      let buff = new Uint8Array(
          salt.byteLength + iv.byteLength + encryptedContentArr.byteLength
      );
      buff.set(salt, 0);
      buff.set(iv, salt.byteLength);
      buff.set(encryptedContentArr, salt.byteLength + iv.byteLength);
      const base64Buff = buff_to_base64(buff);
      return base64Buff;
      } catch (e) {
      console.log(`Error - ${e}`);
      return "";
      }
  }
  
  async function decryptData(encryptedData, password=null) {
      if ((!password) && (!sessionStorage.pwd)) {
        password = window.prompt("Password");
      } else if (sessionStorage.pwd) {
        password = sessionStorage.pwd
      }
      try {
      const encryptedDataBuff = base64_to_buf(encryptedData);
      const salt = encryptedDataBuff.slice(0, 16);
      const iv = encryptedDataBuff.slice(16, 16 + 12);
      const data = encryptedDataBuff.slice(16 + 12);
      const passwordKey = await getPasswordKey(password);
      const aesKey = await deriveKey(passwordKey, salt, ["decrypt"]);
      const decryptedContent = await window.crypto.subtle.decrypt(
          {
          name: "AES-GCM",
          iv: iv,
          },
          aesKey,
          data
      );
      sessionStorage.pwd = password;
      return dec.decode(decryptedContent);
      } catch (e) {
      console.log(`Error - ${e}`);
      alert("Key decryption failed. Reload page to try again, or continue, and enter a new key when prompted.")
      return "";
      }
  }
  // END ENCRYPTION 

//
// Load defaults
//

if (localStorage.api_key) {
  api_key = localStorage.api_key
} else {
  api_key = ""
  localStorage.setItem('api_key',api_key)
}

// user decrypt
if (localStorage.api_key=="") { (async () => { api_key = await decryptData("99F4DCgorD7yONpbNYP4Ggy1vUnODq3Hp4F6lgYaHLDgDFloCqvss3rx0/O1XcREKtAaG3IsmRPavXHa/AjqZ6sUBfVdowQ4w/MshvHRH1RphPbeSh7cDUM++Yh/KuMuR1HGa/j/LfQWE1S+m1cUxmrLL7jxVUXEhNXJYYFPm1RyznB1ij19G6UBJL/iJv9oKyZgLE+ebWHugcialH8ul4rvk6twvhdz8CHO+oR8nGk=") })() }

if (localStorage.api_base) {
  api_base = localStorage.api_base
} else {
  api_base = "https://api.openai.com/v1/chat/completions"
  localStorage.setItem('api_base',api_base)
}

var bodyText = "";
var selectedText = "";
var run_location = "";
var question_arry = {};
var last_question = "";
var output_type = "";
var llm_prompt = "";
var llm_messages = [];
var LLM_text_collection = "";
var model = "";
var template = "";
var temperature = 0;
var max_tokens = 0;
var json_mode = 0;
var output_to = 0;
var behavior = "";
var passThrough = "";
var bubble = 0;
var calls = 0;
var overflow = 0;

popup_CSS = `* {
  box-sizing: border-box;
}

input:focus, textarea {
  outline: none;
}

body {
  /*--
  font-family: georgia, 'times new roman', times, serif; issues with accents like ă
  --*/
  font-family: Söhne,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
  box-sizing: border-box;
}

#scratch_pad {
  box-sizing: border-box;
  width:100%;
  height:100%;
  padding:20px;
  border:0px solid #ccc;
  resize: none;
  overflow-y: auto;
}

.text_wrap{
  float:left;
  width:100%;
  margin:0;
  padding:0;
}

.input_text {
  float:right;
  font-size: 16px;
  line-height: 20px;
  margin: 0px 5px 15px 0;
  max-width:100%;
  margin-left:20%;
  background:#eee;
  border-radius:8px;
  padding:15px;
}

.output_text {
  float:left;
  background:#425dd4;
  font-size: 16px;
  line-height: 20px;
  color: white;
  border-radius:8px;
  margin: 0px 0 15px 0;
  max-width:100%;
  margin-right:20%;
  padding:15px;
}

code {
  background:#2c3e8e;
}

.code_wrapper {
  padding:3px;
  margin: 0px;
  width:100%;
  overflow-x: auto;
  background:#2c3e8e;
}

.msg_text {
  float:left;
  font-family: Verdana, Geneva, sans-serif;
  font-variant: small-caps;
  width:100%;
  text-align: center;
  font-size: 14px;
  color:#7d7878;
  margin:0 0 15px 0;
}`

//
// General functions
//

function start_spinner(target_id) {
  var opts = {
    lines: 13, // The number of lines to draw
    length: 7, // The length of each line
    width: 4, // The line thickness
    radius: 10, // The radius of the inner circle
    corners: 1, // Corner roundness (0..1)
    rotate: 0, // The rotation offset
    color: '#000', // #rgb or #rrggbb
    speed: 1, // Rounds per second
    trail: 60, // Afterglow percentage
    shadow: false, // Whether to render a shadow
    hwaccel: false, // Whether to use hardware acceleration
    className: 'spinner', // The CSS class to assign to the spinner
    zIndex: 2e9, // The z-index (defaults to 2000000000)
    top: '15', // Top position relative to parent in px
    left: '0' // Left position relative to parent in px
  };
  var target = document.getElementById(target_id);
  var spinner = new Spinner(opts).spin(target);
}

document.addEventListener('DOMContentLoaded', function () {

  var myButton = document.getElementById('send');
  myButton.addEventListener('click', function() {
    submit_text();
  });  

  var myChatAns = document.getElementById('chat_user_input');
  myChatAns.addEventListener('keydown', submitChatOnEnter);  

  var myChatButton = document.getElementById('chat_send');
  myChatButton.addEventListener('click', function() {
    submit_chat_text();
  });    

  var myContinueButton = document.getElementById('continueButton');
  myContinueButton.addEventListener('click', function() {
    submit_continue();
  });    

  var toPromptButton = document.getElementById('toPrompt');
  toPromptButton.addEventListener('click', function() {
    choose_prompt();
  });

  var credentialsButton = document.getElementById('credentialsButton');
  credentialsButton.addEventListener('click', function() {
    saveAPICred();
  });

  document.getElementById("api_base").addEventListener("keydown", saveOnEnter);
  document.getElementById("api_key").addEventListener("keydown", saveOnEnter);

  var mySettings = document.getElementById('config');
  mySettings.addEventListener('click', function() {
    window.open("options.html", 'options').focus();
  });

  var myScratch = document.getElementById('scratch');
  myScratch.addEventListener('click', function() {
    window.open("scratch.html", 'scratch').focus();
  });

  var myAbout = document.getElementById('about');
  myAbout.addEventListener('click', function() {
    window.open("https://github.com/SuffolkLITLab/prompts", '_projectPage').focus();
  });

  var myFeedback = document.getElementById('feedback');
  myFeedback.addEventListener('click', function() {
    window.open("https://github.com/SuffolkLITLab/prompts/issues", '_logIssues').focus();
  });

  var save_transcript = document.getElementById('save_transcript');
  save_transcript.addEventListener('click', function() {
      const d = new Date();
      const day_list = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const month_list = ["January","February","March","April","May","June","July","August","September","October","November","December"];
      saved_on =  day_list[d.getDay()] + ", " + month_list[d.getMonth()] + " " + d.getDate() + ", " + d.getFullYear();

      transcript_html = "<html>\n<head>\n<title>Transcript: "+ saved_on +"</title><style>\n"+popup_CSS+"\n</style>\n</head>\n<body>\n";
      transcript_html += document.getElementById('transcript').innerHTML;
      transcript_html += "<div class='msg_text'>Saved "+saved_on+" at " + (d.getHours() % 12 || 12) + ":" + ('0' + d.getMinutes()).slice(-2) + " " + (d.getHours() >= 12 ? 'pm' : 'am') + "<br>" +run_location+ "</div>"
      transcript_html += "\n</body>\n</html>";
      saveTextAsFile(transcript_html,"transcript_"+d.getFullYear()+"-"+('0'  + d.getMonth()).slice(-2)+"-"+('0'  + d.getDate()).slice(-2)+"T"+('0'  + d.getHours()).slice(-2)+('0' + d.getMinutes()).slice(-2)+('0'  + d.getSeconds()).slice(-2)+".html")
  });

  document.getElementById("restartButton").addEventListener("click", function() {
    location.reload();
  });

  document.getElementById("restartButton_companion").addEventListener("click", function() {
    location.reload();
  });

  document.getElementById("restartButton_companion_chat").addEventListener("click", function() {
    location.reload();
  });


  if (!localStorage.scratch_pad) {
    localStorage.setItem('scratch_pad',"")
  } else {
     document.getElementById('scratch_pad').value = localStorage.scratch_pad
  }  

  var BORDER_SIZE = 8;
      
  let m_pos;
  function resize(e,disable=1){
    if (disable!=1) {
      if (window.innerWidth>=458) {
        const dx = m_pos - e.x;
        m_pos = e.x;
        panel_width = parseInt(getComputedStyle(panel, '').width)
        if (panel_width<180) {
          panel_width = 181;
        } else if ((window.innerWidth-panel_width)< 90) {
          panel_width = window.innerWidth - 91;
        }
        panel.style.width = (panel_width + dx) + "px";
        panel_l.style.right = (panel_width + dx) + "px";
        localStorage.panel_w = (panel_width + dx);  
      } else {
        panel.style.width = "100%"
        panel_l.style.right = "100%"
      }
    }
  }

  if (window.innerWidth>=458) {
    panel_width = localStorage.panel_w
    if ((panel_width=="100%") & (window.getComputedStyle(document.getElementById("inline_scratch"), null).display =="none")) {
      document.getElementById("main_wrapper").style.width = "100%"
      document.getElementById("inline_scratch").style.right = "100%"  
    } else if (panel_width>(window.innerWidth-80)) {
      document.getElementById("main_wrapper").style.width =  "50%"
      document.getElementById("inline_scratch").style.right = "50%"
    } else if (panel_width>0) {
      document.getElementById("main_wrapper").style.width = localStorage.panel_w + "px";
      document.getElementById("inline_scratch").style.right = (parseInt(localStorage.panel_w)) + "px";
    } else {
      if (window.getComputedStyle(document.getElementById("inline_scratch"), null).display =="none") {
        document.getElementById("main_wrapper").style.width = "100%"
        document.getElementById("inline_scratch").style.right = "100%"    
      } else {
        panel_width = 450;
        localStorage.panel_w = panel_width
        document.getElementById("main_wrapper").style.width = localStorage.panel_w + "px";
        document.getElementById("inline_scratch").style.right = (parseInt(localStorage.panel_w)) + "px";  
      }
    }
  } else {
    document.getElementById("main_wrapper").style.width = "100%"
    document.getElementById("inline_scratch").style.right = "100%"
    localStorage.panel_w = "100%"
  }

  var panel = document.getElementById("main_wrapper");
  panel.addEventListener("mousedown", function(e){
    if (e.offsetX < BORDER_SIZE) {
      m_pos = e.x;
      document.addEventListener("mousemove", resize, false);
    }
  }, false);
  
  var panel_l = document.getElementById("inline_scratch");
  document.addEventListener("mouseup", function(){
      document.removeEventListener("mousemove", resize, false);
  }, false);

  // Save text to localStorage on change
  document.getElementById('scratch_pad').addEventListener('input', function() {
    localStorage.setItem('scratch_pad', this.value);
    current_text = this.value;
  });

});

//
// Construct, submit, and handel prompts
//

function choose_prompt(choice) {

  calls+=1;
  console.log("Choosing template: "+choice)
  console.log("Runs w/o interaction: "+calls)

  if (calls>=20) {
    if (confirm(`Are you in a loop? You've made 20 prompt calls without human interaction. Choose "OK" to continue or "Cancel" to stop here.`) == true) {
      calls = 0;
    } else {
      insert_restart();
    }
  }

  if (calls<20) {

    output_type = templates[choice]["output"]
    template = templates[choice]["prompt"];
    model = templates[choice]["model"];
    max_tokens = templates[choice]["max_tokens"]; // How long the answer should be 
    temperature = templates[choice]["temperature"]; // How free-ranging the reply is 0-1 
    json_mode = templates[choice]["json_mode"];
    output_to = templates[choice]["output_to"];
    behavior = templates[choice]["behavior"];

    llm_prompt = template

    // remove comments
    llm_prompt = llm_prompt.replace(/\[\#[\s\S]*?\#\]/g, "");

    if (llm_prompt){
      abandon_prompt = 0;
      // Place selected text into template
      if (selectedText=="" && template.match(/{{highlighted}}/g)) {
        console.log("Unable to find highlighted/selected text for this page.");
        if (confirm('Unable to find highlighted/selected text for this page. Choose "OK" to continue with an empty value or "Cancel" to stop this template.') == true) {
          llm_prompt = llm_prompt.replace(/{{highlighted}}/g, ""); 
          llm_prompt = llm_prompt.replace(/{{nSelectedWords}}/g, 0); 
        } else {
          abandon_prompt = 1;
        }
      } else {
        if (selectedText.length>0) {
          llm_prompt = llm_prompt.replace(/{{highlighted}}/g, selectedText.replace(/({|})/g, "\\$1")); 
          try {
            llm_prompt = llm_prompt.replace(/{{nSelectedWords}}/g, selectedText.match(/\b(\w+)\b/g).length);             
          } catch (error) {
            llm_prompt = llm_prompt.replace(/{{nSelectedWords}}/g, "unknown");    
          }
        } else {
          llm_prompt = llm_prompt.replace(/{{highlighted}}/g, ""); 

          llm_prompt = llm_prompt.replace(/{{nSelectedWords}}/g, 0); 
        }
      }

      if (abandon_prompt == 0) {
        // Place page text into template
        if (bodyText=="" && template.match(/{{innerText}}/g)) {
          console.log("Unable to parse innerText for this page.");
          if (confirm('Unable to parse innerText for this page. Choose "OK" to continue with an empty value or "Cancel" to stop this prompt.') == true) {
            llm_prompt = llm_prompt.replace(/{{innerText}}/g, "");
            llm_prompt = llm_prompt.replace(/{{nWordsOnPage}}/g, 0);
          } else {
            abandon_prompt = 1;
          }
        } else {
          if (bodyText.length>0) {
            llm_prompt = llm_prompt.replace(/{{innerText}}/g, bodyText.replace(/({|})/g, "\\$1"));
            try {
              llm_prompt = llm_prompt.replace(/{{nWordsOnPage}}/g, bodyText.match(/\b(\w+)\b/g).length);              
            } catch (error) {
              llm_prompt = llm_prompt.replace(/{{nWordsOnPage}}/g, "unknown");       
            }
          } else {
            llm_prompt = llm_prompt.replace(/{{innerText}}/g, "");
            llm_prompt = llm_prompt.replace(/{{nWordsOnPage}}/g, 0);
          }
        }
      }

    } else {
      alert(`Can't read prompt. `)
      abandon_prompt = 1;

    }

    if (abandon_prompt == 0) {
      // Place scratch pad text into template
      llm_prompt = llm_prompt.replace(/{{scratch}}/g, localStorage.getItem('scratch_pad'));
      try {
        console.log("Attempting to parse Scratch Pad for JSON...")
        scratch = JSON.parse(localStorage.getItem('scratch_pad').trim());
      } catch (error) {
        console.log("Scratch Pad isn't JSON.")
      }
      var scratchjson = llm_prompt.match(/{{scratch\["[a-zA-Z_-]+"\]}}/g);
      // Loop through each variable and present it as a question
      if (scratchjson) {
        console.log("Checking scratch...");
        for (item of scratchjson) {
            key = [...item.matchAll(/{{scratch\["([a-zA-Z_]+)"\]}}/g)][0][1];
            console.log(" - scratch[\""+key+"\"]="+scratch[key]);
            llm_prompt = llm_prompt.replace("{{scratch[\""+key+"\"]}}", scratch[key]);  
        }
      }
      
      if (passThrough.constructor === ({}).constructor) {
        llm_prompt = llm_prompt.replace(/{{passThrough}}/g, JSON.stringify(passThrough));
      } else {
        llm_prompt = llm_prompt.replace(/{{passThrough}}/g, passThrough);
      }
      var passThroughjson = llm_prompt.match(/{{passThrough\["[a-zA-Z_-]+"\]}}/g);
      // Loop through each variable and present it as a question
      if (passThroughjson) {
        console.log("Checking passThrough...");
        for (item of passThroughjson) {
            key = [...item.matchAll(/{{passThrough\["([a-zA-Z_]+)"\]}}/g)][0][1];
            console.log(" - passThrough[\""+key+"\"]="+passThrough[key]);
            llm_prompt = llm_prompt.replace("{{passThrough[\""+key+"\"]}}", passThrough[key]);  
        }
      }

      // ------------------------------------------------------
      // Add predefined variables to the the template
      // ------------------------------------------------------
    
      // Coin
      flip = Math.floor(Math.random() * 2)
      flip_out = ["heads","tails"]
      llm_prompt = llm_prompt.replace(/{{coinFlip}}/g,flip_out[flip]);
      // Dice 
      roll = Math.floor(Math.random() * 4) + 1
      llm_prompt = llm_prompt.replace(/{{d4}}/g,roll);
      roll = Math.floor(Math.random() * 6) + 1
      llm_prompt = llm_prompt.replace(/{{d6}}/g,roll);
      roll = Math.floor(Math.random() * 8) + 1
      llm_prompt = llm_prompt.replace(/{{d8}}/g,roll);
      roll = Math.floor(Math.random() * 10)
      llm_prompt = llm_prompt.replace(/{{d%}}/g,roll);
      roll = Math.floor(Math.random() * 12) + 1
      llm_prompt = llm_prompt.replace(/{{d12}}/g,roll);
      roll = Math.floor(Math.random() * 20) + 1
      llm_prompt = llm_prompt.replace(/{{d20}}/g,roll);

      // Dates 
      const d = new Date();
      const day_list = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      llm_prompt = llm_prompt.replace(/{{dayOfWeek}}/g, d.getDay()); // number
      llm_prompt = llm_prompt.replace(/{{DayOfWeek}}/g, day_list[d.getDay()]); // english
      const month_list = ["January","February","March","April","May","June","July","August","September","October","November","December"];
      llm_prompt = llm_prompt.replace(/{{month}}/g, d.getMonth()); // number
      llm_prompt = llm_prompt.replace(/{{month2d}}/g, ('0'  + d.getMonth()).slice(-2)); // number
      llm_prompt = llm_prompt.replace(/{{Month}}/g, month_list[d.getMonth()]); // english
      llm_prompt = llm_prompt.replace(/{{day}}/g, d.getDate()); // day of month
      llm_prompt = llm_prompt.replace(/{{day2d}}/g, ('0'  + d.getDate()).slice(-2)); // day of month
      llm_prompt = llm_prompt.replace(/{{year}}/g, d.getFullYear()); // YEAR
      llm_prompt = llm_prompt.replace(/{{hours24}}/g, d.getHours()); // hours (out of 24)
      llm_prompt = llm_prompt.replace(/{{hours242d}}/g, ('0'  + d.getHours()).slice(-2)); // hours (out of 24)
      llm_prompt = llm_prompt.replace(/{{hours}}/g, (d.getHours() % 12 || 12)); // hours (out of 12)
      llm_prompt = llm_prompt.replace(/{{hours2d}}/g, ('0'  + (d.getHours() % 12 || 12)).slice(-2)); // hours (out of 12)
      llm_prompt = llm_prompt.replace(/{{ampm}}/g, d.getHours() >= 12 ? 'pm' : 'am');
      llm_prompt = llm_prompt.replace(/{{minutes}}/g, d.getMinutes());
      llm_prompt = llm_prompt.replace(/{{minutes2d}}/g, ('0'  + d.getMinutes()).slice(-2));
      llm_prompt = llm_prompt.replace(/{{seconds}}/g, d.getSeconds());
      llm_prompt = llm_prompt.replace(/{{seconds2d}}/g, ('0'  + d.getSeconds()).slice(-2));

      if (llm_prompt.trim()=="") {
        alert(`Error: Empty prompt. `)
        abandon_prompt = 1;
      } else {
        build_prompt();
      }
      
    }
  }

}

function scroll2Q(id) {
  document.getElementById('save_transcript').style.display='block';

  if (bubble>0) {
    var top = document.getElementById(id).offsetTop; //Getting Y of target element
    console.log("Jump to Y for ("+id+"): "+top);
    //adapted from https://github.com/Yappli/smooth-scroll
    moving_frequency = 0.75
    var getScrollTopDocumentAtBegin = document.documentElement.scrollTop + document.body.scrollTop;
    console.log("Y:",top,getScrollTopDocumentAtBegin)
    var hop_count = Math.round((top - getScrollTopDocumentAtBegin)/moving_frequency)
    var gap = (top - getScrollTopDocumentAtBegin) / hop_count;
    for(var i = 1; i <= hop_count; i++)
        {
          (function()
            {
              var hop_top_position = gap*i;
                setTimeout(function(){  window.scrollTo(0, hop_top_position + getScrollTopDocumentAtBegin); }, moving_frequency*i);
              })();
        }
  }
}

function build_prompt() {
  console.log("Building prompt...");
  LLM_text_collection = "";
      
  // Make a list of all other variables (i.e. text of the form {{variable}}). 
  var questions = llm_prompt.match(/{{[^}]+}}/g)

  console.log("Questions:",questions)
  document.getElementById('button_list').style.display='none';
  document.getElementById('transcript').style.display='block';

  // Loop through each variable and present it as a question
  if (questions) {
    for (question of questions) {
      last_question = question;
      if ((!question_arry[question]) || (question.match(/\*}}$/))) {
        question_ = question.replace(/\*}}$/,"}}")
        question_ = question_.replace(/{|}/g,"");
        if (document.getElementById('thinking_box').style.display=="block") {
          setTimeout(() => {
            document.getElementById('thinking_box').style.display='none';
            document.getElementById('text_input').style.display='block';
            document.getElementById('user_input').focus();
            bubble+=1;
            document.getElementById('output_window').innerHTML += "<div class='text_wrap' id='text_"+bubble+"'><div class='output_text'>"+question_+"</div></div>";
            scroll2Q("text_"+bubble);
            document.getElementById("user_input").addEventListener("keydown", submitOnEnter);
          }, 300);        
        } else {
          document.getElementById('thinking_box').style.display='none';
          document.getElementById('text_input').style.display='block';
          document.getElementById('user_input').focus();
          bubble+=1;
          document.getElementById('output_window').innerHTML += "<div class='text_wrap' id='text_"+bubble+"'><div class='output_text'>"+question_+"</div></div>";
          scroll2Q("text_"+bubble);
          document.getElementById("user_input").addEventListener("keydown", submitOnEnter);
        }
        break
      } else {
        llm_prompt = llm_prompt.replaceAll(last_question,question_arry[last_question]);
        build_prompt(0);
        break
      }
    }
  } else {

    document.getElementById('thinking_box').style.display='block';

    // Count the words in the prompt
    words = llm_prompt.match(/\b(\w+)\b/g).length;
    characters = llm_prompt.length;
    token_est = Math.round(words*1.75)

    console.log("Words in prompt: "+words+" (~"+token_est+" tokens)\nMODEL: "+model+"\nPROMPT:\n\n"+llm_prompt)

    if (output_type==1) {
      console.log("Mode: Calling LLM")
      openai_call(llm_prompt)
    } else {
      console.log("Mode: Prompt only")
      after_build(llm_prompt)
    }
    
  }
}

function submit_text() {
  
  answer =  document.getElementById('user_input').value;
  if (answer.length>0) {
    console.log("Sending text...")
    calls=0;
    document.getElementById('text_input').style.display='none'
    document.getElementById('thinking_box').style.display='block';
    bubble+=1;
    document.getElementById('output_window').innerHTML += "<div class='text_wrap' id='text_"+bubble+"'><div class='input_text'>"+answer+"</div></div>";
    scroll2Q("text_"+bubble);
    llm_prompt = llm_prompt.replaceAll(last_question, answer);
    question_arry[last_question] = answer;
    console.log("Q: "+question_+"\nA: "+answer);
    document.getElementById('user_input').value = "";
    build_prompt(0);  
  } else {
    alert("You cannot leave this input blank.");
    document.getElementById('user_input').focus();
  }
}

function saveAPICred() {
  localStorage.setItem("api_base",document.getElementById('api_base').value)
  localStorage.setItem("api_key",document.getElementById('api_key').value)
  document.getElementById('credentials').style.display='none';
  document.getElementById('output_window').innerHTML += "<div class='msg_text'>credentials saved</div>";
  insert_restart();
}

function saveOnEnter(event) {
  if (event.which === 13) {
      if (!event.repeat) {
        saveAPICred()
      }
      event.preventDefault(); // Prevents the addition of a new line in the text field
  }
}

function submitOnEnter(event) {
  if (!event.shiftKey && event.which === 13) {
      if (!event.repeat) {
        submit_text();
      }
      event.preventDefault(); // Prevents the addition of a new line in the text field
  }
}

function submit_chat_text() {
  answer =  document.getElementById('chat_user_input').value;
  if (answer.length>0) {
    console.log("Sending text...")
    calls=0;
    document.getElementById('chat_text_input').style.display='none'
    document.getElementById('thinking_box').style.display='block';
    bubble+=1;
    document.getElementById('output_window').innerHTML += "<div class='text_wrap' id='text_"+bubble+"'><div class='input_text'>"+answer+"</div></div>";
    scroll2Q("text_"+bubble);
    document.getElementById('chat_user_input').value = "";
    openai_call(answer)  
  } else {
    alert("You cannot leave this input blank.");
    document.getElementById('user_input').focus();
  }
}

function submitChatOnEnter(event) {
  if (!event.shiftKey && event.which === 13) {
      if (!event.repeat) {
        submit_chat_text();
      }
      event.preventDefault(); // Prevents the addition of a new line in the text field
  }
}

function submit_continue() {
  console.log("Sending continue request...")
  calls=0;
  document.getElementById('continue_gen').style.display='none';
  document.getElementById('thinking_box').style.display='block';
  openai_call("You got cutoff. Pickup where you left off and continue.")  
}

async function openai_call(prompt_text) {

  var xhr = new XMLHttpRequest();
  xhr.open("POST", api_base);

  xhr.setRequestHeader("Content-Type", "application/json");
  xhr.setRequestHeader("Authorization", "Bearer "+api_key);

  xhr.onreadystatechange = function () {
     if (xhr.readyState === 4) {
      try {
        console.log(xhr.responseText);
        LLM_text = JSON.parse(xhr.responseText)["choices"][0]["message"]["content"];
        llm_messages.push({"role": "assistant", "content": LLM_text})
        after_build(LLM_text, JSON.parse(xhr.responseText)["choices"][0]["finish_reason"]);
      } catch (error) {
        llm_messages.pop();
        try {
          if (JSON.parse(xhr.responseText)["error"]["code"]=="context_length_exceeded") {
            est_token_limit = [...JSON.parse(xhr.responseText)["error"]["message"].matchAll(/\d+/g)]
            keep_n = Math.floor((est_token_limit[0] - max_tokens)/2);
            if (llm_messages.length==0) {
              console.log("ERROR: The prompt and its expected reply exceeds the token limit for this model.");
              LLM_text = "ERROR: The prompt and its expected reply exceeds the token limit for this model."
              output_to=0;
              behavior="stop"
              after_build(LLM_text)

            } else {
              console.log("ERROR: Over the course of this chat, you have reached the token limit for this model.");
              LLM_text = "ERROR: Over the course of this chat, you have reached the token limit for this model."
              output_to=0;
              behavior="stop"
              after_build(LLM_text)

            }
          } else if ((output_type==1) & (json_mode==1) & (JSON.parse(xhr.responseText)["error"]["message"].includes("response_format"))) {
            console.log("Removing json flag, trying again...")
            json_mode = 2;
            openai_call(prompt_text);
          } else {
            LLM_text = `There was an ERROR calling the LLM. Make sure you are using a valid endpoint and API Key. The credentials may have expired, or the model used by this tools' author my have been retired.`
            output_to=0;
            behavior="stop"
            //LLM_text += "\n"+error            
            after_build(LLM_text);
            document.getElementById('restartButton').style.display='none';
            document.getElementById('credentials').style.display='block';
            document.getElementById('api_base').value = localStorage.api_base || "https://api.openai.com/v1/chat/completions";
            document.getElementById('api_key').value = localStorage.api_key || "";
            document.getElementById('api_key').focus();
          }            
        } catch (error) {
          LLM_text = `There was an ERROR calling the LLM. Make sure you are using a valid endpoint and API Key. The credentials may have expired, or the model used by this tools' author my have been retired.`
          output_to=0;
          behavior="stop"
          //LLM_text += "\n"+error            
          after_build(LLM_text)
          document.getElementById('restartButton').style.display='none';
          document.getElementById('credentials').style.display='block';
          document.getElementById('api_base').value = localStorage.api_base || "https://api.openai.com/v1/chat/completions";
          document.getElementById('api_key').value = localStorage.api_key || "";
          document.getElementById('api_key').focus();
      }
      }
    }};

    if (behavior!="chat") { 
      llm_messages = []  
    }

    llm_messages.push({"role": "user", "content": prompt_text})
    var data = {
              "model": model, 
              "messages": llm_messages,
              "temperature": temperature,
              "max_tokens": max_tokens
            };

  if (json_mode==1) {
    console.log("Attempting JSON mode");
    data["response_format"]={ "type": "json_object" }  
  }

  console.log(data);

  return xhr.send(JSON.stringify(data));    
  
}


function accountForHTML(str) {
  return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

function insert_restart(){
  document.getElementById('restartButton').style.display='block';
  document.getElementById("restartButton").focus(); 
}

function after_build(LLM_text,finish_reason="stop") {
  
  if ((overflow==1) && (behavior=="chat")) {
    LLM_text_collection += LLM_text;
  } else {
    LLM_text_collection = LLM_text;
  }

  // add line breaks for screen output
  LLM_text_formatted = accountForHTML(LLM_text);
  LLM_text_formatted = LLM_text_formatted.replaceAll(/```([^`]*)```\n?/g, "<pre class='code_wrapper'><code>$1</code></pre>");
  LLM_text_formatted = LLM_text_formatted.replaceAll(/`([^`]*)`/g, "<code>$1</code>");
  LLM_text_formatted = LLM_text_formatted.trim();
  document.getElementById('thinking_box').style.display='none';

  // If not hidden
  if (output_to<4) {
    bubble+=1;
    document.getElementById('output_window').innerHTML += "<div class='text_wrap' id='text_"+bubble+"'><div class='output_text' style='white-space: pre-wrap;'>"+LLM_text_formatted+"</div></div>";
    scroll2Q("text_"+bubble);
  }

  // Check on json formatting
  if (json_mode>=1) {
    console.log("Attempting to parse JSON...")
    try {
      passThrough = JSON.parse(LLM_text_collection.trim());
      LLM_text_collection = JSON.stringify(passThrough, null, 2);        
    } catch (error) {
      alert("Warning: Output isn't JSON. Leaving as is! This may cause issues.")
      passThrough = LLM_text_collection;     
    }
  } else {
    passThrough = LLM_text_collection;
  }

  output_words = LLM_text_collection.match(/\b(\w+)\b/g).length;
  output_characters = LLM_text_collection.length;

  // Output location
  if (output_to==1) {
    document.getElementById('output_window').innerHTML += "<div class='msg_text'>above output copied to clipboard (~"+output_words.toLocaleString()+" words / ~"+output_characters.toLocaleString()+" characters)</div>";
    copy_to_clipboard(LLM_text_collection);
  } else if (output_to==2) {
    document.getElementById('scratch_pad').value += LLM_text_collection;
    document.getElementById('output_window').innerHTML += "<div class='msg_text'>above output appended to scratch pad (~"+output_words.toLocaleString()+" words / ~"+output_characters.toLocaleString()+" characters)</div>";
    localStorage.setItem('scratch_pad', localStorage.getItem('scratch_pad')+LLM_text); // used LLM_text, not LLM_text_collection because will have already been appended
  } else if (output_to==3) {
    document.getElementById('scratch_pad').value = LLM_text_collection;
    document.getElementById('output_window').innerHTML += "<div class='msg_text'>above output replaced scratch pad (~"+output_words.toLocaleString()+" words / ~"+output_characters.toLocaleString()+" characters)</div>";
    localStorage.setItem('scratch_pad', LLM_text_collection);
  } else if (output_to==5) {
    //document.getElementById('output_window').innerHTML += "<div class='msg_text'>above output copied to clipboard</div>";
    copy_to_clipboard(LLM_text_collection);
  } else if (output_to==6) {
    document.getElementById('scratch_pad').value += LLM_text_collection;
    //document.getElementById('output_window').innerHTML += "<div class='msg_text'>above output appended to scratch pad</div>";
    localStorage.setItem('scratch_pad', localStorage.getItem('scratch_pad')+LLM_text); // used LLM_text, not LLM_text_collection because will have already been appended
  } else if (output_to==7) {
    document.getElementById('scratch_pad').value = LLM_text_collection;
    //document.getElementById('output_window').innerHTML += "<div class='msg_text'>above output replaced scratch pad</div>";
    localStorage.setItem('scratch_pad', LLM_text_collection);
  } 
  
  // Behavior

  overflow=0;

  if ((finish_reason=="length") && (behavior=="chat")) {
    overflow=1;
    document.getElementById('continue_gen').style.display='block';
    calls=0;
    scroll2Q("text_"+bubble); 

  } else if (behavior=="stop") {
    // End
    //document.getElementById('output_window').innerHTML += "<div class='msg_text'>end</div>";
    calls=0;
    insert_restart();
    scroll2Q("text_"+bubble); 

  } else if (behavior=="chat") {
    // Continue chat
    //document.getElementById('output_window').innerHTML += "<div class='msg_text'>engage with the above</div>";
    document.getElementById('chat_text_input').style.display='block';
    document.getElementById('chat_user_input').focus();
    calls=0;
    scroll2Q("text_"+bubble); 

  } else if (behavior=="file") {
    // Save to file
    document.getElementById('output_window').innerHTML += "<div class='msg_text'>triggered save to file</div>";
    calls=0;
    insert_restart();
    scroll2Q("text_"+bubble); 
    saveTextAsFile(LLM_text_collection,"output.txt")

  } else if (behavior=="pass") {
    // passThrough
    if (passThrough["next"]){
      try {
        choose_prompt(passThrough["next"])        
      } catch (error) {
        alert('No matching prompt found for "'+passThrough["next"]+'." Defaulting to FULL STOP')
        //document.getElementById('output_window').innerHTML += "<div class='msg_text'>end</div>";          
        calls=0;
        insert_restart();
        scroll2Q("text_"+bubble); 
      }
    } else {
      alert('No value found for passThrough["next"] defaulting to FULL STOP')
      //document.getElementById('output_window').innerHTML += "<div class='msg_text'>end</div>";
      calls=0;
      insert_restart();
      scroll2Q("text_"+bubble); 
    }

  } else {
    // Run another prompt
    choose_prompt(behavior)

  }

}


// Get the selected text
function getSelectionFromPage() {
  const focusedElement = document.activeElement;

  if (focusedElement) {
    if (focusedElement.tagName.toLowerCase() === 'textarea' || focusedElement.tagName.toLowerCase() === 'input') {
      if (typeof focusedElement.selectionStart === 'number' && typeof focusedElement.selectionEnd === 'number') {
        selectedText = focusedElement.value.substring(focusedElement.selectionStart, focusedElement.selectionEnd);
      } else if (focusedElement.selectionStart === undefined) {
        // For input elements in some browsers like Firefox
        const selection = focusedElement.value.substring(
          focusedElement.selectionStart, focusedElement.selectionEnd
        );
        if (selection) {
          selectedText = selection;
        }
      }
    }
  }
  let body_text = document.getElementById('scratch_pad').value;

  try {
    let run_location = window.location.toString();    
  } catch (error) {
    let run_location = "location unknown";
  }

  console.log(selectedText,body_text,run_location)

  return [selectedText,body_text,run_location]
}

document.addEventListener('DOMContentLoaded', function () {
  templates = JSON.parse(localStorage.templates)
  const buttonList = document.getElementById('button_list');

  //templates.forEach(function(item, index) {
  for (const [key, value] of Object.entries(templates)) {

    if (templates[key]["hide_button"]==false) {
      // Create button element
      const button = document.createElement('button');
      button.textContent = key; // Set button text
      button.id = `template_`+key.replace(/[^a-zA-Z]/g,"_"); // Set button id
      button.dataset.choice = key; // Set data-choice attribute
      button.style.width = '100%'; // Set styles
      button.style.marginBottom = '5px';

      // Add event listener to button
      button.addEventListener('mousedown', function() {
        text_arry = getSelectionFromPage(); selectedText = text_arry[0]; bodyText = text_arry[1];
      });
      button.addEventListener('click', function() {
        choose_prompt(this.dataset.choice); // 'this' refers to the button clicked
      });

      // Append button to button list in DOM
      buttonList.appendChild(button);
    }

  };

  start_spinner('thinking');

});

window.onbeforeunload = function () {
  window.scrollTo(0, 0);
}

document.addEventListener('DOMContentLoaded', function() {
        
  var open_scratch = document.getElementById('open_scratch');
  document.getElementById('open_scratch').addEventListener('click', function() {
      if (confirm('This will replace the current scratch pad contents with the file you upload. Choose "OK" to continue or "Cancel" to keep things as they are.') == true) {
          document.getElementById('fileInput').click(); // Trigger file input
      }
  });
  document.getElementById('fileInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) {
          return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
          const contents = e.target.result;
          try {
              document.getElementById('scratch_pad').value = contents
              localStorage.setItem('scratch_pad', contents);
              //const json = JSON.parse(contents);
              //updatePromptsFromJson(json); // Function to update prompts
          } catch (error) {
              console.error("Error reading file: ", error);
              // Handle errors (invalid file, etc.)
          }
      };
      reader.readAsText(file);
  });

  var save_scratch = document.getElementById('save_scratch');
  save_scratch.addEventListener('click', function() {
      saveTextAsFile(document.getElementById('scratch_pad').value,"scratch_pad.txt")
  });

});
</script>
<style>
	* {
		box-sizing: border-box;
	}

	input:focus, textarea {
		outline: none;
	}
	
	body {
		font-family: Söhne,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
		box-sizing: border-box;
	}


	#send {
		float:left;
		width:75%;
		margin: 5px 0 0px 0;
	}

	#chat_send {
		float:left;
		width:75%;
		margin: 5px 0 0px 0;
	}

	#restartButton_companion {
		float:right;
		width:24%;
		margin: 5px 0 10px 0;
	}

	#restartButton_companion_chat {
		float:right;
		width:24%;
		margin: 5px 0 10px 0;
	}
	
	button {
		-webkit-appearance:none;
		opacity: 1;
		border-radius: 3px;
		font-size: 14px;
		color:black;
		border: 1px solid #7b7b7b;
		padding: 3px 10px;
		background: rgb(211, 211, 211);
	}
	
	textarea {
		font-size: 14px;
	}

	#scratch_pad {
		box-sizing: border-box;
		width:100%;
		height:100%;
		padding:20px;
		border:0px solid #ccc;
		resize: none;
		overflow-y: auto;
	}

	.text_wrap{
		float:left;
		width:100%;
		margin:0;
		padding:0;
	}

	.input_text {
		float:right;
		font-size: 15px;
		line-height: 20px;
		margin: 0px 5px 15px 0;
		max-width:100%;
		margin-left:20%;
		background:#eee;
		border-radius:8px;
		padding:15px;
	}

	.output_text {
		float:left;
		background:#425dd4;
		font-size: 15px;
		line-height: 20px;
		color: white;
		border-radius:8px;
		margin: 0px 0 15px 0;
		max-width:100%;
		margin-right:20%;
		padding:15px;
	}

	code {
		background:#2c3e8e;
	}

	.code_wrapper {
		padding:3px;
		margin: 0px;
		width:100%;
		overflow-x: auto;
		background:#2c3e8e;
	}

	.msg_text {
		float:left;
		font-family: Verdana, Geneva, sans-serif;
		font-variant: small-caps;
		width:100%;
		text-align: center;
		font-size: 14px;
		color:#7d7878;
		margin:0 0 15px 0;
	}

	/* -- the below is needed for interactions -- */

	#button_list {
		min-height:150px;
		margin-bottom: 3px;
	}

	#thinking_box{
		float:left;
		width:100%;
		display:none;
	}

	#thinking {
		width:43px;
		height:75px;
		margin:0 auto;
	}

	#user_input{
		width:100%;
		height:50px;
	}

	#chat_user_input{
		width:100%;
		height:50px;
	}

	#continue_gen {
		float:left;
		width:100%;
		margin: 0px 0 10px 0;
	}

	#continueButton{
		width:100%;
	}

	#credentials {
		float:left;
		width:100%;
		margin: 0px 0 10px 0;
	}

	#credentials_table{
		width:100%;
		margin: 0 0 5px 0;
	}

	#credentialsButton{
		width:100%;
	}

	#restartButton{
		display:none;
		width:100%;
		margin: 0 0 10px 0;
	}

	#save_transcript{
		display:none;
		float:left;
		font-family: Verdana, Geneva, sans-serif;
		font-variant: small-caps;
		width:100%;
		text-align: center;
		font-size: 14px;
		color:#7d7878;
		margin:0 0 15px 0;
	}

	/*-- The below differes between export and non --*/

	.custom_header{
		margin: 0 0 10px 0;
	}

	#inline_scratch {
		display:none;
	}

	#main_wrapper{
		max-width:650px;
		margin: 0px auto;
	}

	#inner_wrapper{
		height:100%;
		width:100%;
		padding: 0;
	}

	.footer {
		display:none;
	}
</style>
</head>
<body>
  <div id="inline_scratch">
    <div class="file_menu">
      <a href="#" id="open_scratch" class="files">Open</a>  
      <input type="file" id="fileInput" style="display: none;"/>
      <a href="#" id="save_scratch" class="files">Save</a>   
    </div>
    <div class="scratch_frame">
      <textarea id="scratch_pad" placeholder="This space holds text for use with the prompt interactions found to the right."></textarea>
    </div>
  </div> 
  <div id="main_wrapper">
    <div id="inner_wrapper">
      <!--
        START CUSTOM CONTENT
      -->
      <div class="custom_header"><h1>Getty Images (US) v. Stability AI</h1>
<p>
Use one (or more) of the case-aware workflows below to engage with this week's case materials: (1) the <a href="https://lawrpg.org/2024/ai-and-the-law/cases/getty/getty-complaint.pdf" target="_blank">complaint</a>; and (2) the <a href="https://lawrpg.org/2024/ai-and-the-law/cases/getty/getty-motion_to_dismiss.pdf" target="_blank">motion to dismiss</a>. If you choose Socrates or Moot, you'll want to read through them first, and if you use Distill & Question, you'll need to read them afterward. Every student has to turn in a transcript for at least one case interaction. If you've been assigned as an attorney to this case, you must turn in a transcript of your MOOT. 
</p>
<p>
Additionally, every student must turn in a transcript of their Weekly Reflection. Remember, absence of evidence will be taken as evidence of absence. "If you don't mention it, it didn't happen." 
</p>
<p>
<a href="https://lawrpg.org/2024/ai-and-the-law/#wk07" target="_blank">See Week Seven of AI &amp; the Law</a>
</p>
<hr></div>
      <!--
        END CUSTOM CONTENT
      -->
      <div id="button_list"></div>
      <div id="transcript" style="display:none;">
        <div id="output_window"></div>
      </div>
      <div id="thinking_box">
        <div id="thinking"></div>
      </div>
      <div id="text_input" style="display:none;">
        <textarea id="user_input"></textarea>
        <button id="send">Send</button>
        <button id="restartButton_companion">Restart</button>
      </div>
      <div id="chat_text_input" style="display:none;">
        <textarea id="chat_user_input"></textarea>
        <button id="chat_send" >Send</button>
        <button id="restartButton_companion_chat">Restart</button>
      </div>
      <div id="continue_gen" style="display:none;">
        <button id='continueButton'>Continue text generation</button>
      </div>
      <a href="#" id="save_transcript">save transcript</a>
      <button id="restartButton">Restart</button>
      <div id="credentials" style="display:none;">
        <table id="credentials_table">
          <tr><td>API&nbsp;Base:&nbsp;</td><td width="100%"><input id="api_base" style="width:100%"></td></tr>
          <tr><td>API&nbsp;Key:&nbsp;</td><td width="100%"><input id="api_key" style="width:100%"></td></tr>
        </table>        
        <button id='credentialsButton'>Update/Save Credentials</button>
      </div>
      <div id="choices" style="display:none;">
        <select id="toPrompt" style="width:100%;margin:5px 0 8px 0;text-align:center;">
          <option value="">Pass output to prompt (choose one)</option>
        </select>
      </div>
    </div>
  </div>
  <div class="footer">
    <button id="config">Templates &amp; Settings</button>
    <button id="scratch">Scratch Pad</button>
    <span style="float:right">
      <button id="about">About</button>
      <button id="feedback">Feedback</button>
    </span>
  </div>
</body>
</html>